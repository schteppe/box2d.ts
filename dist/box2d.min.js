!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var i=e();for(var s in i)("object"==typeof exports?exports:t)[s]=i[s]}}(this,function(){return function(t){function e(s){if(i[s])return i[s].exports;var o=i[s]={exports:{},id:s,loaded:!1};return t[s].call(o.exports,o,o.exports,e),o.loaded=!0,o.exports}var i={};return e.m=t,e.c=i,e.p="",e(0)}([function(t,e,i){"use strict";function s(t){for(var i in t)e.hasOwnProperty(i)||(e[i]=t[i])}s(i(1)),s(i(8)),s(i(9)),s(i(10)),s(i(2)),s(i(5)),s(i(6)),s(i(11)),s(i(13)),s(i(16)),s(i(15)),s(i(17)),s(i(14)),s(i(18)),s(i(7)),s(i(4)),s(i(3)),s(i(12)),s(i(19)),s(i(41)),s(i(20)),s(i(37)),s(i(38)),s(i(21)),s(i(40)),s(i(48)),s(i(49)),s(i(43)),s(i(22)),s(i(42)),s(i(39)),s(i(46)),s(i(47)),s(i(44)),s(i(45)),s(i(36)),s(i(25)),s(i(33)),s(i(30)),s(i(23)),s(i(24)),s(i(35)),s(i(26)),s(i(27)),s(i(29)),s(i(28)),s(i(34)),s(i(32)),s(i(31)),s(i(50))},function(t,e,i){"use strict";function s(t,e){return t.proxyA.m_id==e.proxyA.m_id?t.proxyB.m_id-e.proxyB.m_id:t.proxyA.m_id-e.proxyA.m_id}var o=i(2),n=i(6),r=function(){function t(){this.proxyA=null,this.proxyB=null}return t}();e.b2Pair=r;var a=function(){function t(){this.m_tree=new n.b2DynamicTree,this.m_proxyCount=0,this.m_moveCount=0,this.m_moveBuffer=[],this.m_pairCount=0,this.m_pairBuffer=[]}return t.prototype.CreateProxy=function(t,e){var i=this.m_tree.CreateProxy(t,e);return++this.m_proxyCount,this.BufferMove(i),i},t.prototype.DestroyProxy=function(t){this.UnBufferMove(t),--this.m_proxyCount,this.m_tree.DestroyProxy(t)},t.prototype.MoveProxy=function(t,e,i){var s=this.m_tree.MoveProxy(t,e,i);s&&this.BufferMove(t)},t.prototype.TouchProxy=function(t){this.BufferMove(t)},t.prototype.GetFatAABB=function(t){return this.m_tree.GetFatAABB(t)},t.prototype.GetUserData=function(t){return this.m_tree.GetUserData(t)},t.prototype.TestOverlap=function(t,e){var i=this.m_tree.GetFatAABB(t),s=this.m_tree.GetFatAABB(e);return o.b2TestOverlapAABB(i,s)},t.prototype.GetProxyCount=function(){return this.m_proxyCount},t.prototype.UpdatePairs=function(t){this.m_pairCount=0;for(var e=0;e<this.m_moveCount;++e){var i=this.m_moveBuffer[e];if(null!=i){var o=this,n=function(t){if(t.m_id==i.m_id)return!0;o.m_pairCount==o.m_pairBuffer.length&&(o.m_pairBuffer[o.m_pairCount]=new r);var e=o.m_pairBuffer[o.m_pairCount];return t.m_id<i.m_id?(e.proxyA=t,e.proxyB=i):(e.proxyA=i,e.proxyB=t),++o.m_pairCount,!0},a=this.m_tree.GetFatAABB(i);this.m_tree.Query(n,a)}}this.m_moveCount=0,this.m_pairBuffer.length=this.m_pairCount,this.m_pairBuffer.sort(s);for(var e=0;e<this.m_pairCount;){var _=this.m_pairBuffer[e],m=this.m_tree.GetUserData(_.proxyA),h=this.m_tree.GetUserData(_.proxyB);for(t.AddPair(m,h),++e;e<this.m_pairCount;){var l=this.m_pairBuffer[e];if(l.proxyA.m_id!=_.proxyA.m_id||l.proxyB.m_id!=_.proxyB.m_id)break;++e}}},t.prototype.Query=function(t,e){this.m_tree.Query(t,e)},t.prototype.RayCast=function(t,e){this.m_tree.RayCast(t,e)},t.prototype.GetTreeHeight=function(){return this.m_tree.GetHeight()},t.prototype.GetTreeBalance=function(){return this.m_tree.GetMaxBalance()},t.prototype.GetTreeQuality=function(){return this.m_tree.GetAreaRatio()},t.prototype.ShiftOrigin=function(t){this.m_tree.ShiftOrigin(t)},t.prototype.BufferMove=function(t){this.m_moveBuffer[this.m_moveCount]=t,++this.m_moveCount},t.prototype.UnBufferMove=function(t){var e=this.m_moveBuffer.indexOf(t);this.m_moveBuffer[e]=null},t}();e.b2BroadPhase=a,e.b2PairLessThan=s},function(t,e,i){"use strict";function s(t,e,i,s){for(var o=0,n=i.pointCount;o<n;++o){var r=i.points[o].id,_=r.key;t[o]=d.b2_removeState;for(var m=0,h=s.pointCount;m<h;++m)if(s.points[m].id.key==_){t[o]=d.b2_persistState;break}}for(var n=a.b2_maxManifoldPoints;o<n;++o)t[o]=d.b2_nullState;for(var o=0,n=s.pointCount;o<n;++o){var r=s.points[o].id,_=r.key;e[o]=d.b2_addState;for(var m=0,h=i.pointCount;m<h;++m)if(i.points[m].id.key==_){e[o]=d.b2_persistState;break}}for(var n=a.b2_maxManifoldPoints;o<n;++o)e[o]=d.b2_nullState}function o(t,e){var i=e.lowerBound.x-t.upperBound.x,s=e.lowerBound.y-t.upperBound.y,o=t.lowerBound.x-e.upperBound.x,n=t.lowerBound.y-e.upperBound.y;return!(i>0||s>0)&&!(o>0||n>0)}function n(t,e,i,s,o){var n=0,r=e[0],a=e[1],m=_.b2DotVV(i,r.v)-s,l=_.b2DotVV(i,a.v)-s;if(m<=0&&t[n++].Copy(r),l<=0&&t[n++].Copy(a),m*l<0){var c=m/(m-l),u=t[n].v;u.x=r.v.x+c*(a.v.x-r.v.x),u.y=r.v.y+c*(a.v.y-r.v.y);var p=t[n].id;p.cf.indexA=o,p.cf.indexB=r.id.cf.indexB,p.cf.typeA=h.e_vertex,p.cf.typeB=h.e_face,++n}return n}function r(t,e,i,s,o,n){var r=V.Reset();r.proxyA.SetShape(t,e),r.proxyB.SetShape(i,s),r.transformA.Copy(o),r.transformB.Copy(n),r.useRadii=!0;var _=x.Reset();_.count=0;var h=C.Reset();return m.b2Distance(h,_,r),h.distance<10*a.b2_epsilon}var a=i(3),_=i(4),m=i(5);!function(t){t[t.e_vertex=0]="e_vertex",t[t.e_face=1]="e_face"}(e.b2ContactFeatureType||(e.b2ContactFeatureType={}));var h=e.b2ContactFeatureType,l=function(){function t(t){this._id=null,this._indexA=0,this._indexB=0,this._typeA=0,this._typeB=0,this._id=t}return Object.defineProperty(t.prototype,"indexA",{get:function(){return this._indexA},set:function(t){this._indexA=t,this._id._key=4294967040&this._id._key|255&this._indexA},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"indexB",{get:function(){return this._indexB},set:function(t){this._indexB=t,this._id._key=4294902015&this._id._key|this._indexB<<8&65280},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"typeA",{get:function(){return this._typeA},set:function(t){this._typeA=t,this._id._key=4278255615&this._id._key|this._typeA<<16&16711680},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"typeB",{get:function(){return this._typeB},set:function(t){this._typeB=t,this._id._key=16777215&this._id._key|this._typeB<<24&4278190080},enumerable:!0,configurable:!0}),t}();e.b2ContactFeature=l;var c=function(){function t(){this.cf=null,this._key=0,this.cf=new l(this)}return t.prototype.Copy=function(t){return this.key=t.key,this},t.prototype.Clone=function(){return(new t).Copy(this)},Object.defineProperty(t.prototype,"key",{get:function(){return this._key},set:function(t){this._key=t,this.cf._indexA=255&this._key,this.cf._indexB=this._key>>8&255,this.cf._typeA=this._key>>16&255,this.cf._typeB=this._key>>24&255},enumerable:!0,configurable:!0}),t}();e.b2ContactID=c;var u=function(){function t(){this.localPoint=new _.b2Vec2,this.normalImpulse=0,this.tangentImpulse=0,this.id=new c}return t.MakeArray=function(e){return a.b2MakeArray(e,function(e){return new t})},t.prototype.Reset=function(){this.localPoint.SetZero(),this.normalImpulse=0,this.tangentImpulse=0,this.id.key=0},t.prototype.Copy=function(t){return this.localPoint.Copy(t.localPoint),this.normalImpulse=t.normalImpulse,this.tangentImpulse=t.tangentImpulse,this.id.Copy(t.id),this},t}();e.b2ManifoldPoint=u,function(t){t[t.e_unknown=-1]="e_unknown",t[t.e_circles=0]="e_circles",t[t.e_faceA=1]="e_faceA",t[t.e_faceB=2]="e_faceB"}(e.b2ManifoldType||(e.b2ManifoldType={}));var p=e.b2ManifoldType,b=function(){function t(){this.points=u.MakeArray(a.b2_maxManifoldPoints),this.localNormal=new _.b2Vec2,this.localPoint=new _.b2Vec2,this.type=p.e_unknown,this.pointCount=0}return t.prototype.Reset=function(){for(var t=0,e=a.b2_maxManifoldPoints;t<e;++t)a.ENABLE_ASSERTS&&a.b2Assert(this.points[t]instanceof u),this.points[t].Reset();this.localNormal.SetZero(),this.localPoint.SetZero(),this.type=p.e_unknown,this.pointCount=0},t.prototype.Copy=function(t){this.pointCount=t.pointCount;for(var e=0,i=a.b2_maxManifoldPoints;e<i;++e)a.ENABLE_ASSERTS&&a.b2Assert(this.points[e]instanceof u),this.points[e].Copy(t.points[e]);return this.localNormal.Copy(t.localNormal),this.localPoint.Copy(t.localPoint),this.type=t.type,this},t.prototype.Clone=function(){return(new t).Copy(this)},t}();e.b2Manifold=b;var y=function(){function t(){this.normal=new _.b2Vec2,this.points=_.b2Vec2.MakeArray(a.b2_maxManifoldPoints)}return t.prototype.Initialize=function(e,i,s,o,n){if(0!=e.pointCount)switch(e.type){case p.e_circles:this.normal.SetXY(1,0);var r=_.b2MulXV(i,e.localPoint,t.Initialize_s_pointA),m=_.b2MulXV(o,e.points[0].localPoint,t.Initialize_s_pointB);_.b2DistanceSquaredVV(r,m)>a.b2_epsilon_sq&&_.b2SubVV(m,r,this.normal).SelfNormalize();var h=_.b2AddVMulSV(r,s,this.normal,t.Initialize_s_cA),l=_.b2SubVMulSV(m,n,this.normal,t.Initialize_s_cB);_.b2MidVV(h,l,this.points[0]);break;case p.e_faceA:_.b2MulRV(i.q,e.localNormal,this.normal);for(var c=_.b2MulXV(i,e.localPoint,t.Initialize_s_planePoint),u=0,b=e.pointCount;u<b;++u){var y=_.b2MulXV(o,e.points[u].localPoint,t.Initialize_s_clipPoint),d=s-_.b2DotVV(_.b2SubVV(y,c,_.b2Vec2.s_t0),this.normal),h=_.b2AddVMulSV(y,d,this.normal,t.Initialize_s_cA),l=_.b2SubVMulSV(y,n,this.normal,t.Initialize_s_cB);_.b2MidVV(h,l,this.points[u])}break;case p.e_faceB:_.b2MulRV(o.q,e.localNormal,this.normal);for(var c=_.b2MulXV(o,e.localPoint,t.Initialize_s_planePoint),u=0,b=e.pointCount;u<b;++u){var y=_.b2MulXV(i,e.points[u].localPoint,t.Initialize_s_clipPoint),d=n-_.b2DotVV(_.b2SubVV(y,c,_.b2Vec2.s_t0),this.normal),l=_.b2AddVMulSV(y,d,this.normal,t.Initialize_s_cB),h=_.b2SubVMulSV(y,s,this.normal,t.Initialize_s_cA);_.b2MidVV(h,l,this.points[u])}this.normal.SelfNeg()}},t.Initialize_s_pointA=new _.b2Vec2,t.Initialize_s_pointB=new _.b2Vec2,t.Initialize_s_cA=new _.b2Vec2,t.Initialize_s_cB=new _.b2Vec2,t.Initialize_s_planePoint=new _.b2Vec2,t.Initialize_s_clipPoint=new _.b2Vec2,t}();e.b2WorldManifold=y,function(t){t[t.b2_nullState=0]="b2_nullState",t[t.b2_addState=1]="b2_addState",t[t.b2_persistState=2]="b2_persistState",t[t.b2_removeState=3]="b2_removeState"}(e.b2PointState||(e.b2PointState={}));var d=e.b2PointState;e.b2GetPointStates=s;var f=function(){function t(){this.v=new _.b2Vec2,this.id=new c}return t.MakeArray=function(e){return a.b2MakeArray(e,function(e){return new t})},t.prototype.Copy=function(t){return this.v.Copy(t.v),this.id.Copy(t.id),this},t}();e.b2ClipVertex=f;var A=function(){function t(){this.p1=new _.b2Vec2,this.p2=new _.b2Vec2,this.maxFraction=1}return t.prototype.Copy=function(t){return this.p1.Copy(t.p1),this.p2.Copy(t.p2),this.maxFraction=t.maxFraction,this},t}();e.b2RayCastInput=A;var v=function(){function t(){this.normal=new _.b2Vec2,this.fraction=0}return t.prototype.Copy=function(t){return this.normal.Copy(t.normal),this.fraction=t.fraction,this},t}();e.b2RayCastOutput=v;var S=function(){function t(){this.lowerBound=new _.b2Vec2,this.upperBound=new _.b2Vec2,this.m_cache_center=new _.b2Vec2,this.m_cache_extent=new _.b2Vec2}return t.prototype.Copy=function(t){return this.lowerBound.Copy(t.lowerBound),this.upperBound.Copy(t.upperBound),this},t.prototype.IsValid=function(){var t=this.upperBound.x-this.lowerBound.x,e=this.upperBound.y-this.lowerBound.y,i=t>=0&&e>=0;return i=i&&this.lowerBound.IsValid()&&this.upperBound.IsValid()},t.prototype.GetCenter=function(){return _.b2MidVV(this.lowerBound,this.upperBound,this.m_cache_center)},t.prototype.GetExtents=function(){return _.b2ExtVV(this.lowerBound,this.upperBound,this.m_cache_extent)},t.prototype.GetPerimeter=function(){var t=this.upperBound.x-this.lowerBound.x,e=this.upperBound.y-this.lowerBound.y;return 2*(t+e)},t.prototype.Combine1=function(t){return this.lowerBound.x=_.b2Min(this.lowerBound.x,t.lowerBound.x),this.lowerBound.y=_.b2Min(this.lowerBound.y,t.lowerBound.y),this.upperBound.x=_.b2Max(this.upperBound.x,t.upperBound.x),this.upperBound.y=_.b2Max(this.upperBound.y,t.upperBound.y),this},t.prototype.Combine2=function(t,e){return this.lowerBound.x=_.b2Min(t.lowerBound.x,e.lowerBound.x),this.lowerBound.y=_.b2Min(t.lowerBound.y,e.lowerBound.y),this.upperBound.x=_.b2Max(t.upperBound.x,e.upperBound.x),this.upperBound.y=_.b2Max(t.upperBound.y,e.upperBound.y),this},t.Combine=function(t,e,i){return i.Combine2(t,e),i},t.prototype.Contains=function(t){var e=!0;return e=e&&this.lowerBound.x<=t.lowerBound.x,e=e&&this.lowerBound.y<=t.lowerBound.y,e=e&&t.upperBound.x<=this.upperBound.x,e=e&&t.upperBound.y<=this.upperBound.y},t.prototype.RayCast=function(t,e){var i=-a.b2_maxFloat,s=a.b2_maxFloat,o=e.p1.x,n=e.p1.y,r=e.p2.x-e.p1.x,m=e.p2.y-e.p1.y,h=_.b2Abs(r),l=_.b2Abs(m),c=t.normal;if(h<a.b2_epsilon){if(o<this.lowerBound.x||this.upperBound.x<o)return!1}else{var u=1/r,p=(this.lowerBound.x-o)*u,b=(this.upperBound.x-o)*u,y=-1;if(p>b){var d=p;p=b,b=d,y=1}if(p>i&&(c.x=y,c.y=0,i=p),s=_.b2Min(s,b),i>s)return!1}if(l<a.b2_epsilon){if(n<this.lowerBound.y||this.upperBound.y<n)return!1}else{var u=1/m,p=(this.lowerBound.y-n)*u,b=(this.upperBound.y-n)*u,y=-1;if(p>b){var d=p;p=b,b=d,y=1}if(p>i&&(c.x=0,c.y=y,i=p),s=_.b2Min(s,b),i>s)return!1}return!(i<0||e.maxFraction<i)&&(t.fraction=i,!0)},t.prototype.TestOverlap=function(t){var e=t.lowerBound.x-this.upperBound.x,i=t.lowerBound.y-this.upperBound.y,s=this.lowerBound.x-t.upperBound.x,o=this.lowerBound.y-t.upperBound.y;return!(e>0||i>0)&&!(s>0||o>0)},t}();e.b2AABB=S,e.b2TestOverlapAABB=o,e.b2ClipSegmentToLine=n;var V=new m.b2DistanceInput,x=new m.b2SimplexCache,C=new m.b2DistanceOutput;e.b2TestOverlapShape=r},function(t,e){"use strict";function i(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i]}function s(t){return null}function o(t){}function n(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i]}function r(t){return parseInt(t,10)}function a(t){return Math.abs(parseInt(t,10))}function _(t,e){for(var i=[],s=0;s<t;++s)i.push(e(s));return i}function m(t){return _(t,function(t){return 0})}e.DEBUG=!0,e.ENABLE_ASSERTS=e.DEBUG,e.b2Assert=i,e.b2_maxFloat=1e37,e.b2_epsilon=1e-5,e.b2_epsilon_sq=e.b2_epsilon*e.b2_epsilon,e.b2_pi=3.14159265359,e.b2_maxManifoldPoints=2,e.b2_maxPolygonVertices=8,e.b2_aabbExtension=.1,e.b2_aabbMultiplier=2,e.b2_linearSlop=.008,e.b2_angularSlop=2/180*e.b2_pi,e.b2_polygonRadius=2*e.b2_linearSlop,e.b2_maxSubSteps=8,e.b2_maxTOIContacts=32,e.b2_velocityThreshold=1,e.b2_maxLinearCorrection=.2,e.b2_maxAngularCorrection=8/180*e.b2_pi,e.b2_maxTranslation=2,e.b2_maxTranslationSquared=e.b2_maxTranslation*e.b2_maxTranslation,e.b2_maxRotation=.5*e.b2_pi,e.b2_maxRotationSquared=e.b2_maxRotation*e.b2_maxRotation,e.b2_baumgarte=.2,e.b2_toiBaumgarte=.75,e.b2_timeToSleep=.5,e.b2_linearSleepTolerance=.01,e.b2_angularSleepTolerance=2/180*e.b2_pi,e.b2Alloc=s,e.b2Free=o,e.b2Log=n;var h=function(){function t(t,e,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),this.major=0,this.minor=0,this.revision=0,this.major=t,this.minor=e,this.revision=i}return t.prototype.toString=function(){return this.major+"."+this.minor+"."+this.revision},t}();e.b2Version=h,e.b2_version=new h(2,3,0),e.b2_changelist=251,e.b2ParseInt=r,e.b2ParseUInt=a,e.b2MakeArray=_,e.b2MakeNumberArray=m},function(t,e,i){"use strict";function s(t){return t<0?-t:t}function o(t,e){return t<e?t:e}function n(t,e){return t>e?t:e}function r(t,e,i){return t<e?e:t>i?i:t}function a(t,e){ut.ENABLE_ASSERTS&&ut.b2Assert(!1);var i=t[0];t[0]=e[0],e[0]=i}function _(t){return isFinite(t)}function m(t){return t*t}function h(t){return 1/Math.sqrt(t)}function l(t){return Math.sqrt(t)}function c(t,e){return Math.pow(t,e)}function u(t){return t*e.b2_pi_over_180}function p(t){return t*e.b2_180_over_pi}function b(t){return Math.cos(t)}function y(t){return Math.sin(t)}function d(t){return Math.acos(t)}function f(t){return Math.asin(t)}function A(t,e){return Math.atan2(t,e)}function v(t){return t|=t>>1&2147483647,t|=t>>2&1073741823,t|=t>>4&268435455,t|=t>>8&16777215,t|=t>>16&65535,t+1}function S(t){return t>0&&0==(t&t-1)}function V(){return 2*Math.random()-1}function x(t,e){return(e-t)*Math.random()+t}function C(t,e){return e.x=s(t.x),e.y=s(t.y),e}function B(t,e,i){return i.x=o(t.x,e.x),i.y=o(t.y,e.y),i}function g(t,e,i){return i.x=n(t.x,e.x),i.y=n(t.y,e.y),i}function w(t,e,i,s){return s.x=r(t.x,e.x,i.x),s.y=r(t.y,e.y,i.y),s}function M(t,e,i){var s=t.x,o=t.y,n=Math.cos(e),r=Math.sin(e);return i.x=n*s-r*o,i.y=r*s+n*o,i}function L(t,e){return t.x*e.x+t.y*e.y}function I(t,e){return t.x*e.y-t.y*e.x}function T(t,e,i){var s=t.x;return i.x=e*t.y,i.y=-e*s,i}function R(t,e){var i=t.x;return e.x=t.y,e.y=-i,e}function E(t,e,i){var s=e.x;return i.x=-t*e.y,i.y=t*s,i}function G(t,e){var i=t.x;return e.x=-t.y,e.y=i,e}function D(t,e,i){return i.x=t.x+e.x,i.y=t.y+e.y,i}function P(t,e,i){return i.x=t.x-e.x,i.y=t.y-e.y,i}function F(t,e,i){return i.x=e.x*t,i.y=e.y*t,i}function k(t,e,i,s){return s.x=t.x+e*i.x,s.y=t.y+e*i.y,s}function N(t,e,i,s){return s.x=t.x-e*i.x,s.y=t.y-e*i.y,s}function q(t,e,i,s){var o=i.x;return s.x=t.x-e*i.y,s.y=t.y+e*o,s}function z(t,e,i){return i.x=.5*(t.x+e.x),i.y=.5*(t.y+e.y),i}function J(t,e,i){return i.x=.5*(e.x-t.x),i.y=.5*(e.y-t.y),i}function j(t,e){return t.x==e.x&&t.y==e.y}function X(t,e){var i=t.x-e.x,s=t.y-e.y;return Math.sqrt(i*i+s*s)}function O(t,e){var i=t.x-e.x,s=t.y-e.y;return i*i+s*s}function Y(t,e){return e.x=-t.x,e.y=-t.y,e}function Z(t,e){return t.x*e.x+t.y*e.y+t.z*e.z}function H(t,e,i){var s=t.x,o=t.y,n=t.z,r=e.x,a=e.y,_=e.z;return i.x=o*_-n*a,i.y=n*r-s*_,i.z=s*a-o*r,i}function W(t,e){var i=t.ex,o=t.ey;return e.ex.x=s(i.x),e.ex.y=s(i.y),e.ey.x=s(o.x),e.ey.y=s(o.y),e}function U(t,e,i){var s=t.ex,o=t.ey,n=e.x,r=e.y;return i.x=s.x*n+o.x*r,i.y=s.y*n+o.y*r,i}function K(t,e,i){var s=t.ex,o=t.ey,n=e.x,r=e.y;return i.x=s.x*n+s.y*r,i.y=o.x*n+o.y*r,i}function Q(t,e,i){var s=t.ex,o=t.ey,n=e.ex,r=e.ey;return i.ex.x=s.x+n.x,i.ex.y=s.y+n.y,i.ey.x=o.x+r.x,i.ey.y=o.y+r.y,i}function $(t,e,i){var s=t.ex.x,o=t.ex.y,n=t.ey.x,r=t.ey.y,a=e.ex.x,_=e.ex.y,m=e.ey.x,h=e.ey.y;return i.ex.x=s*a+n*_,i.ex.y=o*a+r*_,i.ey.x=s*m+n*h,i.ey.y=o*m+r*h,i}function tt(t,e,i){var s=t.ex.x,o=t.ex.y,n=t.ey.x,r=t.ey.y,a=e.ex.x,_=e.ex.y,m=e.ey.x,h=e.ey.y;return i.ex.x=s*a+o*_,i.ex.y=n*a+r*_,i.ey.x=s*m+o*h,i.ey.y=n*m+r*h,i}function et(t,e,i){var s=e.x,o=e.y,n=e.z;return i.x=t.ex.x*s+t.ey.x*o+t.ez.x*n,i.y=t.ex.y*s+t.ey.y*o+t.ez.y*n,i.z=t.ex.z*s+t.ey.z*o+t.ez.z*n,i}function it(t,e,i,s,o){return o.x=t.ex.x*e+t.ey.x*i+t.ez.x*s,o.y=t.ex.y*e+t.ey.y*i+t.ez.y*s,o.z=t.ex.z*e+t.ey.z*i+t.ez.z*s,o}function st(t,e,i){var s=e.x,o=e.y;return i.x=t.ex.x*s+t.ey.x*o,i.y=t.ex.y*s+t.ey.y*o,i}function ot(t,e,i,s){return s.x=t.ex.x*e+t.ey.x*i,s.y=t.ex.y*e+t.ey.y*i,s}function nt(t,e,i){var s=t.c,o=t.s,n=e.c,r=e.s;return i.s=o*n+s*r,i.c=s*n-o*r,i}function rt(t,e,i){var s=t.c,o=t.s,n=e.c,r=e.s;return i.s=s*r-o*n,i.c=s*n+o*r,i}function at(t,e,i){var s=t.c,o=t.s,n=e.x,r=e.y;return i.x=s*n-o*r,i.y=o*n+s*r,i}function _t(t,e,i){var s=t.c,o=t.s,n=e.x,r=e.y;return i.x=s*n+o*r,i.y=-o*n+s*r,i}function mt(t,e,i){var s=t.q.c,o=t.q.s,n=e.x,r=e.y;return i.x=s*n-o*r+t.p.x,i.y=o*n+s*r+t.p.y,i}function ht(t,e,i){var s=t.q.c,o=t.q.s,n=e.x-t.p.x,r=e.y-t.p.y;return i.x=s*n+o*r,i.y=-o*n+s*r,i}function lt(t,e,i){return nt(t.q,e.q,i.q),D(at(t.q,e.p,i.p),t.p,i.p),i}function ct(t,e,i){return rt(t.q,e.q,i.q),_t(t.q,P(e.p,t.p,i.p),i.p),i}var ut=i(3);e.b2_pi_over_180=ut.b2_pi/180,e.b2_180_over_pi=180/ut.b2_pi,e.b2_two_pi=2*ut.b2_pi,e.b2Abs=s,e.b2Min=o,e.b2Max=n,e.b2Clamp=r,e.b2Swap=a,e.b2IsValid=_,e.b2Sq=m,e.b2InvSqrt=h,e.b2Sqrt=l,e.b2Pow=c,e.b2DegToRad=u,e.b2RadToDeg=p,e.b2Cos=b,e.b2Sin=y,e.b2Acos=d,e.b2Asin=f,e.b2Atan2=A,e.b2NextPowerOfTwo=v,e.b2IsPowerOfTwo=S,e.b2Random=V,e.b2RandomRange=x;var pt=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.x=t,this.y=e}return t.prototype.Clone=function(){return new t(this.x,this.y)},t.prototype.SetZero=function(){return this.x=0,this.y=0,this},t.prototype.SetXY=function(t,e){return this.x=t,this.y=e,this},t.prototype.Copy=function(t){return this.x=t.x,this.y=t.y,this},t.prototype.SelfAdd=function(t){return this.x+=t.x,this.y+=t.y,this},t.prototype.SelfAddXY=function(t,e){return this.x+=t,this.y+=e,this},t.prototype.SelfSub=function(t){return this.x-=t.x,this.y-=t.y,this},t.prototype.SelfSubXY=function(t,e){return this.x-=t,this.y-=e,this},t.prototype.SelfMul=function(t){return this.x*=t,this.y*=t,this},t.prototype.SelfMulAdd=function(t,e){return this.x+=t*e.x,this.y+=t*e.y,this},t.prototype.SelfMulSub=function(t,e){return this.x-=t*e.x,this.y-=t*e.y,this},t.prototype.Dot=function(t){return this.x*t.x+this.y*t.y},t.prototype.Cross=function(t){return this.x*t.y-this.y*t.x},t.prototype.GetLength=function(){var t=this.x,e=this.y;return Math.sqrt(t*t+e*e)},t.prototype.GetLengthSquared=function(){var t=this.x,e=this.y;return t*t+e*e},t.prototype.Normalize=function(){var t=this.GetLength();if(t>=ut.b2_epsilon){var e=1/t;this.x*=e,this.y*=e}return t},t.prototype.SelfNormalize=function(){var t=this.GetLength();if(t>=ut.b2_epsilon){var e=1/t;this.x*=e,this.y*=e}return this},t.prototype.SelfRotate=function(t){var e=Math.cos(t),i=Math.sin(t),s=this.x;return this.x=e*s-i*this.y,this.y=i*s+e*this.y,this},t.prototype.IsValid=function(){return isFinite(this.x)&&isFinite(this.y)},t.prototype.SelfCrossVS=function(t){var e=this.x;return this.x=t*this.y,this.y=-t*e,this},t.prototype.SelfCrossSV=function(t){var e=this.x;return this.x=-t*this.y,this.y=t*e,this},t.prototype.SelfMinV=function(t){return this.x=o(this.x,t.x),this.y=o(this.y,t.y),this},t.prototype.SelfMaxV=function(t){return this.x=n(this.x,t.x),this.y=n(this.y,t.y),this},t.prototype.SelfAbs=function(){return this.x=s(this.x),this.y=s(this.y),this},t.prototype.SelfNeg=function(){return this.x=-this.x,this.y=-this.y,this},t.prototype.SelfSkew=function(){var t=this.x;return this.x=-this.y,this.y=t,this},t.MakeArray=function(e){return ut.b2MakeArray(e,function(e){return new t})},t.ZERO=new t(0,0),t.UNITX=new t(1,0),t.UNITY=new t(0,1),t.s_t0=new t,t.s_t1=new t,t.s_t2=new t,t.s_t3=new t,t}();e.b2Vec2=pt,e.b2Vec2_zero=new pt(0,0),e.b2AbsV=C,e.b2MinV=B,e.b2MaxV=g,e.b2ClampV=w,e.b2RotateV=M,e.b2DotVV=L,e.b2CrossVV=I,e.b2CrossVS=T,e.b2CrossVOne=R,e.b2CrossSV=E,e.b2CrossOneV=G,e.b2AddVV=D,e.b2SubVV=P,e.b2MulSV=F,e.b2AddVMulSV=k,e.b2SubVMulSV=N,e.b2AddVCrossSV=q,e.b2MidVV=z,e.b2ExtVV=J,e.b2IsEqualToV=j,e.b2DistanceVV=X,e.b2DistanceSquaredVV=O,e.b2NegV=Y;var bt=function(){function t(t,e,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),this.x=t,this.y=e,this.z=i}return t.prototype.Clone=function(){return new t(this.x,this.y,this.z)},t.prototype.SetZero=function(){return this.x=0,this.y=0,this.z=0,this},t.prototype.SetXYZ=function(t,e,i){return this.x=t,this.y=e,this.z=i,this},t.prototype.Copy=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},t.prototype.SelfNeg=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},t.prototype.SelfAdd=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},t.prototype.SelfAddXYZ=function(t,e,i){return this.x+=t,this.y+=e,this.z+=i,this},t.prototype.SelfSub=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},t.prototype.SelfSubXYZ=function(t,e,i){return this.x-=t,this.y-=e,this.z-=i,this},t.prototype.SelfMul=function(t){return this.x*=t,this.y*=t,this.z*=t,this},t.ZERO=new t(0,0,0),t.s_t0=new t,t}();e.b2Vec3=bt,e.b2DotV3V3=Z,e.b2CrossV3V3=H;var yt=function(){function t(){this.ex=new pt(1,0),this.ey=new pt(0,1)}return t.prototype.Clone=function(){return(new t).Copy(this)},t.FromVV=function(e,i){return(new t).SetVV(e,i)},t.FromSSSS=function(e,i,s,o){return(new t).SetSSSS(e,i,s,o)},t.FromAngleRadians=function(e){return(new t).SetAngleRadians(e)},t.prototype.SetSSSS=function(t,e,i,s){return this.ex.SetXY(t,i),this.ey.SetXY(e,s),this},t.prototype.SetVV=function(t,e){return this.ex.Copy(t),this.ey.Copy(e),this},t.prototype.SetAngleRadians=function(t){var e=Math.cos(t),i=Math.sin(t);return this.ex.SetXY(e,i),this.ey.SetXY(-i,e),this},t.prototype.Copy=function(t){return this.ex.Copy(t.ex),this.ey.Copy(t.ey),this},t.prototype.SetIdentity=function(){return this.ex.SetXY(1,0),this.ey.SetXY(0,1),this},t.prototype.SetZero=function(){return this.ex.SetZero(),this.ey.SetZero(),this},t.prototype.GetAngleRadians=function(){return Math.atan2(this.ex.y,this.ex.x)},t.prototype.GetInverse=function(t){var e=this.ex.x,i=this.ey.x,s=this.ex.y,o=this.ey.y,n=e*o-i*s;return 0!=n&&(n=1/n),t.ex.x=n*o,t.ey.x=-n*i,t.ex.y=-n*s,t.ey.y=n*e,t},t.prototype.Solve=function(t,e,i){var s=this.ex.x,o=this.ey.x,n=this.ex.y,r=this.ey.y,a=s*r-o*n;return 0!=a&&(a=1/a),i.x=a*(r*t-o*e),i.y=a*(s*e-n*t),i},t.prototype.SelfAbs=function(){return this.ex.SelfAbs(),this.ey.SelfAbs(),this},t.prototype.SelfInv=function(){return this.GetInverse(this)},t.prototype.SelfAddM=function(t){return this.ex.SelfAdd(t.ex),this.ey.SelfAdd(t.ey),this},t.prototype.SelfSubM=function(t){return this.ex.SelfSub(t.ex),this.ey.SelfSub(t.ey),this},t.IDENTITY=new t,t}();e.b2Mat22=yt,e.b2AbsM=W,e.b2MulMV=U,e.b2MulTMV=K,e.b2AddMM=Q,e.b2MulMM=$,e.b2MulTMM=tt;var dt=function(){function t(){this.ex=new bt(1,0,0),this.ey=new bt(0,1,0),this.ez=new bt(0,0,1)}return t.prototype.Clone=function(){return(new t).Copy(this)},t.prototype.SetVVV=function(t,e,i){return this.ex.Copy(t),this.ey.Copy(e),this.ez.Copy(i),this},t.prototype.Copy=function(t){return this.ex.Copy(t.ex),this.ey.Copy(t.ey),this.ez.Copy(t.ez),this},t.prototype.SetIdentity=function(){return this.ex.SetXYZ(1,0,0),this.ey.SetXYZ(0,1,0),this.ez.SetXYZ(0,0,1),this},t.prototype.SetZero=function(){return this.ex.SetZero(),this.ey.SetZero(),this.ez.SetZero(),this},t.prototype.SelfAddM=function(t){return this.ex.SelfAdd(t.ex),this.ey.SelfAdd(t.ey),this.ez.SelfAdd(t.ez),this},t.prototype.Solve33=function(t,e,i,s){var o=this.ex.x,n=this.ex.y,r=this.ex.z,a=this.ey.x,_=this.ey.y,m=this.ey.z,h=this.ez.x,l=this.ez.y,c=this.ez.z,u=o*(_*c-m*l)+n*(m*h-a*c)+r*(a*l-_*h);return 0!=u&&(u=1/u),s.x=u*(t*(_*c-m*l)+e*(m*h-a*c)+i*(a*l-_*h)),s.y=u*(o*(e*c-i*l)+n*(i*h-t*c)+r*(t*l-e*h)),s.z=u*(o*(_*i-m*e)+n*(m*t-a*i)+r*(a*e-_*t)),s},t.prototype.Solve22=function(t,e,i){var s=this.ex.x,o=this.ey.x,n=this.ex.y,r=this.ey.y,a=s*r-o*n;return 0!=a&&(a=1/a),i.x=a*(r*t-o*e),i.y=a*(s*e-n*t),i},t.prototype.GetInverse22=function(t){var e=this.ex.x,i=this.ey.x,s=this.ex.y,o=this.ey.y,n=e*o-i*s;0!=n&&(n=1/n),t.ex.x=n*o,t.ey.x=-n*i,t.ex.z=0,t.ex.y=-n*s,t.ey.y=n*e,t.ey.z=0,t.ez.x=0,t.ez.y=0,t.ez.z=0},t.prototype.GetSymInverse33=function(t){var e=Z(this.ex,H(this.ey,this.ez,bt.s_t0));0!=e&&(e=1/e);var i=this.ex.x,s=this.ey.x,o=this.ez.x,n=this.ey.y,r=this.ez.y,a=this.ez.z;t.ex.x=e*(n*a-r*r),t.ex.y=e*(o*r-s*a),t.ex.z=e*(s*r-o*n),t.ey.x=t.ex.y,t.ey.y=e*(i*a-o*o),t.ey.z=e*(o*s-i*r),t.ez.x=t.ex.z,t.ez.y=t.ey.z,t.ez.z=e*(i*n-s*s)},t.IDENTITY=new t,t}();e.b2Mat33=dt,e.b2MulM33V3=et,e.b2MulM33XYZ=it,e.b2MulM33V2=st,e.b2MulM33XY=ot;var ft=function(){function t(t){void 0===t&&(t=0),this.s=0,this.c=1,t&&(this.s=Math.sin(t),this.c=Math.cos(t))}return t.prototype.Clone=function(){return(new t).Copy(this)},t.prototype.Copy=function(t){return this.s=t.s,this.c=t.c,this},t.prototype.SetAngleRadians=function(t){return this.s=Math.sin(t),this.c=Math.cos(t),this},t.prototype.SetIdentity=function(){return this.s=0,this.c=1,this},t.prototype.GetAngleRadians=function(){return Math.atan2(this.s,this.c)},t.prototype.GetXAxis=function(t){return t.x=this.c,t.y=this.s,t},t.prototype.GetYAxis=function(t){return t.x=-this.s,t.y=this.c,t},t.IDENTITY=new t,t}();e.b2Rot=ft,e.b2MulRR=nt,e.b2MulTRR=rt,e.b2MulRV=at,e.b2MulTRV=_t;var At=function(){function t(){this.p=new pt,this.q=new ft}return t.prototype.Clone=function(){return(new t).Copy(this)},t.prototype.Copy=function(t){return this.p.Copy(t.p),this.q.Copy(t.q),this},t.prototype.SetIdentity=function(){return this.p.SetZero(),this.q.SetIdentity(),this},t.prototype.SetPositionRotation=function(t,e){return this.p.Copy(t),this.q.Copy(e),this},t.prototype.SetPositionAngleRadians=function(t,e){return this.p.Copy(t),this.q.SetAngleRadians(e),this},t.prototype.SetPosition=function(t){return this.p.Copy(t),this},t.prototype.SetPositionXY=function(t,e){return this.p.SetXY(t,e),this},t.prototype.SetRotation=function(t){return this.q.Copy(t),this},t.prototype.SetRotationAngleRadians=function(t){return this.q.SetAngleRadians(t),this},t.prototype.GetPosition=function(){return this.p},t.prototype.GetRotation=function(){return this.q},t.prototype.GetRotationAngleRadians=function(){return this.q.GetAngleRadians()},t.prototype.GetAngleRadians=function(){return this.q.GetAngleRadians()},t.IDENTITY=new t,t}();e.b2Transform=At,e.b2MulXV=mt,e.b2MulTXV=ht,e.b2MulXX=lt,e.b2MulTXX=ct;var vt=function(){function t(){this.localCenter=new pt,this.c0=new pt,this.c=new pt,this.a0=0,this.a=0,this.alpha0=0}return t.prototype.Clone=function(){return(new t).Copy(this)},t.prototype.Copy=function(t){return this.localCenter.Copy(t.localCenter),this.c0.Copy(t.c0),this.c.Copy(t.c),this.a0=t.a0,this.a=t.a,this.alpha0=t.alpha0,this},t.prototype.GetTransform=function(t,e){var i=1-e;t.p.x=i*this.c0.x+e*this.c.x,t.p.y=i*this.c0.y+e*this.c.y;var s=i*this.a0+e*this.a;return t.q.SetAngleRadians(s),t.p.SelfSub(at(t.q,this.localCenter,pt.s_t0)),t},t.prototype.Advance=function(t){ut.ENABLE_ASSERTS&&ut.b2Assert(this.alpha0<1);var e=(t-this.alpha0)/(1-this.alpha0),i=1-e;this.c0.x=i*this.c0.x+e*this.c.x,this.c0.y=i*this.c0.y+e*this.c.y,this.a0=i*this.a0+e*this.a,this.alpha0=t},t.prototype.Normalize=function(){var t=e.b2_two_pi*Math.floor(this.a0/e.b2_two_pi);this.a0-=t,this.a-=t},t}();e.b2Sweep=vt},function(t,e,i){"use strict";function s(t,i,s){++e.b2_gjkCalls;var r=s.proxyA,a=s.proxyB,_=s.transformA,m=s.transformB,h=c;h.ReadCache(i,r,_,a,m);for(var l=h.m_vertices,v=20,S=u,V=p,x=0,C=o.b2_maxFloat,B=C,g=0;g<v;){x=h.m_count;for(var w=0;w<x;++w)S[w]=l[w].indexA,V[w]=l[w].indexB;switch(h.m_count){case 1:break;case 2:h.Solve2();break;case 3:h.Solve3();break;default:o.ENABLE_ASSERTS&&o.b2Assert(!1)}if(3==h.m_count)break;var M=h.GetClosestPoint(b);B=M.GetLengthSquared(),C=B;var L=h.GetSearchDirection(y);if(L.GetLengthSquared()<o.b2_epsilon_sq)break;var I=l[h.m_count];I.indexA=r.GetSupport(n.b2MulTRV(_.q,n.b2NegV(L,n.b2Vec2.s_t0),f)),n.b2MulXV(_,r.GetVertex(I.indexA),I.wA),I.indexB=a.GetSupport(n.b2MulTRV(m.q,L,A)),n.b2MulXV(m,a.GetVertex(I.indexB),I.wB),n.b2SubVV(I.wB,I.wA,I.w),++g,++e.b2_gjkIters;for(var T=!1,w=0;w<x;++w)if(I.indexA==S[w]&&I.indexB==V[w]){T=!0;break}if(T)break;++h.m_count}if(e.b2_gjkMaxIters=n.b2Max(e.b2_gjkMaxIters,g),h.GetWitnessPoints(t.pointA,t.pointB),t.distance=n.b2DistanceVV(t.pointA,t.pointB),t.iterations=g,h.WriteCache(i),s.useRadii){var R=r.m_radius,E=a.m_radius;if(t.distance>R+E&&t.distance>o.b2_epsilon){t.distance-=R+E;var G=n.b2SubVV(t.pointB,t.pointA,d);G.Normalize(),t.pointA.SelfMulAdd(R,G),t.pointB.SelfMulSub(E,G)}else{var M=n.b2MidVV(t.pointA,t.pointB,b);t.pointA.Copy(M),t.pointB.Copy(M),t.distance=0}}}var o=i(3),n=i(4),r=function(){function t(){this.m_buffer=n.b2Vec2.MakeArray(2),this.m_vertices=null,this.m_count=0,this.m_radius=0}return t.prototype.Reset=function(){return this.m_vertices=null,this.m_count=0,this.m_radius=0,this},t.prototype.SetShape=function(t,e){t.SetupDistanceProxy(this,e)},t.prototype.GetSupport=function(t){for(var e=0,i=n.b2DotVV(this.m_vertices[0],t),s=1;s<this.m_count;++s){var o=n.b2DotVV(this.m_vertices[s],t);o>i&&(e=s,i=o)}return e},t.prototype.GetSupportVertex=function(t){for(var e=0,i=n.b2DotVV(this.m_vertices[0],t),s=1;s<this.m_count;++s){var o=n.b2DotVV(this.m_vertices[s],t);o>i&&(e=s,i=o)}return this.m_vertices[e]},t.prototype.GetVertexCount=function(){return this.m_count},t.prototype.GetVertex=function(t){return o.ENABLE_ASSERTS&&o.b2Assert(0<=t&&t<this.m_count),this.m_vertices[t]},t}();e.b2DistanceProxy=r;var a=function(){function t(){this.metric=0,this.count=0,this.indexA=o.b2MakeNumberArray(3),this.indexB=o.b2MakeNumberArray(3)}return t.prototype.Reset=function(){return this.metric=0,this.count=0,this},t}();e.b2SimplexCache=a;var _=function(){function t(){this.proxyA=new r,this.proxyB=new r,this.transformA=new n.b2Transform,this.transformB=new n.b2Transform,this.useRadii=!1}return t.prototype.Reset=function(){return this.proxyA.Reset(),this.proxyB.Reset(),this.transformA.SetIdentity(),this.transformB.SetIdentity(),this.useRadii=!1,this},t}();e.b2DistanceInput=_;var m=function(){function t(){this.pointA=new n.b2Vec2,this.pointB=new n.b2Vec2,this.distance=0,this.iterations=0}return t.prototype.Reset=function(){return this.pointA.SetZero(),
this.pointB.SetZero(),this.distance=0,this.iterations=0,this},t}();e.b2DistanceOutput=m,e.b2_gjkCalls=0,e.b2_gjkIters=0,e.b2_gjkMaxIters=0;var h=function(){function t(){this.wA=new n.b2Vec2,this.wB=new n.b2Vec2,this.w=new n.b2Vec2,this.a=0,this.indexA=0,this.indexB=0}return t.prototype.Copy=function(t){return this.wA.Copy(t.wA),this.wB.Copy(t.wB),this.w.Copy(t.w),this.a=t.a,this.indexA=t.indexA,this.indexB=t.indexB,this},t}();e.b2SimplexVertex=h;var l=function(){function t(){this.m_v1=new h,this.m_v2=new h,this.m_v3=new h,this.m_vertices=new Array(3),this.m_count=0,this.m_vertices[0]=this.m_v1,this.m_vertices[1]=this.m_v2,this.m_vertices[2]=this.m_v3}return t.prototype.ReadCache=function(t,e,i,s,r){o.ENABLE_ASSERTS&&o.b2Assert(0<=t.count&&t.count<=3),this.m_count=t.count;for(var a=this.m_vertices,_=0;_<this.m_count;++_){var m=a[_];m.indexA=t.indexA[_],m.indexB=t.indexB[_];var h=e.GetVertex(m.indexA),l=s.GetVertex(m.indexB);n.b2MulXV(i,h,m.wA),n.b2MulXV(r,l,m.wB),n.b2SubVV(m.wB,m.wA,m.w),m.a=0}if(this.m_count>1){var c=t.metric,u=this.GetMetric();(u<.5*c||2*c<u||u<o.b2_epsilon)&&(this.m_count=0)}if(0==this.m_count){var m=a[0];m.indexA=0,m.indexB=0;var h=e.GetVertex(0),l=s.GetVertex(0);n.b2MulXV(i,h,m.wA),n.b2MulXV(r,l,m.wB),n.b2SubVV(m.wB,m.wA,m.w),m.a=1,this.m_count=1}},t.prototype.WriteCache=function(t){t.metric=this.GetMetric(),t.count=this.m_count;for(var e=this.m_vertices,i=0;i<this.m_count;++i)t.indexA[i]=e[i].indexA,t.indexB[i]=e[i].indexB},t.prototype.GetSearchDirection=function(t){switch(this.m_count){case 1:return n.b2NegV(this.m_v1.w,t);case 2:var e=n.b2SubVV(this.m_v2.w,this.m_v1.w,t),i=n.b2CrossVV(e,n.b2NegV(this.m_v1.w,n.b2Vec2.s_t0));return i>0?n.b2CrossOneV(e,t):n.b2CrossVOne(e,t);default:return o.ENABLE_ASSERTS&&o.b2Assert(!1),t.SetZero()}},t.prototype.GetClosestPoint=function(t){switch(this.m_count){case 0:return o.ENABLE_ASSERTS&&o.b2Assert(!1),t.SetZero();case 1:return t.Copy(this.m_v1.w);case 2:return t.SetXY(this.m_v1.a*this.m_v1.w.x+this.m_v2.a*this.m_v2.w.x,this.m_v1.a*this.m_v1.w.y+this.m_v2.a*this.m_v2.w.y);case 3:return t.SetZero();default:return o.ENABLE_ASSERTS&&o.b2Assert(!1),t.SetZero()}},t.prototype.GetWitnessPoints=function(t,e){switch(this.m_count){case 0:o.ENABLE_ASSERTS&&o.b2Assert(!1);break;case 1:t.Copy(this.m_v1.wA),e.Copy(this.m_v1.wB);break;case 2:t.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x,t.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y,e.x=this.m_v1.a*this.m_v1.wB.x+this.m_v2.a*this.m_v2.wB.x,e.y=this.m_v1.a*this.m_v1.wB.y+this.m_v2.a*this.m_v2.wB.y;break;case 3:e.x=t.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x+this.m_v3.a*this.m_v3.wA.x,e.y=t.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y+this.m_v3.a*this.m_v3.wA.y;break;default:o.ENABLE_ASSERTS&&o.b2Assert(!1)}},t.prototype.GetMetric=function(){switch(this.m_count){case 0:return o.ENABLE_ASSERTS&&o.b2Assert(!1),0;case 1:return 0;case 2:return n.b2DistanceVV(this.m_v1.w,this.m_v2.w);case 3:return n.b2CrossVV(n.b2SubVV(this.m_v2.w,this.m_v1.w,n.b2Vec2.s_t0),n.b2SubVV(this.m_v3.w,this.m_v1.w,n.b2Vec2.s_t1));default:return o.ENABLE_ASSERTS&&o.b2Assert(!1),0}},t.prototype.Solve2=function(){var e=this.m_v1.w,i=this.m_v2.w,s=n.b2SubVV(i,e,t.s_e12),o=-n.b2DotVV(e,s);if(o<=0)return this.m_v1.a=1,void(this.m_count=1);var r=n.b2DotVV(i,s);if(r<=0)return this.m_v2.a=1,this.m_count=1,void this.m_v1.Copy(this.m_v2);var a=1/(r+o);this.m_v1.a=r*a,this.m_v2.a=o*a,this.m_count=2},t.prototype.Solve3=function(){var e=this.m_v1.w,i=this.m_v2.w,s=this.m_v3.w,o=n.b2SubVV(i,e,t.s_e12),r=n.b2DotVV(e,o),a=n.b2DotVV(i,o),_=a,m=-r,h=n.b2SubVV(s,e,t.s_e13),l=n.b2DotVV(e,h),c=n.b2DotVV(s,h),u=c,p=-l,b=n.b2SubVV(s,i,t.s_e23),y=n.b2DotVV(i,b),d=n.b2DotVV(s,b),f=d,A=-y,v=n.b2CrossVV(o,h),S=v*n.b2CrossVV(i,s),V=v*n.b2CrossVV(s,e),x=v*n.b2CrossVV(e,i);if(m<=0&&p<=0)return this.m_v1.a=1,void(this.m_count=1);if(_>0&&m>0&&x<=0){var C=1/(_+m);return this.m_v1.a=_*C,this.m_v2.a=m*C,void(this.m_count=2)}if(u>0&&p>0&&V<=0){var B=1/(u+p);return this.m_v1.a=u*B,this.m_v3.a=p*B,this.m_count=2,void this.m_v2.Copy(this.m_v3)}if(_<=0&&A<=0)return this.m_v2.a=1,this.m_count=1,void this.m_v1.Copy(this.m_v2);if(u<=0&&f<=0)return this.m_v3.a=1,this.m_count=1,void this.m_v1.Copy(this.m_v3);if(f>0&&A>0&&S<=0){var g=1/(f+A);return this.m_v2.a=f*g,this.m_v3.a=A*g,this.m_count=2,void this.m_v1.Copy(this.m_v3)}var w=1/(S+V+x);this.m_v1.a=S*w,this.m_v2.a=V*w,this.m_v3.a=x*w,this.m_count=3},t.s_e12=new n.b2Vec2,t.s_e13=new n.b2Vec2,t.s_e23=new n.b2Vec2,t}();e.b2Simplex=l;var c=new l,u=o.b2MakeNumberArray(3),p=o.b2MakeNumberArray(3),b=new n.b2Vec2,y=new n.b2Vec2,d=new n.b2Vec2,f=new n.b2Vec2,A=new n.b2Vec2;e.b2Distance=s},function(t,e,i){"use strict";var s=i(3),o=i(4),n=i(2),r=i(7),a=function(){function t(t){void 0===t&&(t=0),this.m_id=0,this.aabb=new n.b2AABB,this.userData=null,this.parent=null,this.child1=null,this.child2=null,this.height=0,this.m_id=t}return t.prototype.IsLeaf=function(){return null==this.child1},t}();e.b2TreeNode=a;var _=function(){function t(){this.m_root=null,this.m_freeList=null,this.m_path=0,this.m_insertionCount=0}return t.prototype.GetUserData=function(t){return s.ENABLE_ASSERTS&&s.b2Assert(null!=t),t.userData},t.prototype.GetFatAABB=function(t){return s.ENABLE_ASSERTS&&s.b2Assert(null!=t),t.aabb},t.prototype.Query=function(e,i){if(null!=this.m_root){var s=t.s_stack.Reset();for(s.Push(this.m_root);s.GetCount()>0;){var o=s.Pop();if(null!=o&&o.aabb.TestOverlap(i))if(o.IsLeaf()){var n=e(o);if(0==n)return}else s.Push(o.child1),s.Push(o.child2)}}},t.prototype.RayCast=function(e,i){if(null!=this.m_root){var r=i.p1,a=i.p2,_=o.b2SubVV(a,r,t.s_r);s.ENABLE_ASSERTS&&s.b2Assert(_.GetLengthSquared()>0),_.Normalize();var m=o.b2CrossOneV(_,t.s_v),h=o.b2AbsV(m,t.s_abs_v),l=i.maxFraction,c=t.s_segmentAABB,u=r.x+l*(a.x-r.x),p=r.y+l*(a.y-r.y);c.lowerBound.x=o.b2Min(r.x,u),c.lowerBound.y=o.b2Min(r.y,p),c.upperBound.x=o.b2Max(r.x,u),c.upperBound.y=o.b2Max(r.y,p);var b=t.s_stack.Reset();for(b.Push(this.m_root);b.GetCount()>0;){var y=b.Pop();if(null!=y&&0!=n.b2TestOverlapAABB(y.aabb,c)){var d=y.aabb.GetCenter(),f=y.aabb.GetExtents(),A=o.b2Abs(o.b2DotVV(m,o.b2SubVV(r,d,o.b2Vec2.s_t0)))-o.b2DotVV(h,f);if(!(A>0))if(y.IsLeaf()){var v=t.s_subInput;v.p1.Copy(i.p1),v.p2.Copy(i.p2),v.maxFraction=l;var S=e(v,y);if(0==S)return;S>0&&(l=S,u=r.x+l*(a.x-r.x),p=r.y+l*(a.y-r.y),c.lowerBound.x=o.b2Min(r.x,u),c.lowerBound.y=o.b2Min(r.y,p),c.upperBound.x=o.b2Max(r.x,u),c.upperBound.y=o.b2Max(r.y,p))}else b.Push(y.child1),b.Push(y.child2)}}}},t.prototype.AllocateNode=function(){if(this.m_freeList){var e=this.m_freeList;return this.m_freeList=e.parent,e.parent=null,e.child1=null,e.child2=null,e.height=0,e.userData=null,e}return new a((t.s_node_id++))},t.prototype.FreeNode=function(t){t.parent=this.m_freeList,t.height=-1,this.m_freeList=t},t.prototype.CreateProxy=function(t,e){var i=this.AllocateNode(),o=s.b2_aabbExtension,n=s.b2_aabbExtension;return i.aabb.lowerBound.x=t.lowerBound.x-o,i.aabb.lowerBound.y=t.lowerBound.y-n,i.aabb.upperBound.x=t.upperBound.x+o,i.aabb.upperBound.y=t.upperBound.y+n,i.userData=e,i.height=0,this.InsertLeaf(i),i},t.prototype.DestroyProxy=function(t){s.ENABLE_ASSERTS&&s.b2Assert(t.IsLeaf()),this.RemoveLeaf(t),this.FreeNode(t)},t.prototype.MoveProxy=function(t,e,i){if(s.ENABLE_ASSERTS&&s.b2Assert(t.IsLeaf()),t.aabb.Contains(e))return!1;this.RemoveLeaf(t);var o=s.b2_aabbExtension+s.b2_aabbMultiplier*(i.x>0?i.x:-i.x),n=s.b2_aabbExtension+s.b2_aabbMultiplier*(i.y>0?i.y:-i.y);return t.aabb.lowerBound.x=e.lowerBound.x-o,t.aabb.lowerBound.y=e.lowerBound.y-n,t.aabb.upperBound.x=e.upperBound.x+o,t.aabb.upperBound.y=e.upperBound.y+n,this.InsertLeaf(t),!0},t.prototype.InsertLeaf=function(e){if(++this.m_insertionCount,null==this.m_root)return this.m_root=e,void(this.m_root.parent=null);for(var i,n,r=e.aabb,a=(r.GetCenter(),this.m_root);0==a.IsLeaf();){i=a.child1,n=a.child2;var _=a.aabb.GetPerimeter(),m=t.s_combinedAABB;m.Combine2(a.aabb,r);var h,l,c,u=m.GetPerimeter(),p=2*u,b=2*(u-_),y=t.s_aabb;i.IsLeaf()?(y.Combine2(r,i.aabb),h=y.GetPerimeter()+b):(y.Combine2(r,i.aabb),l=i.aabb.GetPerimeter(),c=y.GetPerimeter(),h=c-l+b);var d;if(n.IsLeaf()?(y.Combine2(r,n.aabb),d=y.GetPerimeter()+b):(y.Combine2(r,n.aabb),l=n.aabb.GetPerimeter(),c=y.GetPerimeter(),d=c-l+b),p<h&&p<d)break;a=h<d?i:n}var f=a,A=f.parent,v=this.AllocateNode();for(v.parent=A,v.userData=null,v.aabb.Combine2(r,f.aabb),v.height=f.height+1,A?(A.child1==f?A.child1=v:A.child2=v,v.child1=f,v.child2=e,f.parent=v,e.parent=v):(v.child1=f,v.child2=e,f.parent=v,e.parent=v,this.m_root=v),a=e.parent;null!=a;)a=this.Balance(a),i=a.child1,n=a.child2,s.ENABLE_ASSERTS&&s.b2Assert(null!=i),s.ENABLE_ASSERTS&&s.b2Assert(null!=n),a.height=1+o.b2Max(i.height,n.height),a.aabb.Combine2(i.aabb,n.aabb),a=a.parent},t.prototype.RemoveLeaf=function(t){if(t==this.m_root)return void(this.m_root=null);var e,i=t.parent,s=i.parent;if(e=i.child1==t?i.child2:i.child1,s){s.child1==i?s.child1=e:s.child2=e,e.parent=s,this.FreeNode(i);for(var n=s;n;){n=this.Balance(n);var r=n.child1,a=n.child2;n.aabb.Combine2(r.aabb,a.aabb),n.height=1+o.b2Max(r.height,a.height),n=n.parent}}else this.m_root=e,e.parent=null,this.FreeNode(i)},t.prototype.Balance=function(t){if(s.ENABLE_ASSERTS&&s.b2Assert(null!=t),t.IsLeaf()||t.height<2)return t;var e=t.child1,i=t.child2,n=i.height-e.height;if(n>1){var r=i.child1,a=i.child2;return i.child1=t,i.parent=t.parent,t.parent=i,null!=i.parent?i.parent.child1==t?i.parent.child1=i:(s.ENABLE_ASSERTS&&s.b2Assert(i.parent.child2==t),i.parent.child2=i):this.m_root=i,r.height>a.height?(i.child2=r,t.child2=a,a.parent=t,t.aabb.Combine2(e.aabb,a.aabb),i.aabb.Combine2(t.aabb,r.aabb),t.height=1+o.b2Max(e.height,a.height),i.height=1+o.b2Max(t.height,r.height)):(i.child2=a,t.child2=r,r.parent=t,t.aabb.Combine2(e.aabb,r.aabb),i.aabb.Combine2(t.aabb,a.aabb),t.height=1+o.b2Max(e.height,r.height),i.height=1+o.b2Max(t.height,a.height)),i}if(n<-1){var _=e.child1,m=e.child2;return e.child1=t,e.parent=t.parent,t.parent=e,null!=e.parent?e.parent.child1==t?e.parent.child1=e:(s.ENABLE_ASSERTS&&s.b2Assert(e.parent.child2==t),e.parent.child2=e):this.m_root=e,_.height>m.height?(e.child2=_,t.child1=m,m.parent=t,t.aabb.Combine2(i.aabb,m.aabb),e.aabb.Combine2(t.aabb,_.aabb),t.height=1+o.b2Max(i.height,m.height),e.height=1+o.b2Max(t.height,_.height)):(e.child2=m,t.child1=_,_.parent=t,t.aabb.Combine2(i.aabb,_.aabb),e.aabb.Combine2(t.aabb,m.aabb),t.height=1+o.b2Max(i.height,_.height),e.height=1+o.b2Max(t.height,m.height)),e}return t},t.prototype.GetHeight=function(){return null==this.m_root?0:this.m_root.height},t.prototype.GetAreaRatio=function(){if(null==this.m_root)return 0;var t=this.m_root,e=t.aabb.GetPerimeter(),i=function(t){if(null==t)return 0;if(t.IsLeaf())return 0;var e=t.aabb.GetPerimeter();return e+=i(t.child1),e+=i(t.child2)},s=i(this.m_root);return s/e},t.prototype.ComputeHeightNode=function(t){if(t.IsLeaf())return 0;var e=this.ComputeHeightNode(t.child1),i=this.ComputeHeightNode(t.child2);return 1+o.b2Max(e,i)},t.prototype.ComputeHeight=function(){var t=this.ComputeHeightNode(this.m_root);return t},t.prototype.ValidateStructure=function(t){if(null!=t){t==this.m_root&&s.ENABLE_ASSERTS&&s.b2Assert(null==t.parent);var e=t,i=e.child1,o=e.child2;if(e.IsLeaf())return s.ENABLE_ASSERTS&&s.b2Assert(null==i),s.ENABLE_ASSERTS&&s.b2Assert(null==o),void(s.ENABLE_ASSERTS&&s.b2Assert(0==e.height));s.ENABLE_ASSERTS&&s.b2Assert(i.parent==t),s.ENABLE_ASSERTS&&s.b2Assert(o.parent==t),this.ValidateStructure(i),this.ValidateStructure(o)}},t.prototype.ValidateMetrics=function(e){if(null!=e){var i=e,n=i.child1,r=i.child2;if(i.IsLeaf())return s.ENABLE_ASSERTS&&s.b2Assert(null==n),s.ENABLE_ASSERTS&&s.b2Assert(null==r),void(s.ENABLE_ASSERTS&&s.b2Assert(0==i.height));var a,_=n.height,m=r.height;a=1+o.b2Max(_,m),s.ENABLE_ASSERTS&&s.b2Assert(i.height==a);var h=t.s_aabb;h.Combine2(n.aabb,r.aabb),s.ENABLE_ASSERTS&&s.b2Assert(h.lowerBound==i.aabb.lowerBound),s.ENABLE_ASSERTS&&s.b2Assert(h.upperBound==i.aabb.upperBound),this.ValidateMetrics(n),this.ValidateMetrics(r)}},t.prototype.Validate=function(){this.ValidateStructure(this.m_root),this.ValidateMetrics(this.m_root);for(var t=0,e=this.m_freeList;null!=e;)e=e.parent,++t;s.ENABLE_ASSERTS&&s.b2Assert(this.GetHeight()==this.ComputeHeight())},t.prototype.GetMaxBalance=function(){var t=function(t,e){if(null==t)return e;if(t.height<=1)return e;s.ENABLE_ASSERTS&&s.b2Assert(0==t.IsLeaf());var i=t.child1,n=t.child2,r=o.b2Abs(n.height-i.height);return o.b2Max(e,r)},e=t(this.m_root,0);return e},t.prototype.RebuildBottomUp=function(){this.Validate()},t.prototype.ShiftOrigin=function(t){var e=function(t,i){if(null!=t&&!(t.height<=1)){s.ENABLE_ASSERTS&&s.b2Assert(0==t.IsLeaf());var o=t.child1,n=t.child2;e(o,i),e(n,i),t.aabb.lowerBound.SelfSub(i),t.aabb.upperBound.SelfSub(i)}};e(this.m_root,t)},t.s_stack=new r.b2GrowableStack(256),t.s_r=new o.b2Vec2,t.s_v=new o.b2Vec2,t.s_abs_v=new o.b2Vec2,t.s_segmentAABB=new n.b2AABB,t.s_subInput=new n.b2RayCastInput,t.s_combinedAABB=new n.b2AABB,t.s_aabb=new n.b2AABB,t.s_node_id=0,t}();e.b2DynamicTree=_},function(t,e){"use strict";var i=function(){function t(t){this.m_stack=[],this.m_count=0,this.m_stack=new Array(t),this.m_count=0}return t.prototype.Reset=function(){return this.m_count=0,this},t.prototype.Push=function(t){this.m_stack[this.m_count]=t,this.m_count++},t.prototype.Pop=function(){this.m_count--;var t=this.m_stack[this.m_count];return this.m_stack[this.m_count]=null,t},t.prototype.GetCount=function(){return this.m_count},t}();e.b2GrowableStack=i},function(t,e,i){"use strict";function s(t,e,i,s,o){t.pointCount=0;var r=n.b2MulXV(i,e.m_p,_),h=n.b2MulXV(o,s.m_p,m),l=n.b2DistanceSquaredVV(r,h),c=e.m_radius+s.m_radius;l>c*c||(t.type=a.b2ManifoldType.e_circles,t.localPoint.Copy(e.m_p),t.localNormal.SetZero(),t.pointCount=1,t.points[0].localPoint.Copy(s.m_p),t.points[0].id.key=0)}function o(t,e,i,s,o){t.pointCount=0;for(var _=n.b2MulXV(o,s.m_p,h),m=n.b2MulTXV(i,_,l),u=0,p=-r.b2_maxFloat,b=e.m_radius+s.m_radius,y=e.m_count,d=e.m_vertices,f=e.m_normals,A=0;A<y;++A){var v=n.b2DotVV(f[A],n.b2SubVV(m,d[A],n.b2Vec2.s_t0));if(v>b)return;v>p&&(p=v,u=A)}var S=u,V=(S+1)%y,x=d[S],C=d[V];if(p<r.b2_epsilon)return t.pointCount=1,t.type=a.b2ManifoldType.e_faceA,t.localNormal.Copy(f[u]),n.b2MidVV(x,C,t.localPoint),t.points[0].localPoint.Copy(s.m_p),void(t.points[0].id.key=0);var B=n.b2DotVV(n.b2SubVV(m,x,n.b2Vec2.s_t0),n.b2SubVV(C,x,n.b2Vec2.s_t1)),g=n.b2DotVV(n.b2SubVV(m,C,n.b2Vec2.s_t0),n.b2SubVV(x,C,n.b2Vec2.s_t1));if(B<=0){if(n.b2DistanceSquaredVV(m,x)>b*b)return;t.pointCount=1,t.type=a.b2ManifoldType.e_faceA,n.b2SubVV(m,x,t.localNormal).SelfNormalize(),t.localPoint.Copy(x),t.points[0].localPoint.Copy(s.m_p),t.points[0].id.key=0}else if(g<=0){if(n.b2DistanceSquaredVV(m,C)>b*b)return;t.pointCount=1,t.type=a.b2ManifoldType.e_faceA,n.b2SubVV(m,C,t.localNormal).SelfNormalize(),t.localPoint.Copy(C),t.points[0].localPoint.Copy(s.m_p),t.points[0].id.key=0}else{var w=n.b2MidVV(x,C,c);if(p=n.b2DotVV(n.b2SubVV(m,w,n.b2Vec2.s_t1),f[S]),p>b)return;t.pointCount=1,t.type=a.b2ManifoldType.e_faceA,t.localNormal.Copy(f[S]).SelfNormalize(),t.localPoint.Copy(w),t.points[0].localPoint.Copy(s.m_p),t.points[0].id.key=0}}var n=i(4),r=i(3),a=i(2),_=new n.b2Vec2,m=new n.b2Vec2;e.b2CollideCircles=s;var h=new n.b2Vec2,l=new n.b2Vec2,c=new n.b2Vec2;e.b2CollidePolygonAndCircle=o},function(t,e,i){"use strict";function s(t,e,i,s,o){t.pointCount=0;var y=n.b2MulTXV(i,n.b2MulXV(o,s.m_p,n.b2Vec2.s_t0),_),d=e.m_vertex1,f=e.m_vertex2,A=n.b2SubVV(f,d,m),v=n.b2DotVV(A,n.b2SubVV(f,y,n.b2Vec2.s_t0)),S=n.b2DotVV(A,n.b2SubVV(y,d,n.b2Vec2.s_t0)),V=e.m_radius+s.m_radius,x=b;if(x.cf.indexB=0,x.cf.typeB=a.b2ContactFeatureType.e_vertex,S<=0){var C=d,B=n.b2SubVV(y,C,h),g=n.b2DotVV(B,B);if(g>V*V)return;if(e.m_hasVertex0){var w=e.m_vertex0,M=d,L=n.b2SubVV(M,w,l),I=n.b2DotVV(L,n.b2SubVV(M,y,n.b2Vec2.s_t0));if(I>0)return}return x.cf.indexA=0,x.cf.typeA=a.b2ContactFeatureType.e_vertex,t.pointCount=1,t.type=a.b2ManifoldType.e_circles,t.localNormal.SetZero(),t.localPoint.Copy(C),t.points[0].id.Copy(x),void t.points[0].localPoint.Copy(s.m_p)}if(v<=0){var C=f,B=n.b2SubVV(y,C,h),g=n.b2DotVV(B,B);if(g>V*V)return;if(e.m_hasVertex3){var T=e.m_vertex3,R=f,E=n.b2SubVV(T,R,c),G=n.b2DotVV(E,n.b2SubVV(y,R,n.b2Vec2.s_t0));if(G>0)return}return x.cf.indexA=1,x.cf.typeA=a.b2ContactFeatureType.e_vertex,t.pointCount=1,t.type=a.b2ManifoldType.e_circles,t.localNormal.SetZero(),t.localPoint.Copy(C),t.points[0].id.Copy(x),void t.points[0].localPoint.Copy(s.m_p)}var D=n.b2DotVV(A,A);r.ENABLE_ASSERTS&&r.b2Assert(D>0);var C=u;C.x=1/D*(v*d.x+S*f.x),C.y=1/D*(v*d.y+S*f.y);var B=n.b2SubVV(y,C,h),g=n.b2DotVV(B,B);if(!(g>V*V)){var P=p.SetXY(-A.y,A.x);n.b2DotVV(P,n.b2SubVV(y,d,n.b2Vec2.s_t0))<0&&P.SetXY(-P.x,-P.y),P.Normalize(),x.cf.indexA=0,x.cf.typeA=a.b2ContactFeatureType.e_face,t.pointCount=1,t.type=a.b2ManifoldType.e_faceA,t.localNormal.Copy(P),t.localPoint.Copy(d),t.points[0].id.Copy(x),t.points[0].localPoint.Copy(s.m_p)}}function o(t,e,i,s,o){var n=V;n.Collide(t,e,i,s,o)}var n=i(4),r=i(3),a=i(2),_=new n.b2Vec2,m=new n.b2Vec2,h=new n.b2Vec2,l=new n.b2Vec2,c=new n.b2Vec2,u=new n.b2Vec2,p=new n.b2Vec2,b=new a.b2ContactID;e.b2CollideEdgeAndCircle=s,function(t){t[t.e_unknown=0]="e_unknown",t[t.e_edgeA=1]="e_edgeA",t[t.e_edgeB=2]="e_edgeB"}(e.b2EPAxisType||(e.b2EPAxisType={}));var y=e.b2EPAxisType,d=function(){function t(){this.type=y.e_unknown,this.index=0,this.separation=0}return t}();e.b2EPAxis=d;var f=function(){function t(){this.vertices=n.b2Vec2.MakeArray(r.b2_maxPolygonVertices),this.normals=n.b2Vec2.MakeArray(r.b2_maxPolygonVertices),this.count=0}return t}();e.b2TempPolygon=f;var A=function(){function t(){this.i1=0,this.i2=0,this.v1=new n.b2Vec2,this.v2=new n.b2Vec2,this.normal=new n.b2Vec2,this.sideNormal1=new n.b2Vec2,this.sideOffset1=0,this.sideNormal2=new n.b2Vec2,this.sideOffset2=0}return t}();e.b2ReferenceFace=A,function(t){t[t.e_isolated=0]="e_isolated",t[t.e_concave=1]="e_concave",t[t.e_convex=2]="e_convex"}(e.b2EPColliderVertexType||(e.b2EPColliderVertexType={}));var v=e.b2EPColliderVertexType,S=function(){function t(){this.m_polygonB=new f,this.m_xf=new n.b2Transform,this.m_centroidB=new n.b2Vec2,this.m_v0=new n.b2Vec2,this.m_v1=new n.b2Vec2,this.m_v2=new n.b2Vec2,this.m_v3=new n.b2Vec2,this.m_normal0=new n.b2Vec2,this.m_normal1=new n.b2Vec2,this.m_normal2=new n.b2Vec2,this.m_normal=new n.b2Vec2,this.m_type1=v.e_isolated,this.m_type2=v.e_isolated,this.m_lowerLimit=new n.b2Vec2,this.m_upperLimit=new n.b2Vec2,this.m_radius=0,this.m_front=!1}return t.prototype.Collide=function(e,i,s,o,_){n.b2MulTXX(s,_,this.m_xf),n.b2MulXV(this.m_xf,o.m_centroid,this.m_centroidB),this.m_v0.Copy(i.m_vertex0),this.m_v1.Copy(i.m_vertex1),this.m_v2.Copy(i.m_vertex2),this.m_v3.Copy(i.m_vertex3);var m=i.m_hasVertex0,h=i.m_hasVertex3,l=n.b2SubVV(this.m_v2,this.m_v1,t.s_edge1);l.Normalize(),this.m_normal1.SetXY(l.y,-l.x);var c=n.b2DotVV(this.m_normal1,n.b2SubVV(this.m_centroidB,this.m_v1,n.b2Vec2.s_t0)),u=0,p=0,b=!1,d=!1;if(m){var f=n.b2SubVV(this.m_v1,this.m_v0,t.s_edge0);f.Normalize(),this.m_normal0.SetXY(f.y,-f.x),b=n.b2CrossVV(f,l)>=0,u=n.b2DotVV(this.m_normal0,n.b2SubVV(this.m_centroidB,this.m_v0,n.b2Vec2.s_t0))}if(h){var A=n.b2SubVV(this.m_v3,this.m_v2,t.s_edge2);A.Normalize(),this.m_normal2.SetXY(A.y,-A.x),d=n.b2CrossVV(l,A)>0,p=n.b2DotVV(this.m_normal2,n.b2SubVV(this.m_centroidB,this.m_v2,n.b2Vec2.s_t0))}m&&h?b&&d?(this.m_front=u>=0||c>=0||p>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal0),this.m_upperLimit.Copy(this.m_normal2)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal1).SelfNeg())):b?(this.m_front=u>=0||c>=0&&p>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal0),this.m_upperLimit.Copy(this.m_normal1)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal2).SelfNeg(),this.m_upperLimit.Copy(this.m_normal1).SelfNeg())):d?(this.m_front=p>=0||u>=0&&c>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal2)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal0).SelfNeg())):(this.m_front=u>=0&&c>=0&&p>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal1)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal2).SelfNeg(),this.m_upperLimit.Copy(this.m_normal0).SelfNeg())):m?b?(this.m_front=u>=0||c>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal0),this.m_upperLimit.Copy(this.m_normal1).SelfNeg()):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal1).SelfNeg())):(this.m_front=u>=0&&c>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal1).SelfNeg()):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal0).SelfNeg())):h?d?(this.m_front=c>=0||p>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal2)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal1))):(this.m_front=c>=0&&p>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal1)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal2).SelfNeg(),this.m_upperLimit.Copy(this.m_normal1))):(this.m_front=c>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal1).SelfNeg()):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal1))),this.m_polygonB.count=o.m_count;for(var v=0,S=o.m_count;v<S;++v)n.b2MulXV(this.m_xf,o.m_vertices[v],this.m_polygonB.vertices[v]),n.b2MulRV(this.m_xf.q,o.m_normals[v],this.m_polygonB.normals[v]);this.m_radius=2*r.b2_polygonRadius,e.pointCount=0;var V=this.ComputeEdgeSeparation(t.s_edgeAxis);if(V.type!=y.e_unknown&&!(V.separation>this.m_radius)){var x=this.ComputePolygonSeparation(t.s_polygonAxis);if(!(x.type!=y.e_unknown&&x.separation>this.m_radius)){var C,B=.98,g=.001;C=x.type==y.e_unknown?V:x.separation>B*V.separation+g?x:V;var w=t.s_ie,M=t.s_rf;if(C.type==y.e_edgeA){e.type=a.b2ManifoldType.e_faceA;for(var L=0,I=n.b2DotVV(this.m_normal,this.m_polygonB.normals[0]),v=1,S=this.m_polygonB.count;v<S;++v){var T=n.b2DotVV(this.m_normal,this.m_polygonB.normals[v]);T<I&&(I=T,L=v)}var R=L,E=(R+1)%this.m_polygonB.count,G=w[0];G.v.Copy(this.m_polygonB.vertices[R]),G.id.cf.indexA=0,G.id.cf.indexB=R,G.id.cf.typeA=a.b2ContactFeatureType.e_face,G.id.cf.typeB=a.b2ContactFeatureType.e_vertex;var D=w[1];D.v.Copy(this.m_polygonB.vertices[E]),D.id.cf.indexA=0,D.id.cf.indexB=E,D.id.cf.typeA=a.b2ContactFeatureType.e_face,D.id.cf.typeB=a.b2ContactFeatureType.e_vertex,this.m_front?(M.i1=0,M.i2=1,M.v1.Copy(this.m_v1),M.v2.Copy(this.m_v2),M.normal.Copy(this.m_normal1)):(M.i1=1,M.i2=0,M.v1.Copy(this.m_v2),M.v2.Copy(this.m_v1),M.normal.Copy(this.m_normal1).SelfNeg())}else{e.type=a.b2ManifoldType.e_faceB;var G=w[0];G.v.Copy(this.m_v1),G.id.cf.indexA=0,G.id.cf.indexB=C.index,G.id.cf.typeA=a.b2ContactFeatureType.e_vertex,G.id.cf.typeB=a.b2ContactFeatureType.e_face;var D=w[1];D.v.Copy(this.m_v2),D.id.cf.indexA=0,D.id.cf.indexB=C.index,D.id.cf.typeA=a.b2ContactFeatureType.e_vertex,D.id.cf.typeB=a.b2ContactFeatureType.e_face,M.i1=C.index,M.i2=(M.i1+1)%this.m_polygonB.count,M.v1.Copy(this.m_polygonB.vertices[M.i1]),M.v2.Copy(this.m_polygonB.vertices[M.i2]),M.normal.Copy(this.m_polygonB.normals[M.i1])}M.sideNormal1.SetXY(M.normal.y,-M.normal.x),M.sideNormal2.Copy(M.sideNormal1).SelfNeg(),M.sideOffset1=n.b2DotVV(M.sideNormal1,M.v1),M.sideOffset2=n.b2DotVV(M.sideNormal2,M.v2);var P=t.s_clipPoints1,F=t.s_clipPoints2,k=0;if(k=a.b2ClipSegmentToLine(P,w,M.sideNormal1,M.sideOffset1,M.i1),!(k<r.b2_maxManifoldPoints||(k=a.b2ClipSegmentToLine(F,P,M.sideNormal2,M.sideOffset2,M.i2),k<r.b2_maxManifoldPoints))){C.type==y.e_edgeA?(e.localNormal.Copy(M.normal),e.localPoint.Copy(M.v1)):(e.localNormal.Copy(o.m_normals[M.i1]),e.localPoint.Copy(o.m_vertices[M.i1]));for(var N=0,v=0,S=r.b2_maxManifoldPoints;v<S;++v){var q;if(q=n.b2DotVV(M.normal,n.b2SubVV(F[v].v,M.v1,n.b2Vec2.s_t0)),q<=this.m_radius){var z=e.points[N];C.type==y.e_edgeA?(n.b2MulTXV(this.m_xf,F[v].v,z.localPoint),z.id=F[v].id):(z.localPoint.Copy(F[v].v),z.id.cf.typeA=F[v].id.cf.typeB,z.id.cf.typeB=F[v].id.cf.typeA,z.id.cf.indexA=F[v].id.cf.indexB,z.id.cf.indexB=F[v].id.cf.indexA),++N}}e.pointCount=N}}}},t.prototype.ComputeEdgeSeparation=function(t){var e=t;e.type=y.e_edgeA,e.index=this.m_front?0:1,e.separation=r.b2_maxFloat;for(var i=0,s=this.m_polygonB.count;i<s;++i){var o=n.b2DotVV(this.m_normal,n.b2SubVV(this.m_polygonB.vertices[i],this.m_v1,n.b2Vec2.s_t0));o<e.separation&&(e.separation=o)}return e},t.prototype.ComputePolygonSeparation=function(e){var i=e;i.type=y.e_unknown,i.index=-1,i.separation=-r.b2_maxFloat;for(var s=t.s_perp.SetXY(-this.m_normal.y,this.m_normal.x),o=0,a=this.m_polygonB.count;o<a;++o){var _=n.b2NegV(this.m_polygonB.normals[o],t.s_n),m=n.b2DotVV(_,n.b2SubVV(this.m_polygonB.vertices[o],this.m_v1,n.b2Vec2.s_t0)),h=n.b2DotVV(_,n.b2SubVV(this.m_polygonB.vertices[o],this.m_v2,n.b2Vec2.s_t0)),l=n.b2Min(m,h);if(l>this.m_radius)return i.type=y.e_edgeB,i.index=o,i.separation=l,i;if(n.b2DotVV(_,s)>=0){if(n.b2DotVV(n.b2SubVV(_,this.m_upperLimit,n.b2Vec2.s_t0),this.m_normal)<-r.b2_angularSlop)continue}else if(n.b2DotVV(n.b2SubVV(_,this.m_lowerLimit,n.b2Vec2.s_t0),this.m_normal)<-r.b2_angularSlop)continue;l>i.separation&&(i.type=y.e_edgeB,i.index=o,i.separation=l)}return i},t.s_edge1=new n.b2Vec2,t.s_edge0=new n.b2Vec2,t.s_edge2=new n.b2Vec2,t.s_ie=a.b2ClipVertex.MakeArray(2),t.s_rf=new A,t.s_clipPoints1=a.b2ClipVertex.MakeArray(2),t.s_clipPoints2=a.b2ClipVertex.MakeArray(2),t.s_edgeAxis=new d,t.s_polygonAxis=new d,t.s_n=new n.b2Vec2,t.s_perp=new n.b2Vec2,t}();e.b2EPCollider=S;var V=new S;e.b2CollideEdgeAndPolygon=o},function(t,e,i){"use strict";function s(t,e,i,s,o){var n=t.m_count,r=t.m_vertices,m=t.m_normals,p=s.m_count,b=s.m_vertices;_.ENABLE_ASSERTS&&_.b2Assert(0<=i&&i<n);for(var y=a.b2MulRV(e.q,m[i],h),d=a.b2MulTRV(o.q,y,l),f=0,A=_.b2_maxFloat,v=0;v<p;++v){var S=a.b2DotVV(b[v],d);S<A&&(A=S,f=v)}var V=a.b2MulXV(e,r[i],c),x=a.b2MulXV(o,b[f],u),C=a.b2DotVV(a.b2SubVV(x,V,a.b2Vec2.s_t0),y);return C}function o(t,e,i,o,n){for(var r=e.m_count,m=e.m_normals,h=a.b2SubVV(a.b2MulXV(n,o.m_centroid,a.b2Vec2.s_t0),a.b2MulXV(i,e.m_centroid,a.b2Vec2.s_t1),p),l=a.b2MulTRV(i.q,h,b),c=0,u=-_.b2_maxFloat,y=0;y<r;++y){var d=a.b2DotVV(m[y],l);d>u&&(u=d,c=y)}var f=s(e,i,c,o,n),A=(c+r-1)%r,v=s(e,i,A,o,n),S=(c+1)%r,V=s(e,i,S,o,n),x=0,C=0,B=0;if(v>f&&v>V)B=-1,x=A,C=v;else{if(!(V>f))return t[0]=c,f;B=1,x=S,C=V}for(;;){if(c=B==-1?(x+r-1)%r:(x+1)%r,f=s(e,i,c,o,n),!(f>C))break;x=c,C=f}return t[0]=x,C}function n(t,e,i,s,o,n){var r=e.m_count,h=e.m_normals,l=o.m_count,c=o.m_vertices,u=o.m_normals;_.ENABLE_ASSERTS&&_.b2Assert(0<=s&&s<r);for(var p=a.b2MulTRV(n.q,a.b2MulRV(i.q,h[s],a.b2Vec2.s_t0),y),b=0,d=_.b2_maxFloat,f=0;f<l;++f){var A=a.b2DotVV(p,u[f]);A<d&&(d=A,b=f)}var v=b,S=(v+1)%l,V=t[0];a.b2MulXV(n,c[v],V.v);var x=V.id.cf;x.indexA=s,x.indexB=v,x.typeA=m.b2ContactFeatureType.e_face,x.typeB=m.b2ContactFeatureType.e_vertex;var C=t[1];a.b2MulXV(n,c[S],C.v);var B=C.id.cf;B.indexA=s,B.indexB=S,B.typeA=m.b2ContactFeatureType.e_face,B.typeB=m.b2ContactFeatureType.e_vertex}function r(t,e,i,s,r){t.pointCount=0;var h=e.m_radius+s.m_radius,l=v;l[0]=0;var c=o(l,e,i,s,r);if(!(c>h)){var u=S;u[0]=0;var p=o(u,s,r,e,i);if(!(p>h)){var b,y,I,T,R=0,E=0,G=.98,D=.001;p>G*c+D?(b=s,y=e,I=r,T=i,R=u[0],t.type=m.b2ManifoldType.e_faceB,E=1):(b=e,y=s,I=i,T=r,R=l[0],t.type=m.b2ManifoldType.e_faceA,E=0);var P=d;n(P,b,I,R,y,T);var F=b.m_count,k=b.m_vertices,N=R,q=(R+1)%F,z=k[N],J=k[q],j=a.b2SubVV(J,z,V);j.Normalize();var X,O=a.b2CrossVOne(j,x),Y=a.b2MidVV(z,J,C),Z=a.b2MulRV(I.q,j,g),H=a.b2CrossVOne(Z,B),W=a.b2MulXV(I,z,M),U=a.b2MulXV(I,J,L),K=a.b2DotVV(H,W),Q=-a.b2DotVV(Z,W)+h,$=a.b2DotVV(Z,U)+h,tt=f,et=A,it=a.b2NegV(Z,w);if(X=m.b2ClipSegmentToLine(tt,P,it,Q,N),!(X<2||(X=m.b2ClipSegmentToLine(et,tt,Z,$,q),X<2))){t.localNormal.Copy(O),t.localPoint.Copy(Y);for(var st=0,ot=0;ot<_.b2_maxManifoldPoints;++ot){var nt=et[ot],rt=a.b2DotVV(H,nt.v)-K;if(rt<=h){var at=t.points[st];if(a.b2MulTXV(T,nt.v,at.localPoint),at.id.Copy(nt.id),E){var _t=at.id.cf;at.id.cf.indexA=_t.indexB,at.id.cf.indexB=_t.indexA,at.id.cf.typeA=_t.typeB,at.id.cf.typeB=_t.typeA}++st}}t.pointCount=st}}}}var a=i(4),_=i(3),m=i(2),h=new a.b2Vec2,l=new a.b2Vec2,c=new a.b2Vec2,u=new a.b2Vec2;e.b2EdgeSeparation=s;var p=new a.b2Vec2,b=new a.b2Vec2;e.b2FindMaxSeparation=o;var y=new a.b2Vec2;e.b2FindIncidentEdge=n;var d=m.b2ClipVertex.MakeArray(2),f=m.b2ClipVertex.MakeArray(2),A=m.b2ClipVertex.MakeArray(2),v=_.b2MakeNumberArray(1),S=_.b2MakeNumberArray(1),V=new a.b2Vec2,x=new a.b2Vec2,C=new a.b2Vec2,B=new a.b2Vec2,g=new a.b2Vec2,w=new a.b2Vec2,M=new a.b2Vec2,L=new a.b2Vec2;e.b2CollidePolygons=r},function(t,e,i){"use strict";function s(t,i){var s=v.Reset();++e.b2_toiCalls,t.state=y.e_unknown,t.t=i.tMax;var a=i.proxyA,h=i.proxyB,l=w.Copy(i.sweepA),c=M.Copy(i.sweepB);l.Normalize(),c.Normalize();var u=i.tMax,p=a.m_radius+h.m_radius,b=o.b2Max(n.b2_linearSlop,p-3*n.b2_linearSlop),d=.25*n.b2_linearSlop;n.ENABLE_ASSERTS&&n.b2Assert(b>d);var f=0,A=20,L=0,I=S;I.count=0;var T=V;for(T.proxyA=i.proxyA,T.proxyB=i.proxyB,T.useRadii=!1;;){var R=_,E=m;l.GetTransform(R,f),c.GetTransform(E,f),T.transformA.Copy(R),T.transformB.Copy(E);var G=x;if(r.b2Distance(G,I,T),G.distance<=0){t.state=y.e_overlapped,t.t=0;break}if(G.distance<b+d){t.state=y.e_touching,t.t=f;break}var D=C;D.Initialize(I,a,l,h,c,f);for(var P=!1,F=u,k=0;;){var N=B,q=g,z=D.FindMinSeparation(N,q,F);if(z>b+d){t.state=y.e_separated,t.t=u,P=!0;break}if(z>b-d){f=F;break}var J=D.Evaluate(N[0],q[0],f);if(J<b-d){t.state=y.e_failed,t.t=f,P=!0;break}if(J<=b+d){t.state=y.e_touching,t.t=f,P=!0;break}for(var j=0,X=f,O=F;;){var Y=0;Y=1&j?X+(b-J)*(O-X)/(z-J):.5*(X+O),++j,++e.b2_toiRootIters;var Z=D.Evaluate(N[0],q[0],Y);if(o.b2Abs(Z-b)<d){F=Y;break}if(Z>b?(X=Y,J=Z):(O=Y,z=Z),50==j)break}if(e.b2_toiMaxRootIters=o.b2Max(e.b2_toiMaxRootIters,j),++k,k==n.b2_maxPolygonVertices)break}if(++L,++e.b2_toiIters,P)break;if(L==A){t.state=y.e_failed,t.t=f;break}}e.b2_toiMaxIters=o.b2Max(e.b2_toiMaxIters,L);var H=s.GetMilliseconds();e.b2_toiMaxTime=o.b2Max(e.b2_toiMaxTime,H),e.b2_toiTime+=H}var o=i(4),n=i(3),r=i(5),a=i(12);e.b2_toiTime=0,e.b2_toiMaxTime=0,e.b2_toiCalls=0,e.b2_toiIters=0,e.b2_toiMaxIters=0,e.b2_toiRootIters=0,e.b2_toiMaxRootIters=0;var _=new o.b2Transform,m=new o.b2Transform,h=new o.b2Vec2,l=new o.b2Vec2,c=new o.b2Vec2,u=new o.b2Vec2,p=new o.b2Vec2,b=function(){function t(){this.proxyA=new r.b2DistanceProxy,this.proxyB=new r.b2DistanceProxy,this.sweepA=new o.b2Sweep,this.sweepB=new o.b2Sweep,this.tMax=0}return t}();e.b2TOIInput=b,function(t){t[t.e_unknown=0]="e_unknown",t[t.e_failed=1]="e_failed",t[t.e_overlapped=2]="e_overlapped",t[t.e_touching=3]="e_touching",t[t.e_separated=4]="e_separated"}(e.b2TOIOutputState||(e.b2TOIOutputState={}));var y=e.b2TOIOutputState,d=function(){function t(){this.state=y.e_unknown,this.t=0}return t}();e.b2TOIOutput=d,function(t){t[t.e_unknown=-1]="e_unknown",t[t.e_points=0]="e_points",t[t.e_faceA=1]="e_faceA",t[t.e_faceB=2]="e_faceB"}(e.b2SeparationFunctionType||(e.b2SeparationFunctionType={}));var f=e.b2SeparationFunctionType,A=function(){function t(){this.m_proxyA=null,this.m_proxyB=null,
this.m_sweepA=new o.b2Sweep,this.m_sweepB=new o.b2Sweep,this.m_type=f.e_unknown,this.m_localPoint=new o.b2Vec2,this.m_axis=new o.b2Vec2}return t.prototype.Initialize=function(t,e,i,s,r,a){this.m_proxyA=e,this.m_proxyB=s;var u=t.count;n.ENABLE_ASSERTS&&n.b2Assert(0<u&&u<3),this.m_sweepA.Copy(i),this.m_sweepB.Copy(r);var p=_,b=m;if(this.m_sweepA.GetTransform(p,a),this.m_sweepB.GetTransform(b,a),1==u){this.m_type=f.e_points;var y=this.m_proxyA.GetVertex(t.indexA[0]),d=this.m_proxyB.GetVertex(t.indexB[0]),A=o.b2MulXV(p,y,h),v=o.b2MulXV(b,d,l);o.b2SubVV(v,A,this.m_axis);var S=this.m_axis.Normalize();return S}if(t.indexA[0]==t.indexA[1]){this.m_type=f.e_faceB;var V=this.m_proxyB.GetVertex(t.indexB[0]),x=this.m_proxyB.GetVertex(t.indexB[1]);o.b2CrossVOne(o.b2SubVV(x,V,o.b2Vec2.s_t0),this.m_axis).SelfNormalize();var C=o.b2MulRV(b.q,this.m_axis,c);o.b2MidVV(V,x,this.m_localPoint);var v=o.b2MulXV(b,this.m_localPoint,l),y=this.m_proxyA.GetVertex(t.indexA[0]),A=o.b2MulXV(p,y,h),S=o.b2DotVV(o.b2SubVV(A,v,o.b2Vec2.s_t0),C);return S<0&&(this.m_axis.SelfNeg(),S=-S),S}this.m_type=f.e_faceA;var B=this.m_proxyA.GetVertex(t.indexA[0]),g=this.m_proxyA.GetVertex(t.indexA[1]);o.b2CrossVOne(o.b2SubVV(g,B,o.b2Vec2.s_t0),this.m_axis).SelfNormalize();var C=o.b2MulRV(p.q,this.m_axis,c);o.b2MidVV(B,g,this.m_localPoint);var A=o.b2MulXV(p,this.m_localPoint,h),d=this.m_proxyB.GetVertex(t.indexB[0]),v=o.b2MulXV(b,d,l),S=o.b2DotVV(o.b2SubVV(v,A,o.b2Vec2.s_t0),C);return S<0&&(this.m_axis.SelfNeg(),S=-S),S},t.prototype.FindMinSeparation=function(t,e,i){var s=_,r=m;switch(this.m_sweepA.GetTransform(s,i),this.m_sweepB.GetTransform(r,i),this.m_type){case f.e_points:var a=o.b2MulTRV(s.q,this.m_axis,u),b=o.b2MulTRV(r.q,o.b2NegV(this.m_axis,o.b2Vec2.s_t0),p);t[0]=this.m_proxyA.GetSupport(a),e[0]=this.m_proxyB.GetSupport(b);var y=this.m_proxyA.GetVertex(t[0]),d=this.m_proxyB.GetVertex(e[0]),A=o.b2MulXV(s,y,h),v=o.b2MulXV(r,d,l),S=o.b2DotVV(o.b2SubVV(v,A,o.b2Vec2.s_t0),this.m_axis);return S;case f.e_faceA:var V=o.b2MulRV(s.q,this.m_axis,c),A=o.b2MulXV(s,this.m_localPoint,h),b=o.b2MulTRV(r.q,o.b2NegV(V,o.b2Vec2.s_t0),p);t[0]=-1,e[0]=this.m_proxyB.GetSupport(b);var d=this.m_proxyB.GetVertex(e[0]),v=o.b2MulXV(r,d,l),S=o.b2DotVV(o.b2SubVV(v,A,o.b2Vec2.s_t0),V);return S;case f.e_faceB:var V=o.b2MulRV(r.q,this.m_axis,c),v=o.b2MulXV(r,this.m_localPoint,l),a=o.b2MulTRV(s.q,o.b2NegV(V,o.b2Vec2.s_t0),u);e[0]=-1,t[0]=this.m_proxyA.GetSupport(a);var y=this.m_proxyA.GetVertex(t[0]),A=o.b2MulXV(s,y,h),S=o.b2DotVV(o.b2SubVV(A,v,o.b2Vec2.s_t0),V);return S;default:return n.ENABLE_ASSERTS&&n.b2Assert(!1),t[0]=-1,e[0]=-1,0}},t.prototype.Evaluate=function(t,e,i){var s=_,r=m;switch(this.m_sweepA.GetTransform(s,i),this.m_sweepB.GetTransform(r,i),this.m_type){case f.e_points:var a=this.m_proxyA.GetVertex(t),u=this.m_proxyB.GetVertex(e),p=o.b2MulXV(s,a,h),b=o.b2MulXV(r,u,l),y=o.b2DotVV(o.b2SubVV(b,p,o.b2Vec2.s_t0),this.m_axis);return y;case f.e_faceA:var d=o.b2MulRV(s.q,this.m_axis,c),p=o.b2MulXV(s,this.m_localPoint,h),u=this.m_proxyB.GetVertex(e),b=o.b2MulXV(r,u,l),y=o.b2DotVV(o.b2SubVV(b,p,o.b2Vec2.s_t0),d);return y;case f.e_faceB:var d=o.b2MulRV(r.q,this.m_axis,c),b=o.b2MulXV(r,this.m_localPoint,l),a=this.m_proxyA.GetVertex(t),p=o.b2MulXV(s,a,h),y=o.b2DotVV(o.b2SubVV(p,b,o.b2Vec2.s_t0),d);return y;default:return n.ENABLE_ASSERTS&&n.b2Assert(!1),0}},t}();e.b2SeparationFunction=A;var v=new a.b2Timer,S=new r.b2SimplexCache,V=new r.b2DistanceInput,x=new r.b2DistanceOutput,C=new A,B=n.b2MakeNumberArray(1),g=n.b2MakeNumberArray(1),w=new o.b2Sweep,M=new o.b2Sweep;e.b2TimeOfImpact=s},function(t,e){"use strict";var i=function(){function t(){this.m_start=(new Date).getTime()}return t.prototype.Reset=function(){return this.m_start=(new Date).getTime(),this},t.prototype.GetMilliseconds=function(){return(new Date).getTime()-this.m_start},t}();e.b2Timer=i;var s=function(){function t(){this.m_count=0,this.m_min_count=0,this.m_max_count=0}return t.prototype.GetCount=function(){return this.m_count},t.prototype.GetMinCount=function(){return this.m_min_count},t.prototype.GetMaxCount=function(){return this.m_max_count},t.prototype.ResetCount=function(){var t=this.m_count;return this.m_count=0,t},t.prototype.ResetMinCount=function(){this.m_min_count=0},t.prototype.ResetMaxCount=function(){this.m_max_count=0},t.prototype.Increment=function(){this.m_count++,this.m_max_count<this.m_count&&(this.m_max_count=this.m_count)},t.prototype.Decrement=function(){this.m_count--,this.m_min_count>this.m_count&&(this.m_min_count=this.m_count)},t}();e.b2Counter=s},function(t,e,i){"use strict";var s=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},o=i(4),n=i(3),r=i(14),a=i(15),_=function(t){function e(){t.call(this,r.b2ShapeType.e_chainShape,n.b2_polygonRadius),this.m_vertices=null,this.m_count=0,this.m_prevVertex=new o.b2Vec2,this.m_nextVertex=new o.b2Vec2,this.m_hasPrevVertex=!1,this.m_hasNextVertex=!1}return s(e,t),e.prototype.CreateLoop=function(t,e){if(void 0===e&&(e=t.length),e=e||t.length,n.ENABLE_ASSERTS&&n.b2Assert(null==this.m_vertices&&0==this.m_count),n.ENABLE_ASSERTS&&n.b2Assert(e>=3),n.ENABLE_ASSERTS)for(var i=1;i<e;++i){var s=t[i-1],r=t[i];n.b2Assert(o.b2DistanceSquaredVV(s,r)>n.b2_linearSlop*n.b2_linearSlop)}this.m_count=e+1,this.m_vertices=o.b2Vec2.MakeArray(this.m_count);for(var i=0;i<e;++i)this.m_vertices[i].Copy(t[i]);return this.m_vertices[e].Copy(this.m_vertices[0]),this.m_prevVertex.Copy(this.m_vertices[this.m_count-2]),this.m_nextVertex.Copy(this.m_vertices[1]),this.m_hasPrevVertex=!0,this.m_hasNextVertex=!0,this},e.prototype.CreateChain=function(t,e){if(void 0===e&&(e=t.length),e=e||t.length,n.ENABLE_ASSERTS&&n.b2Assert(null==this.m_vertices&&0==this.m_count),n.ENABLE_ASSERTS&&n.b2Assert(e>=2),n.ENABLE_ASSERTS)for(var i=1;i<e;++i){var s=t[i-1],r=t[i];n.b2Assert(o.b2DistanceSquaredVV(s,r)>n.b2_linearSlop*n.b2_linearSlop)}this.m_count=e,this.m_vertices=o.b2Vec2.MakeArray(e);for(var i=0;i<e;++i)this.m_vertices[i].Copy(t[i]);return this.m_hasPrevVertex=!1,this.m_hasNextVertex=!1,this},e.prototype.SetPrevVertex=function(t){return this.m_prevVertex.Copy(t),this.m_hasPrevVertex=!0,this},e.prototype.SetNextVertex=function(t){return this.m_nextVertex.Copy(t),this.m_hasNextVertex=!0,this},e.prototype.Clone=function(){return(new e).Copy(this)},e.prototype.Copy=function(i){return t.prototype.Copy.call(this,i),n.ENABLE_ASSERTS&&n.b2Assert(i instanceof e),this.CreateChain(i.m_vertices,i.m_count),this.m_prevVertex.Copy(i.m_prevVertex),this.m_nextVertex.Copy(i.m_nextVertex),this.m_hasPrevVertex=i.m_hasPrevVertex,this.m_hasNextVertex=i.m_hasNextVertex,this},e.prototype.GetChildCount=function(){return this.m_count-1},e.prototype.GetChildEdge=function(t,e){n.ENABLE_ASSERTS&&n.b2Assert(0<=e&&e<this.m_count-1),t.m_type=r.b2ShapeType.e_edgeShape,t.m_radius=this.m_radius,t.m_vertex1.Copy(this.m_vertices[e]),t.m_vertex2.Copy(this.m_vertices[e+1]),e>0?(t.m_vertex0.Copy(this.m_vertices[e-1]),t.m_hasVertex0=!0):(t.m_vertex0.Copy(this.m_prevVertex),t.m_hasVertex0=this.m_hasPrevVertex),e<this.m_count-2?(t.m_vertex3.Copy(this.m_vertices[e+2]),t.m_hasVertex3=!0):(t.m_vertex3.Copy(this.m_nextVertex),t.m_hasVertex3=this.m_hasNextVertex)},e.prototype.TestPoint=function(t,e){return!1},e.prototype.RayCast=function(t,i,s,o){n.ENABLE_ASSERTS&&n.b2Assert(o<this.m_count);var r=e.RayCast_s_edgeShape;return r.m_vertex1.Copy(this.m_vertices[o]),r.m_vertex2.Copy(this.m_vertices[(o+1)%this.m_count]),r.RayCast(t,i,s,0)},e.prototype.ComputeAABB=function(t,i,s){n.ENABLE_ASSERTS&&n.b2Assert(s<this.m_count);var r=this.m_vertices[s],a=this.m_vertices[(s+1)%this.m_count],_=o.b2MulXV(i,r,e.ComputeAABB_s_v1),m=o.b2MulXV(i,a,e.ComputeAABB_s_v2);o.b2MinV(_,m,t.lowerBound),o.b2MaxV(_,m,t.upperBound)},e.prototype.ComputeMass=function(t,e){t.mass=0,t.center.SetZero(),t.I=0},e.prototype.SetupDistanceProxy=function(t,e){n.ENABLE_ASSERTS&&n.b2Assert(0<=e&&e<this.m_count),t.m_buffer[0].Copy(this.m_vertices[e]),e+1<this.m_count?t.m_buffer[1].Copy(this.m_vertices[e+1]):t.m_buffer[1].Copy(this.m_vertices[0]),t.m_vertices=t.m_buffer,t.m_count=2,t.m_radius=this.m_radius},e.prototype.ComputeSubmergedArea=function(t,e,i,s){return s.SetZero(),0},e.prototype.Dump=function(){n.b2Log("    var shape: b2ChainShape = new b2ChainShape();\n"),n.b2Log("    var vs: b2Vec2[] = b2Vec2.MakeArray(%d);\n",n.b2_maxPolygonVertices);for(var t=0;t<this.m_count;++t)n.b2Log("    vs[%d].SetXY(%.15f, %.15f);\n",t,this.m_vertices[t].x,this.m_vertices[t].y);n.b2Log("    shape.CreateChain(vs, %d);\n",this.m_count),n.b2Log("    shape.m_prevVertex.SetXY(%.15f, %.15f);\n",this.m_prevVertex.x,this.m_prevVertex.y),n.b2Log("    shape.m_nextVertex.SetXY(%.15f, %.15f);\n",this.m_nextVertex.x,this.m_nextVertex.y),n.b2Log("    shape.m_hasPrevVertex = %s;\n",this.m_hasPrevVertex?"true":"false"),n.b2Log("    shape.m_hasNextVertex = %s;\n",this.m_hasNextVertex?"true":"false")},e.RayCast_s_edgeShape=new a.b2EdgeShape,e.ComputeAABB_s_v1=new o.b2Vec2,e.ComputeAABB_s_v2=new o.b2Vec2,e}(r.b2Shape);e.b2ChainShape=_},function(t,e,i){"use strict";var s=i(3),o=i(4),n=function(){function t(){this.mass=0,this.center=new o.b2Vec2(0,0),this.I=0}return t}();e.b2MassData=n,function(t){t[t.e_unknown=-1]="e_unknown",t[t.e_circleShape=0]="e_circleShape",t[t.e_edgeShape=1]="e_edgeShape",t[t.e_polygonShape=2]="e_polygonShape",t[t.e_chainShape=3]="e_chainShape",t[t.e_shapeTypeCount=4]="e_shapeTypeCount"}(e.b2ShapeType||(e.b2ShapeType={}));var r=e.b2ShapeType,a=function(){function t(t,e){this.m_type=r.e_unknown,this.m_radius=0,this.m_type=t,this.m_radius=e}return t.prototype.Clone=function(){return s.ENABLE_ASSERTS&&s.b2Assert(!1),null},t.prototype.Copy=function(t){return s.ENABLE_ASSERTS&&s.b2Assert(this.m_type==t.m_type),this.m_radius=t.m_radius,this},t.prototype.GetType=function(){return this.m_type},t.prototype.GetChildCount=function(){return s.ENABLE_ASSERTS&&s.b2Assert(!1,"pure virtual"),0},t.prototype.TestPoint=function(t,e){return s.ENABLE_ASSERTS&&s.b2Assert(!1,"pure virtual"),!1},t.prototype.RayCast=function(t,e,i,o){return s.ENABLE_ASSERTS&&s.b2Assert(!1,"pure virtual"),!1},t.prototype.ComputeAABB=function(t,e,i){s.ENABLE_ASSERTS&&s.b2Assert(!1,"pure virtual")},t.prototype.ComputeMass=function(t,e){s.ENABLE_ASSERTS&&s.b2Assert(!1,"pure virtual")},t.prototype.SetupDistanceProxy=function(t,e){s.ENABLE_ASSERTS&&s.b2Assert(!1,"pure virtual")},t.prototype.ComputeSubmergedArea=function(t,e,i,o){return s.ENABLE_ASSERTS&&s.b2Assert(!1,"pure virtual"),o.SetZero(),0},t.prototype.Dump=function(){},t}();e.b2Shape=a},function(t,e,i){"use strict";var s=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},o=i(4),n=i(3),r=i(14),a=function(t){function e(){t.call(this,r.b2ShapeType.e_edgeShape,n.b2_polygonRadius),this.m_vertex1=new o.b2Vec2,this.m_vertex2=new o.b2Vec2,this.m_vertex0=new o.b2Vec2,this.m_vertex3=new o.b2Vec2,this.m_hasVertex0=!1,this.m_hasVertex3=!1}return s(e,t),e.prototype.SetAsEdge=function(t,e){return this.m_vertex1.Copy(t),this.m_vertex2.Copy(e),this.m_hasVertex0=!1,this.m_hasVertex3=!1,this},e.prototype.Clone=function(){return(new e).Copy(this)},e.prototype.Copy=function(i){return t.prototype.Copy.call(this,i),n.ENABLE_ASSERTS&&n.b2Assert(i instanceof e),this.m_vertex1.Copy(i.m_vertex1),this.m_vertex2.Copy(i.m_vertex2),this.m_vertex0.Copy(i.m_vertex0),this.m_vertex3.Copy(i.m_vertex3),this.m_hasVertex0=i.m_hasVertex0,this.m_hasVertex3=i.m_hasVertex3,this},e.prototype.GetChildCount=function(){return 1},e.prototype.TestPoint=function(t,e){return!1},e.prototype.RayCast=function(t,i,s,n){var r=o.b2MulTXV(s,i.p1,e.RayCast_s_p1),a=o.b2MulTXV(s,i.p2,e.RayCast_s_p2),_=o.b2SubVV(a,r,e.RayCast_s_d),m=this.m_vertex1,h=this.m_vertex2,l=o.b2SubVV(h,m,e.RayCast_s_e),c=t.normal.SetXY(l.y,-l.x).SelfNormalize(),u=o.b2DotVV(c,o.b2SubVV(m,r,o.b2Vec2.s_t0)),p=o.b2DotVV(c,_);if(0==p)return!1;var b=u/p;if(b<0||i.maxFraction<b)return!1;var y=o.b2AddVMulSV(r,b,_,e.RayCast_s_q),d=o.b2SubVV(h,m,e.RayCast_s_r),f=o.b2DotVV(d,d);if(0==f)return!1;var A=o.b2DotVV(o.b2SubVV(y,m,o.b2Vec2.s_t0),d)/f;return!(A<0||1<A)&&(t.fraction=b,u>0&&t.normal.SelfNeg(),!0)},e.prototype.ComputeAABB=function(t,i,s){var n=o.b2MulXV(i,this.m_vertex1,e.ComputeAABB_s_v1),r=o.b2MulXV(i,this.m_vertex2,e.ComputeAABB_s_v2);o.b2MinV(n,r,t.lowerBound),o.b2MaxV(n,r,t.upperBound);var a=this.m_radius;t.lowerBound.SelfSubXY(a,a),t.upperBound.SelfAddXY(a,a)},e.prototype.ComputeMass=function(t,e){t.mass=0,o.b2MidVV(this.m_vertex1,this.m_vertex2,t.center),t.I=0},e.prototype.SetupDistanceProxy=function(t,e){t.m_vertices=new Array(2),t.m_vertices[0]=this.m_vertex1,t.m_vertices[1]=this.m_vertex2,t.m_count=2,t.m_radius=this.m_radius},e.prototype.ComputeSubmergedArea=function(t,e,i,s){return s.SetZero(),0},e.prototype.Dump=function(){n.b2Log("    var shape: b2EdgeShape = new b2EdgeShape();\n"),n.b2Log("    shape.m_radius = %.15f;\n",this.m_radius),n.b2Log("    shape.m_vertex0.SetXY(%.15f, %.15f);\n",this.m_vertex0.x,this.m_vertex0.y),n.b2Log("    shape.m_vertex1.SetXY(%.15f, %.15f);\n",this.m_vertex1.x,this.m_vertex1.y),n.b2Log("    shape.m_vertex2.SetXY(%.15f, %.15f);\n",this.m_vertex2.x,this.m_vertex2.y),n.b2Log("    shape.m_vertex3.SetXY(%.15f, %.15f);\n",this.m_vertex3.x,this.m_vertex3.y),n.b2Log("    shape.m_hasVertex0 = %s;\n",this.m_hasVertex0),n.b2Log("    shape.m_hasVertex3 = %s;\n",this.m_hasVertex3)},e.RayCast_s_p1=new o.b2Vec2,e.RayCast_s_p2=new o.b2Vec2,e.RayCast_s_d=new o.b2Vec2,e.RayCast_s_e=new o.b2Vec2,e.RayCast_s_q=new o.b2Vec2,e.RayCast_s_r=new o.b2Vec2,e.ComputeAABB_s_v1=new o.b2Vec2,e.ComputeAABB_s_v2=new o.b2Vec2,e}(r.b2Shape);e.b2EdgeShape=a},function(t,e,i){"use strict";var s=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},o=i(4),n=i(3),r=i(14),a=function(t){function e(e){void 0===e&&(e=0),t.call(this,r.b2ShapeType.e_circleShape,e),this.m_p=new o.b2Vec2}return s(e,t),e.prototype.Clone=function(){return(new e).Copy(this)},e.prototype.Copy=function(i){return t.prototype.Copy.call(this,i),n.ENABLE_ASSERTS&&n.b2Assert(i instanceof e),this.m_p.Copy(i.m_p),this},e.prototype.GetChildCount=function(){return 1},e.prototype.TestPoint=function(t,i){var s=o.b2MulXV(t,this.m_p,e.TestPoint_s_center),n=o.b2SubVV(i,s,e.TestPoint_s_d);return o.b2DotVV(n,n)<=o.b2Sq(this.m_radius)},e.prototype.RayCast=function(t,i,s,r){var a=o.b2MulXV(s,this.m_p,e.RayCast_s_position),_=o.b2SubVV(i.p1,a,e.RayCast_s_s),m=o.b2DotVV(_,_)-o.b2Sq(this.m_radius),h=o.b2SubVV(i.p2,i.p1,e.RayCast_s_r),l=o.b2DotVV(_,h),c=o.b2DotVV(h,h),u=l*l-c*m;if(u<0||c<n.b2_epsilon)return!1;var p=-(l+o.b2Sqrt(u));return 0<=p&&p<=i.maxFraction*c&&(p/=c,t.fraction=p,o.b2AddVMulSV(_,p,h,t.normal).SelfNormalize(),!0)},e.prototype.ComputeAABB=function(t,i,s){var n=o.b2MulXV(i,this.m_p,e.ComputeAABB_s_p);t.lowerBound.SetXY(n.x-this.m_radius,n.y-this.m_radius),t.upperBound.SetXY(n.x+this.m_radius,n.y+this.m_radius)},e.prototype.ComputeMass=function(t,e){var i=o.b2Sq(this.m_radius);t.mass=e*n.b2_pi*i,t.center.Copy(this.m_p),t.I=t.mass*(.5*i+o.b2DotVV(this.m_p,this.m_p))},e.prototype.SetupDistanceProxy=function(t,e){t.m_vertices=[],t.m_vertices[0]=this.m_p,t.m_count=1,t.m_radius=this.m_radius},e.prototype.ComputeSubmergedArea=function(t,e,i,s){var r=o.b2MulXV(i,this.m_p,new o.b2Vec2),a=-(o.b2DotVV(t,r)-e);if(a<-this.m_radius+n.b2_epsilon)return 0;if(a>this.m_radius)return s.Copy(r),n.b2_pi*this.m_radius*this.m_radius;var _=this.m_radius*this.m_radius,m=a*a,h=_*(o.b2Asin(a/this.m_radius)+n.b2_pi/2)+a*o.b2Sqrt(_-m),l=-2/3*o.b2Pow(_-m,1.5)/h;return s.x=r.x+t.x*l,s.y=r.y+t.y*l,h},e.prototype.Dump=function(){n.b2Log("    var shape: b2CircleShape = new b2CircleShape();\n"),n.b2Log("    shape.m_radius = %.15f;\n",this.m_radius),n.b2Log("    shape.m_p.SetXY(%.15f, %.15f);\n",this.m_p.x,this.m_p.y)},e.TestPoint_s_center=new o.b2Vec2,e.TestPoint_s_d=new o.b2Vec2,e.RayCast_s_position=new o.b2Vec2,e.RayCast_s_s=new o.b2Vec2,e.RayCast_s_r=new o.b2Vec2,e.ComputeAABB_s_p=new o.b2Vec2,e}(r.b2Shape);e.b2CircleShape=a},function(t,e,i){"use strict";var s=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},o=i(4),n=i(3),r=i(14),a=function(t){function e(){t.call(this,r.b2ShapeType.e_polygonShape,n.b2_polygonRadius),this.m_centroid=new o.b2Vec2(0,0),this.m_vertices=o.b2Vec2.MakeArray(n.b2_maxPolygonVertices),this.m_normals=o.b2Vec2.MakeArray(n.b2_maxPolygonVertices),this.m_count=0}return s(e,t),e.prototype.Clone=function(){return(new e).Copy(this)},e.prototype.Copy=function(i){t.prototype.Copy.call(this,i),n.ENABLE_ASSERTS&&n.b2Assert(i instanceof e),this.m_centroid.Copy(i.m_centroid),this.m_count=i.m_count;for(var s=0,o=this.m_count;s<o;++s)this.m_vertices[s].Copy(i.m_vertices[s]),this.m_normals[s].Copy(i.m_normals[s]);return this},e.prototype.GetChildCount=function(){return 1},e.prototype.SetAsVector=function(t,i){if(void 0===i&&(i=t.length),n.ENABLE_ASSERTS&&n.b2Assert(3<=i&&i<=n.b2_maxPolygonVertices),i<3)return this.SetAsBox(1,1);for(var s=o.b2Min(i,n.b2_maxPolygonVertices),r=e.SetAsVector_s_ps,a=0;a<s;++a)r[a].Copy(t[a]);for(var _=0,m=r[0].x,a=1;a<i;++a){var h=r[a].x;(h>m||h==m&&r[a].y<r[_].y)&&(_=a,m=h)}for(var l=e.SetAsVector_s_hull,c=0,u=_;;){l[c]=u;for(var p=0,b=1;b<s;++b)if(p!=u){var y=o.b2SubVV(r[p],r[l[c]],e.SetAsVector_s_r),d=o.b2SubVV(r[b],r[l[c]],e.SetAsVector_s_v),f=o.b2CrossVV(y,d);f<0&&(p=b),0==f&&d.GetLengthSquared()>y.GetLengthSquared()&&(p=b)}else p=b;if(++c,u=p,p==_)break}this.m_count=c;for(var a=0;a<c;++a)this.m_vertices[a].Copy(r[l[a]]);for(var a=0,A=c;a<A;++a){var v=this.m_vertices[a],S=this.m_vertices[(a+1)%A],V=o.b2SubVV(S,v,o.b2Vec2.s_t0);n.ENABLE_ASSERTS&&n.b2Assert(V.GetLengthSquared()>n.b2_epsilon_sq),o.b2CrossVOne(V,this.m_normals[a]).SelfNormalize()}return e.ComputeCentroid(this.m_vertices,c,this.m_centroid),this},e.prototype.SetAsArray=function(t,e){return this.SetAsVector(t,e)},e.prototype.SetAsBox=function(t,e){return this.m_count=4,this.m_vertices[0].SetXY(-t,-e),this.m_vertices[1].SetXY(t,-e),this.m_vertices[2].SetXY(t,e),this.m_vertices[3].SetXY(-t,e),this.m_normals[0].SetXY(0,-1),this.m_normals[1].SetXY(1,0),this.m_normals[2].SetXY(0,1),this.m_normals[3].SetXY(-1,0),this.m_centroid.SetZero(),this},e.prototype.SetAsOrientedBox=function(t,e,i,s){this.m_count=4,this.m_vertices[0].SetXY(-t,-e),this.m_vertices[1].SetXY(t,-e),this.m_vertices[2].SetXY(t,e),this.m_vertices[3].SetXY(-t,e),this.m_normals[0].SetXY(0,-1),this.m_normals[1].SetXY(1,0),this.m_normals[2].SetXY(0,1),this.m_normals[3].SetXY(-1,0),this.m_centroid.Copy(i);var n=new o.b2Transform;n.SetPosition(i),n.SetRotationAngleRadians(s);for(var r=0,a=this.m_count;r<a;++r)o.b2MulXV(n,this.m_vertices[r],this.m_vertices[r]),o.b2MulRV(n.q,this.m_normals[r],this.m_normals[r]);return this},e.prototype.TestPoint=function(t,i){for(var s=o.b2MulTXV(t,i,e.TestPoint_s_pLocal),n=0,r=this.m_count;n<r;++n){var a=o.b2DotVV(this.m_normals[n],o.b2SubVV(s,this.m_vertices[n],o.b2Vec2.s_t0));if(a>0)return!1}return!0},e.prototype.RayCast=function(t,i,s,r){for(var a=o.b2MulTXV(s,i.p1,e.RayCast_s_p1),_=o.b2MulTXV(s,i.p2,e.RayCast_s_p2),m=o.b2SubVV(_,a,e.RayCast_s_d),h=0,l=i.maxFraction,c=-1,u=0,p=this.m_count;u<p;++u){var b=o.b2DotVV(this.m_normals[u],o.b2SubVV(this.m_vertices[u],a,o.b2Vec2.s_t0)),y=o.b2DotVV(this.m_normals[u],m);if(0==y){if(b<0)return!1}else y<0&&b<h*y?(h=b/y,c=u):y>0&&b<l*y&&(l=b/y);if(l<h)return!1}return n.ENABLE_ASSERTS&&n.b2Assert(0<=h&&h<=i.maxFraction),c>=0&&(t.fraction=h,o.b2MulRV(s.q,this.m_normals[c],t.normal),!0)},e.prototype.ComputeAABB=function(t,i,s){for(var n=o.b2MulXV(i,this.m_vertices[0],t.lowerBound),r=t.upperBound.Copy(n),a=0,_=this.m_count;a<_;++a){var m=o.b2MulXV(i,this.m_vertices[a],e.ComputeAABB_s_v);o.b2MinV(m,n,n),o.b2MaxV(m,r,r)}var h=this.m_radius;n.SelfSubXY(h,h),r.SelfAddXY(h,h)},e.prototype.ComputeMass=function(t,i){n.ENABLE_ASSERTS&&n.b2Assert(this.m_count>=3);for(var s=e.ComputeMass_s_center.SetZero(),r=0,a=0,_=e.ComputeMass_s_s.SetZero(),m=0,h=this.m_count;m<h;++m)_.SelfAdd(this.m_vertices[m]);_.SelfMul(1/this.m_count);for(var l=1/3,m=0,h=this.m_count;m<h;++m){var c=o.b2SubVV(this.m_vertices[m],_,e.ComputeMass_s_e1),u=o.b2SubVV(this.m_vertices[(m+1)%h],_,e.ComputeMass_s_e2),p=o.b2CrossVV(c,u),b=.5*p;r+=b,s.SelfAdd(o.b2MulSV(b*l,o.b2AddVV(c,u,o.b2Vec2.s_t0),o.b2Vec2.s_t1));var y=c.x,d=c.y,f=u.x,A=u.y,v=y*y+f*y+f*f,S=d*d+A*d+A*A;a+=.25*l*p*(v+S)}t.mass=i*r,n.ENABLE_ASSERTS&&n.b2Assert(r>n.b2_epsilon),s.SelfMul(1/r),o.b2AddVV(s,_,t.center),t.I=i*a,t.I+=t.mass*(o.b2DotVV(t.center,t.center)-o.b2DotVV(s,s))},e.prototype.Validate=function(){for(var t=0;t<this.m_count;++t)for(var i=t,s=(t+1)%this.m_count,n=this.m_vertices[i],r=o.b2SubVV(this.m_vertices[s],n,e.Validate_s_e),a=0;a<this.m_count;++a)if(a!=i&&a!=s){var _=o.b2SubVV(this.m_vertices[a],n,e.Validate_s_v),m=o.b2CrossVV(r,_);if(m<0)return!1}return!0},e.prototype.SetupDistanceProxy=function(t,e){t.m_vertices=this.m_vertices,t.m_count=this.m_count,t.m_radius=this.m_radius},e.prototype.ComputeSubmergedArea=function(t,i,s,r){for(var a=o.b2MulTRV(s.q,t,e.ComputeSubmergedArea_s_normalL),_=i-o.b2DotVV(t,s.p),m=e.ComputeSubmergedArea_s_depths,h=0,l=-1,c=-1,u=!1,p=0,b=this.m_count;p<b;++p){m[p]=o.b2DotVV(a,this.m_vertices[p])-_;var y=m[p]<-n.b2_epsilon;p>0&&(y?u||(l=p-1,h++):u&&(c=p-1,h++)),u=y}switch(h){case 0:if(u){var d=e.ComputeSubmergedArea_s_md;return this.ComputeMass(d,1),o.b2MulXV(s,d.center,r),d.mass}return 0;case 1:l==-1?l=this.m_count-1:c=this.m_count-1}for(var f=(l+1)%this.m_count,A=(c+1)%this.m_count,v=(0-m[l])/(m[f]-m[l]),S=(0-m[c])/(m[A]-m[c]),V=e.ComputeSubmergedArea_s_intoVec.SetXY(this.m_vertices[l].x*(1-v)+this.m_vertices[f].x*v,this.m_vertices[l].y*(1-v)+this.m_vertices[f].y*v),x=e.ComputeSubmergedArea_s_outoVec.SetXY(this.m_vertices[c].x*(1-S)+this.m_vertices[A].x*S,this.m_vertices[c].y*(1-S)+this.m_vertices[A].y*S),C=0,B=e.ComputeSubmergedArea_s_center.SetZero(),g=this.m_vertices[f],w=null,p=f;p!=A;){p=(p+1)%this.m_count,w=p==A?x:this.m_vertices[p];var M=.5*((g.x-V.x)*(w.y-V.y)-(g.y-V.y)*(w.x-V.x));C+=M,B.x+=M*(V.x+g.x+w.x)/3,B.y+=M*(V.y+g.y+w.y)/3,g=w}return B.SelfMul(1/C),o.b2MulXV(s,B,r),C},e.prototype.Dump=function(){n.b2Log("    var shape: b2PolygonShape = new b2PolygonShape();\n"),n.b2Log("    var vs: b2Vec2[] = b2Vec2.MakeArray(%d);\n",n.b2_maxPolygonVertices);for(var t=0;t<this.m_count;++t)n.b2Log("    vs[%d].SetXY(%.15f, %.15f);\n",t,this.m_vertices[t].x,this.m_vertices[t].y);n.b2Log("    shape.SetAsVector(vs, %d);\n",this.m_count)},e.ComputeCentroid=function(t,i,s){n.ENABLE_ASSERTS&&n.b2Assert(i>=3);var r=s;r.SetZero();for(var a=0,_=e.ComputeCentroid_s_pRef.SetZero(),m=1/3,h=0;h<i;++h){var l=_,c=t[h],u=t[(h+1)%i],p=o.b2SubVV(c,l,e.ComputeCentroid_s_e1),b=o.b2SubVV(u,l,e.ComputeCentroid_s_e2),y=o.b2CrossVV(p,b),d=.5*y;a+=d,r.x+=d*m*(l.x+c.x+u.x),r.y+=d*m*(l.y+c.y+u.y)}return n.ENABLE_ASSERTS&&n.b2Assert(a>n.b2_epsilon),r.SelfMul(1/a),r},e.SetAsVector_s_ps=o.b2Vec2.MakeArray(n.b2_maxPolygonVertices),e.SetAsVector_s_hull=n.b2MakeNumberArray(n.b2_maxPolygonVertices),e.SetAsVector_s_r=new o.b2Vec2,e.SetAsVector_s_v=new o.b2Vec2,e.TestPoint_s_pLocal=new o.b2Vec2,e.RayCast_s_p1=new o.b2Vec2,e.RayCast_s_p2=new o.b2Vec2,e.RayCast_s_d=new o.b2Vec2,e.ComputeAABB_s_v=new o.b2Vec2,e.ComputeMass_s_center=new o.b2Vec2,e.ComputeMass_s_s=new o.b2Vec2,e.ComputeMass_s_e1=new o.b2Vec2,e.ComputeMass_s_e2=new o.b2Vec2,e.Validate_s_e=new o.b2Vec2,e.Validate_s_v=new o.b2Vec2,e.ComputeSubmergedArea_s_normalL=new o.b2Vec2,e.ComputeSubmergedArea_s_depths=n.b2MakeNumberArray(n.b2_maxPolygonVertices),e.ComputeSubmergedArea_s_md=new r.b2MassData,e.ComputeSubmergedArea_s_intoVec=new o.b2Vec2,e.ComputeSubmergedArea_s_outoVec=new o.b2Vec2,e.ComputeSubmergedArea_s_center=new o.b2Vec2,e.ComputeCentroid_s_pRef=new o.b2Vec2,e.ComputeCentroid_s_e1=new o.b2Vec2,e.ComputeCentroid_s_e2=new o.b2Vec2,e}(r.b2Shape);e.b2PolygonShape=a},function(t,e,i){"use strict";var s=i(4),o=function(){function t(t,e,i){this._r=127,this._g=127,this._b=127,this._r=s.b2Clamp(Math.round(255*t),0,255),this._g=s.b2Clamp(Math.round(255*e),0,255),this._b=s.b2Clamp(Math.round(255*i),0,255)}return t.prototype.SetRGB=function(t,e,i){return this._r=s.b2Clamp(Math.round(255*t),0,255),this._g=s.b2Clamp(Math.round(255*e),0,255),this._b=s.b2Clamp(Math.round(255*i),0,255),this},t.prototype.MakeStyleString=function(e){return void 0===e&&(e=1),t.MakeStyleString(this._r,this._g,this._b,e)},t.MakeStyleString=function(t,e,i,s){return void 0===s&&(s=1),s<1?"rgba("+t+","+e+","+i+","+s+")":"rgb("+t+","+e+","+i+")"},t.RED=new t(1,0,0),t.GREEN=new t(0,1,0),t.BLUE=new t(0,0,1),t}();e.b2Color=o,function(t){t[t.e_none=0]="e_none",t[t.e_shapeBit=1]="e_shapeBit",t[t.e_jointBit=2]="e_jointBit",t[t.e_aabbBit=4]="e_aabbBit",t[t.e_pairBit=8]="e_pairBit",t[t.e_centerOfMassBit=16]="e_centerOfMassBit",t[t.e_controllerBit=32]="e_controllerBit",t[t.e_all=63]="e_all"}(e.b2DrawFlags||(e.b2DrawFlags={}));var n=(e.b2DrawFlags,function(){function t(){this.m_drawFlags=0}return t.prototype.SetFlags=function(t){this.m_drawFlags=t},t.prototype.GetFlags=function(){return this.m_drawFlags},t.prototype.AppendFlags=function(t){this.m_drawFlags|=t},t.prototype.ClearFlags=function(t){this.m_drawFlags&=~t},t.prototype.PushTransform=function(t){},t.prototype.PopTransform=function(t){},t.prototype.DrawPolygon=function(t,e,i){},t.prototype.DrawSolidPolygon=function(t,e,i){},t.prototype.DrawCircle=function(t,e,i){},t.prototype.DrawSolidCircle=function(t,e,i,s){},t.prototype.DrawSegment=function(t,e,i){},t.prototype.DrawTransform=function(t){},t}());e.b2Draw=n},function(t,e,i){"use strict";var s=i(3),o=i(4),n=i(14),r=i(20),a=i(21);!function(t){t[t.b2_unknown=-1]="b2_unknown",t[t.b2_staticBody=0]="b2_staticBody",t[t.b2_kinematicBody=1]="b2_kinematicBody",t[t.b2_dynamicBody=2]="b2_dynamicBody"}(e.b2BodyType||(e.b2BodyType={}));var _=e.b2BodyType,m=function(){function t(){this.type=_.b2_staticBody,this.position=new o.b2Vec2(0,0),this.angle=0,this.linearVelocity=new o.b2Vec2(0,0),this.angularVelocity=0,this.linearDamping=0,this.angularDamping=0,this.allowSleep=!0,this.awake=!0,this.fixedRotation=!1,this.bullet=!1,this.active=!0,this.userData=null,this.gravityScale=1}return t}();e.b2BodyDef=m,function(t){t[t.e_none=0]="e_none",t[t.e_islandFlag=1]="e_islandFlag",t[t.e_awakeFlag=2]="e_awakeFlag",t[t.e_autoSleepFlag=4]="e_autoSleepFlag",t[t.e_bulletFlag=8]="e_bulletFlag",t[t.e_fixedRotationFlag=16]="e_fixedRotationFlag",t[t.e_activeFlag=32]="e_activeFlag",t[t.e_toiFlag=64]="e_toiFlag"}(e.b2BodyFlag||(e.b2BodyFlag={}));var h=e.b2BodyFlag,l=function(){function t(t,e){this.m_type=_.b2_staticBody,this.m_flags=h.e_none,this.m_islandIndex=0,this.m_xf=new o.b2Transform,this.m_sweep=new o.b2Sweep,this.m_linearVelocity=new o.b2Vec2,this.m_angularVelocity=0,this.m_force=new o.b2Vec2,this.m_torque=0,this.m_world=null,this.m_prev=null,this.m_next=null,this.m_fixtureList=null,this.m_fixtureCount=0,this.m_jointList=null,this.m_contactList=null,this.m_mass=1,this.m_invMass=1,this.m_I=0,this.m_invI=0,this.m_linearDamping=0,this.m_angularDamping=0,this.m_gravityScale=1,this.m_sleepTime=0,this.m_userData=null,s.ENABLE_ASSERTS&&s.b2Assert(t.position.IsValid()),s.ENABLE_ASSERTS&&s.b2Assert(t.linearVelocity.IsValid()),s.ENABLE_ASSERTS&&s.b2Assert(o.b2IsValid(t.angle)),s.ENABLE_ASSERTS&&s.b2Assert(o.b2IsValid(t.angularVelocity)),s.ENABLE_ASSERTS&&s.b2Assert(o.b2IsValid(t.gravityScale)&&t.gravityScale>=0),s.ENABLE_ASSERTS&&s.b2Assert(o.b2IsValid(t.angularDamping)&&t.angularDamping>=0),s.ENABLE_ASSERTS&&s.b2Assert(o.b2IsValid(t.linearDamping)&&t.linearDamping>=0),this.m_flags=h.e_none,t.bullet&&(this.m_flags|=h.e_bulletFlag),t.fixedRotation&&(this.m_flags|=h.e_fixedRotationFlag),t.allowSleep&&(this.m_flags|=h.e_autoSleepFlag),t.awake&&(this.m_flags|=h.e_awakeFlag),t.active&&(this.m_flags|=h.e_activeFlag),this.m_world=e,this.m_xf.p.Copy(t.position),this.m_xf.q.SetAngleRadians(t.angle),this.m_sweep.localCenter.SetZero(),this.m_sweep.c0.Copy(this.m_xf.p),this.m_sweep.c.Copy(this.m_xf.p),this.m_sweep.a0=t.angle,this.m_sweep.a=t.angle,this.m_sweep.alpha0=0,this.m_linearVelocity.Copy(t.linearVelocity),this.m_angularVelocity=t.angularVelocity,this.m_linearDamping=t.linearDamping,this.m_angularDamping=t.angularDamping,this.m_gravityScale=t.gravityScale,this.m_force.SetZero(),this.m_torque=0,this.m_sleepTime=0,this.m_type=t.type,t.type==_.b2_dynamicBody?(this.m_mass=1,this.m_invMass=1):(this.m_mass=0,this.m_invMass=0),this.m_I=0,this.m_invI=0,this.m_userData=t.userData,this.m_fixtureList=null,this.m_fixtureCount=0}return t.prototype.CreateFixture=function(t){if(s.ENABLE_ASSERTS&&s.b2Assert(0==this.m_world.IsLocked()),1==this.m_world.IsLocked())return null;var e=new r.b2Fixture;if(e.Create(this,t),this.m_flags&h.e_activeFlag){var i=this.m_world.m_contactManager.m_broadPhase;e.CreateProxies(i,this.m_xf)}return e.m_next=this.m_fixtureList,this.m_fixtureList=e,++this.m_fixtureCount,e.m_body=this,e.m_density>0&&this.ResetMassData(),this.m_world.m_flags|=a.b2WorldFlag.e_newFixture,e},t.prototype.CreateFixture2=function(e,i){void 0===i&&(i=0);var s=t.CreateFixture2_s_def;return s.shape=e,s.density=i,this.CreateFixture(s)},t.prototype.DestroyFixture=function(t){if(s.ENABLE_ASSERTS&&s.b2Assert(0==this.m_world.IsLocked()),1!=this.m_world.IsLocked()){s.ENABLE_ASSERTS&&s.b2Assert(t.m_body==this),s.ENABLE_ASSERTS&&s.b2Assert(this.m_fixtureCount>0);for(var e=this.m_fixtureList,i=null,o=!1;null!=e;){if(e==t){i?i.m_next=t.m_next:this.m_fixtureList=t.m_next,o=!0;break}i=e,e=e.m_next}s.ENABLE_ASSERTS&&s.b2Assert(o);for(var n=this.m_contactList;n;){var r=n.contact;n=n.next;var a=r.GetFixtureA(),_=r.GetFixtureB();t!=a&&t!=_||this.m_world.m_contactManager.Destroy(r)}if(this.m_flags&h.e_activeFlag){var m=this.m_world.m_contactManager.m_broadPhase;t.DestroyProxies(m)}t.Destroy(),t.m_body=null,t.m_next=null,--this.m_fixtureCount,this.ResetMassData()}},t.prototype.SetTransformVecRadians=function(t,e){this.SetTransformXYRadians(t.x,t.y,e)},t.prototype.SetTransformXYRadians=function(t,e,i){if(s.ENABLE_ASSERTS&&s.b2Assert(0==this.m_world.IsLocked()),1!=this.m_world.IsLocked()){this.m_xf.q.SetAngleRadians(i),this.m_xf.p.SetXY(t,e),o.b2MulXV(this.m_xf,this.m_sweep.localCenter,this.m_sweep.c),this.m_sweep.a=i,this.m_sweep.c0.Copy(this.m_sweep.c),this.m_sweep.a0=i;for(var n=this.m_world.m_contactManager.m_broadPhase,r=this.m_fixtureList;r;r=r.m_next)r.Synchronize(n,this.m_xf,this.m_xf);this.m_world.m_contactManager.FindNewContacts()}},t.prototype.SetTransform=function(t){this.SetTransformVecRadians(t.p,t.GetAngleRadians())},t.prototype.GetTransform=function(){return this.m_xf},t.prototype.GetPosition=function(){return this.m_xf.p},t.prototype.SetPosition=function(t){this.SetTransformVecRadians(t,this.GetAngleRadians())},t.prototype.SetPositionXY=function(t,e){this.SetTransformXYRadians(t,e,this.GetAngleRadians())},t.prototype.GetAngleRadians=function(){return this.m_sweep.a},t.prototype.SetAngleRadians=function(t){this.SetTransformVecRadians(this.GetPosition(),t)},t.prototype.GetWorldCenter=function(){return this.m_sweep.c},t.prototype.GetLocalCenter=function(){return this.m_sweep.localCenter},t.prototype.SetLinearVelocity=function(t){this.m_type!=_.b2_staticBody&&(o.b2DotVV(t,t)>0&&this.SetAwake(!0),this.m_linearVelocity.Copy(t))},t.prototype.GetLinearVelocity=function(){return this.m_linearVelocity},t.prototype.SetAngularVelocity=function(t){this.m_type!=_.b2_staticBody&&(t*t>0&&this.SetAwake(!0),this.m_angularVelocity=t)},t.prototype.GetAngularVelocity=function(){return this.m_angularVelocity},t.prototype.GetDefinition=function(t){return t.type=this.GetType(),t.allowSleep=(this.m_flags&h.e_autoSleepFlag)==h.e_autoSleepFlag,
t.angle=this.GetAngleRadians(),t.angularDamping=this.m_angularDamping,t.gravityScale=this.m_gravityScale,t.angularVelocity=this.m_angularVelocity,t.fixedRotation=(this.m_flags&h.e_fixedRotationFlag)==h.e_fixedRotationFlag,t.bullet=(this.m_flags&h.e_bulletFlag)==h.e_bulletFlag,t.awake=(this.m_flags&h.e_awakeFlag)==h.e_awakeFlag,t.linearDamping=this.m_linearDamping,t.linearVelocity.Copy(this.GetLinearVelocity()),t.position.Copy(this.GetPosition()),t.userData=this.GetUserData(),t},t.prototype.ApplyForce=function(t,e,i){void 0===i&&(i=!0),this.m_type==_.b2_dynamicBody&&(i&&0==(this.m_flags&h.e_awakeFlag)&&this.SetAwake(!0),this.m_flags&h.e_awakeFlag&&(this.m_force.x+=t.x,this.m_force.y+=t.y,this.m_torque+=(e.x-this.m_sweep.c.x)*t.y-(e.y-this.m_sweep.c.y)*t.x))},t.prototype.ApplyForceToCenter=function(t,e){void 0===e&&(e=!0),this.m_type==_.b2_dynamicBody&&(e&&0==(this.m_flags&h.e_awakeFlag)&&this.SetAwake(!0),this.m_flags&h.e_awakeFlag&&(this.m_force.x+=t.x,this.m_force.y+=t.y))},t.prototype.ApplyTorque=function(t,e){void 0===e&&(e=!0),this.m_type==_.b2_dynamicBody&&(e&&0==(this.m_flags&h.e_awakeFlag)&&this.SetAwake(!0),this.m_flags&h.e_awakeFlag&&(this.m_torque+=t))},t.prototype.ApplyLinearImpulse=function(t,e,i){void 0===i&&(i=!0),this.m_type==_.b2_dynamicBody&&(i&&0==(this.m_flags&h.e_awakeFlag)&&this.SetAwake(!0),this.m_flags&h.e_awakeFlag&&(this.m_linearVelocity.x+=this.m_invMass*t.x,this.m_linearVelocity.y+=this.m_invMass*t.y,this.m_angularVelocity+=this.m_invI*((e.x-this.m_sweep.c.x)*t.y-(e.y-this.m_sweep.c.y)*t.x)))},t.prototype.ApplyAngularImpulse=function(t,e){void 0===e&&(e=!0),this.m_type==_.b2_dynamicBody&&(e&&0==(this.m_flags&h.e_awakeFlag)&&this.SetAwake(!0),this.m_flags&h.e_awakeFlag&&(this.m_angularVelocity+=this.m_invI*t))},t.prototype.GetMass=function(){return this.m_mass},t.prototype.GetInertia=function(){return this.m_I+this.m_mass*o.b2DotVV(this.m_sweep.localCenter,this.m_sweep.localCenter)},t.prototype.GetMassData=function(t){return t.mass=this.m_mass,t.I=this.m_I+this.m_mass*o.b2DotVV(this.m_sweep.localCenter,this.m_sweep.localCenter),t.center.Copy(this.m_sweep.localCenter),t},t.prototype.SetMassData=function(e){if(s.ENABLE_ASSERTS&&s.b2Assert(0==this.m_world.IsLocked()),1!=this.m_world.IsLocked()&&this.m_type==_.b2_dynamicBody){this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_mass=e.mass,this.m_mass<=0&&(this.m_mass=1),this.m_invMass=1/this.m_mass,e.I>0&&0==(this.m_flags&h.e_fixedRotationFlag)&&(this.m_I=e.I-this.m_mass*o.b2DotVV(e.center,e.center),s.ENABLE_ASSERTS&&s.b2Assert(this.m_I>0),this.m_invI=1/this.m_I);var i=t.SetMassData_s_oldCenter.Copy(this.m_sweep.c);this.m_sweep.localCenter.Copy(e.center),o.b2MulXV(this.m_xf,this.m_sweep.localCenter,this.m_sweep.c),this.m_sweep.c0.Copy(this.m_sweep.c),o.b2AddVCrossSV(this.m_linearVelocity,this.m_angularVelocity,o.b2SubVV(this.m_sweep.c,i,o.b2Vec2.s_t0),this.m_linearVelocity)}},t.prototype.ResetMassData=function(){if(this.m_mass=0,this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_sweep.localCenter.SetZero(),this.m_type==_.b2_staticBody||this.m_type==_.b2_kinematicBody)return this.m_sweep.c0.Copy(this.m_xf.p),this.m_sweep.c.Copy(this.m_xf.p),void(this.m_sweep.a0=this.m_sweep.a);s.ENABLE_ASSERTS&&s.b2Assert(this.m_type==_.b2_dynamicBody);for(var e=t.ResetMassData_s_localCenter.SetZero(),i=this.m_fixtureList;i;i=i.m_next)if(0!=i.m_density){var n=i.GetMassData(t.ResetMassData_s_massData);this.m_mass+=n.mass,e.x+=n.center.x*n.mass,e.y+=n.center.y*n.mass,this.m_I+=n.I}this.m_mass>0?(this.m_invMass=1/this.m_mass,e.x*=this.m_invMass,e.y*=this.m_invMass):(this.m_mass=1,this.m_invMass=1),this.m_I>0&&0==(this.m_flags&h.e_fixedRotationFlag)?(this.m_I-=this.m_mass*o.b2DotVV(e,e),s.ENABLE_ASSERTS&&s.b2Assert(this.m_I>0),this.m_invI=1/this.m_I):(this.m_I=0,this.m_invI=0);var r=t.ResetMassData_s_oldCenter.Copy(this.m_sweep.c);this.m_sweep.localCenter.Copy(e),o.b2MulXV(this.m_xf,this.m_sweep.localCenter,this.m_sweep.c),this.m_sweep.c0.Copy(this.m_sweep.c),o.b2AddVCrossSV(this.m_linearVelocity,this.m_angularVelocity,o.b2SubVV(this.m_sweep.c,r,o.b2Vec2.s_t0),this.m_linearVelocity)},t.prototype.GetWorldPoint=function(t,e){return o.b2MulXV(this.m_xf,t,e)},t.prototype.GetWorldVector=function(t,e){return o.b2MulRV(this.m_xf.q,t,e)},t.prototype.GetLocalPoint=function(t,e){return o.b2MulTXV(this.m_xf,t,e)},t.prototype.GetLocalVector=function(t,e){return o.b2MulTRV(this.m_xf.q,t,e)},t.prototype.GetLinearVelocityFromWorldPoint=function(t,e){return o.b2AddVCrossSV(this.m_linearVelocity,this.m_angularVelocity,o.b2SubVV(t,this.m_sweep.c,o.b2Vec2.s_t0),e)},t.prototype.GetLinearVelocityFromLocalPoint=function(t,e){return this.GetLinearVelocityFromWorldPoint(this.GetWorldPoint(t,e),e)},t.prototype.GetLinearDamping=function(){return this.m_linearDamping},t.prototype.SetLinearDamping=function(t){this.m_linearDamping=t},t.prototype.GetAngularDamping=function(){return this.m_angularDamping},t.prototype.SetAngularDamping=function(t){this.m_angularDamping=t},t.prototype.GetGravityScale=function(){return this.m_gravityScale},t.prototype.SetGravityScale=function(t){this.m_gravityScale=t},t.prototype.SetType=function(t){if(s.ENABLE_ASSERTS&&s.b2Assert(0==this.m_world.IsLocked()),1!=this.m_world.IsLocked()&&this.m_type!=t){this.m_type=t,this.ResetMassData(),this.m_type==_.b2_staticBody&&(this.m_linearVelocity.SetZero(),this.m_angularVelocity=0,this.m_sweep.a0=this.m_sweep.a,this.m_sweep.c0.Copy(this.m_sweep.c),this.SynchronizeFixtures()),this.SetAwake(!0),this.m_force.SetZero(),this.m_torque=0;for(var e=this.m_contactList;e;){var i=e;e=e.next,this.m_world.m_contactManager.Destroy(i.contact)}this.m_contactList=null;for(var o=this.m_world.m_contactManager.m_broadPhase,n=this.m_fixtureList;n;n=n.m_next)for(var r=n.m_proxyCount,a=0;a<r;++a)o.TouchProxy(n.m_proxies[a].proxy)}},t.prototype.GetType=function(){return this.m_type},t.prototype.SetBullet=function(t){t?this.m_flags|=h.e_bulletFlag:this.m_flags&=~h.e_bulletFlag},t.prototype.IsBullet=function(){return(this.m_flags&h.e_bulletFlag)==h.e_bulletFlag},t.prototype.SetSleepingAllowed=function(t){t?this.m_flags|=h.e_autoSleepFlag:(this.m_flags&=~h.e_autoSleepFlag,this.SetAwake(!0))},t.prototype.IsSleepingAllowed=function(){return(this.m_flags&h.e_autoSleepFlag)==h.e_autoSleepFlag},t.prototype.SetAwake=function(t){t?0==(this.m_flags&h.e_awakeFlag)&&(this.m_flags|=h.e_awakeFlag,this.m_sleepTime=0):(this.m_flags&=~h.e_awakeFlag,this.m_sleepTime=0,this.m_linearVelocity.SetZero(),this.m_angularVelocity=0,this.m_force.SetZero(),this.m_torque=0)},t.prototype.IsAwake=function(){return(this.m_flags&h.e_awakeFlag)==h.e_awakeFlag},t.prototype.SetActive=function(t){if(s.ENABLE_ASSERTS&&s.b2Assert(0==this.m_world.IsLocked()),t!=this.IsActive())if(t){this.m_flags|=h.e_activeFlag;for(var e=this.m_world.m_contactManager.m_broadPhase,i=this.m_fixtureList;i;i=i.m_next)i.CreateProxies(e,this.m_xf)}else{this.m_flags&=~h.e_activeFlag;for(var e=this.m_world.m_contactManager.m_broadPhase,i=this.m_fixtureList;i;i=i.m_next)i.DestroyProxies(e);for(var o=this.m_contactList;o;){var n=o;o=o.next,this.m_world.m_contactManager.Destroy(n.contact)}this.m_contactList=null}},t.prototype.IsActive=function(){return(this.m_flags&h.e_activeFlag)==h.e_activeFlag},t.prototype.SetFixedRotation=function(t){var e=(this.m_flags&h.e_fixedRotationFlag)==h.e_fixedRotationFlag;e!=t&&(t?this.m_flags|=h.e_fixedRotationFlag:this.m_flags&=~h.e_fixedRotationFlag,this.m_angularVelocity=0,this.ResetMassData())},t.prototype.IsFixedRotation=function(){return(this.m_flags&h.e_fixedRotationFlag)==h.e_fixedRotationFlag},t.prototype.GetFixtureList=function(){return this.m_fixtureList},t.prototype.GetJointList=function(){return this.m_jointList},t.prototype.GetContactList=function(){return this.m_contactList},t.prototype.GetNext=function(){return this.m_next},t.prototype.GetUserData=function(){return this.m_userData},t.prototype.SetUserData=function(t){this.m_userData=t},t.prototype.GetWorld=function(){return this.m_world},t.prototype.Dump=function(){if(s.DEBUG){var t=this.m_islandIndex;s.b2Log("{\n"),s.b2Log("  var bd: b2BodyDef = new b2BodyDef();\n");var e="";switch(this.m_type){case _.b2_staticBody:e="b2BodyType.b2_staticBody";break;case _.b2_kinematicBody:e="b2BodyType.b2_kinematicBody";break;case _.b2_dynamicBody:e="b2BodyType.b2_dynamicBody";break;default:s.ENABLE_ASSERTS&&s.b2Assert(!1)}s.b2Log("  bd.type = %s;\n",e),s.b2Log("  bd.position.SetXY(%.15f, %.15f);\n",this.m_xf.p.x,this.m_xf.p.y),s.b2Log("  bd.angle = %.15f;\n",this.m_sweep.a),s.b2Log("  bd.linearVelocity.SetXY(%.15f, %.15f);\n",this.m_linearVelocity.x,this.m_linearVelocity.y),s.b2Log("  bd.angularVelocity = %.15f;\n",this.m_angularVelocity),s.b2Log("  bd.linearDamping = %.15f;\n",this.m_linearDamping),s.b2Log("  bd.angularDamping = %.15f;\n",this.m_angularDamping),s.b2Log("  bd.allowSleep = %s;\n",this.m_flags&h.e_autoSleepFlag?"true":"false"),s.b2Log("  bd.awake = %s;\n",this.m_flags&h.e_awakeFlag?"true":"false"),s.b2Log("  bd.fixedRotation = %s;\n",this.m_flags&h.e_fixedRotationFlag?"true":"false"),s.b2Log("  bd.bullet = %s;\n",this.m_flags&h.e_bulletFlag?"true":"false"),s.b2Log("  bd.active = %s;\n",this.m_flags&h.e_activeFlag?"true":"false"),s.b2Log("  bd.gravityScale = %.15f;\n",this.m_gravityScale),s.b2Log("\n"),s.b2Log("  bodies[%d] = this.m_world.CreateBody(bd);\n",this.m_islandIndex),s.b2Log("\n");for(var i=this.m_fixtureList;i;i=i.m_next)s.b2Log("  {\n"),i.Dump(t),s.b2Log("  }\n");s.b2Log("}\n")}},t.prototype.SynchronizeFixtures=function(){var e=t.SynchronizeFixtures_s_xf1;e.q.SetAngleRadians(this.m_sweep.a0),o.b2MulRV(e.q,this.m_sweep.localCenter,e.p),o.b2SubVV(this.m_sweep.c0,e.p,e.p);for(var i=this.m_world.m_contactManager.m_broadPhase,s=this.m_fixtureList;s;s=s.m_next)s.Synchronize(i,e,this.m_xf)},t.prototype.SynchronizeTransform=function(){this.m_xf.q.SetAngleRadians(this.m_sweep.a),o.b2MulRV(this.m_xf.q,this.m_sweep.localCenter,this.m_xf.p),o.b2SubVV(this.m_sweep.c,this.m_xf.p,this.m_xf.p)},t.prototype.ShouldCollide=function(t){if(this.m_type!=_.b2_dynamicBody&&t.m_type!=_.b2_dynamicBody)return!1;for(var e=this.m_jointList;e;e=e.next)if(e.other==t&&0==e.joint.m_collideConnected)return!1;return!0},t.prototype.Advance=function(t){this.m_sweep.Advance(t),this.m_sweep.c.Copy(this.m_sweep.c0),this.m_sweep.a=this.m_sweep.a0,this.m_xf.q.SetAngleRadians(this.m_sweep.a),o.b2MulRV(this.m_xf.q,this.m_sweep.localCenter,this.m_xf.p),o.b2SubVV(this.m_sweep.c,this.m_xf.p,this.m_xf.p)},t.CreateFixture2_s_def=new r.b2FixtureDef,t.SetMassData_s_oldCenter=new o.b2Vec2,t.ResetMassData_s_localCenter=new o.b2Vec2,t.ResetMassData_s_oldCenter=new o.b2Vec2,t.ResetMassData_s_massData=new n.b2MassData,t.SynchronizeFixtures_s_xf1=new o.b2Transform,t}();e.b2Body=l},function(t,e,i){"use strict";var s=i(3),o=i(2),n=i(14),r=i(4),a=function(){function t(){this.categoryBits=1,this.maskBits=65535,this.groupIndex=0}return t.prototype.Clone=function(){return(new t).Copy(this)},t.prototype.Copy=function(t){return this.categoryBits=t.categoryBits,this.maskBits=t.maskBits,this.groupIndex=t.groupIndex,this},t}();e.b2Filter=a;var _=function(){function t(){this.shape=null,this.userData=null,this.friction=.2,this.restitution=0,this.density=0,this.isSensor=!1,this.filter=new a}return t}();e.b2FixtureDef=_;var m=function(){function t(){this.aabb=new o.b2AABB,this.fixture=null,this.childIndex=0,this.proxy=null}return t.MakeArray=function(e){return s.b2MakeArray(e,function(e){return new t})},t}();e.b2FixtureProxy=m;var h=function(){function t(){this.m_density=0,this.m_next=null,this.m_body=null,this.m_shape=null,this.m_friction=0,this.m_restitution=0,this.m_proxies=null,this.m_proxyCount=0,this.m_filter=new a,this.m_isSensor=!1,this.m_userData=null}return t.prototype.GetType=function(){return this.m_shape.GetType()},t.prototype.GetShape=function(){return this.m_shape},t.prototype.SetSensor=function(t){t!=this.m_isSensor&&(this.m_body.SetAwake(!0),this.m_isSensor=t)},t.prototype.IsSensor=function(){return this.m_isSensor},t.prototype.SetFilterData=function(t){this.m_filter.Copy(t),this.Refilter()},t.prototype.GetFilterData=function(){return this.m_filter},t.prototype.Refilter=function(){if(!this.m_body){for(var t=this.m_body.GetContactList();t;){var e=t.contact,i=e.GetFixtureA(),s=e.GetFixtureB();i!=this&&s!=this||e.FlagForFiltering(),t=t.next}var o=this.m_body.GetWorld();if(null!==o)for(var n=o.m_contactManager.m_broadPhase,r=0;r<this.m_proxyCount;++r)n.TouchProxy(this.m_proxies[r].proxy)}},t.prototype.GetBody=function(){return this.m_body},t.prototype.GetNext=function(){return this.m_next},t.prototype.GetUserData=function(){return this.m_userData},t.prototype.SetUserData=function(t){this.m_userData=t},t.prototype.TestPoint=function(t){return this.m_shape.TestPoint(this.m_body.GetTransform(),t)},t.prototype.RayCast=function(t,e,i){return this.m_shape.RayCast(t,e,this.m_body.GetTransform(),i)},t.prototype.GetMassData=function(t){return void 0===t&&(t=new n.b2MassData),this.m_shape.ComputeMass(t,this.m_density),t},t.prototype.SetDensity=function(t){this.m_density=t},t.prototype.GetDensity=function(){return this.m_density},t.prototype.GetFriction=function(){return this.m_friction},t.prototype.SetFriction=function(t){this.m_friction=t},t.prototype.GetRestitution=function(){return this.m_restitution},t.prototype.SetRestitution=function(t){this.m_restitution=t},t.prototype.GetAABB=function(t){return s.ENABLE_ASSERTS&&s.b2Assert(0<=t&&t<this.m_proxyCount),this.m_proxies[t].aabb},t.prototype.Dump=function(t){s.DEBUG&&(s.b2Log("    var fd: b2FixtureDef = new b2FixtureDef();\n"),s.b2Log("    fd.friction = %.15f;\n",this.m_friction),s.b2Log("    fd.restitution = %.15f;\n",this.m_restitution),s.b2Log("    fd.density = %.15f;\n",this.m_density),s.b2Log("    fd.isSensor = %s;\n",this.m_isSensor?"true":"false"),s.b2Log("    fd.filter.categoryBits = %d;\n",this.m_filter.categoryBits),s.b2Log("    fd.filter.maskBits = %d;\n",this.m_filter.maskBits),s.b2Log("    fd.filter.groupIndex = %d;\n",this.m_filter.groupIndex),this.m_shape.Dump(),s.b2Log("\n"),s.b2Log("    fd.shape = shape;\n"),s.b2Log("\n"),s.b2Log("    bodies[%d].CreateFixture(fd);\n",t))},t.prototype.Create=function(t,e){this.m_userData=e.userData,this.m_friction=e.friction,this.m_restitution=e.restitution,this.m_body=t,this.m_next=null,this.m_filter.Copy(e.filter),this.m_isSensor=e.isSensor,this.m_shape=e.shape.Clone(),this.m_proxies=m.MakeArray(this.m_shape.GetChildCount()),this.m_proxyCount=0,this.m_density=e.density},t.prototype.Destroy=function(){s.ENABLE_ASSERTS&&s.b2Assert(0==this.m_proxyCount),this.m_shape=null},t.prototype.CreateProxies=function(t,e){s.ENABLE_ASSERTS&&s.b2Assert(0==this.m_proxyCount),this.m_proxyCount=this.m_shape.GetChildCount();for(var i=0;i<this.m_proxyCount;++i){var o=this.m_proxies[i];this.m_shape.ComputeAABB(o.aabb,e,i),o.proxy=t.CreateProxy(o.aabb,o),o.fixture=this,o.childIndex=i}},t.prototype.DestroyProxies=function(t){for(var e=0;e<this.m_proxyCount;++e){var i=this.m_proxies[e];t.DestroyProxy(i.proxy),i.proxy=null}this.m_proxyCount=0},t.prototype.Synchronize=function(e,i,s){if(0!=this.m_proxyCount)for(var o=0;o<this.m_proxyCount;++o){var n=this.m_proxies[o],a=t.Synchronize_s_aabb1,_=t.Synchronize_s_aabb2;this.m_shape.ComputeAABB(a,i,o),this.m_shape.ComputeAABB(_,s,o),n.aabb.Combine2(a,_);var m=r.b2SubVV(s.p,i.p,t.Synchronize_s_displacement);e.MoveProxy(n.proxy,n.aabb,m)}},t.Synchronize_s_aabb1=new o.b2AABB,t.Synchronize_s_aabb2=new o.b2AABB,t.Synchronize_s_displacement=new r.b2Vec2,t}();e.b2Fixture=h},function(t,e,i){"use strict";var s=i(3),o=i(4),n=i(18),r=i(14),a=i(2),_=i(11),m=i(20),h=i(22),l=i(23),c=i(24),u=i(19),p=i(37),b=i(38),y=i(12),d=i(41),f=i(40);!function(t){t[t.e_none=0]="e_none",t[t.e_newFixture=1]="e_newFixture",t[t.e_locked=2]="e_locked",t[t.e_clearForces=4]="e_clearForces"}(e.b2WorldFlag||(e.b2WorldFlag={}));var A=e.b2WorldFlag,v=function(){function t(t){this.m_flags=A.e_clearForces,this.m_contactManager=new d.b2ContactManager,this.m_bodyList=null,this.m_jointList=null,this.m_bodyCount=0,this.m_jointCount=0,this.m_gravity=new o.b2Vec2,this.m_allowSleep=!0,this.m_destructionListener=null,this.m_debugDraw=null,this.m_inv_dt0=0,this.m_warmStarting=!0,this.m_continuousPhysics=!0,this.m_subStepping=!1,this.m_stepComplete=!0,this.m_profile=new b.b2Profile,this.m_island=new p.b2Island,this.s_stack=new Array,this.m_gravity=t.Clone()}return t.prototype.SetDestructionListener=function(t){this.m_destructionListener=t},t.prototype.SetContactFilter=function(t){this.m_contactManager.m_contactFilter=t},t.prototype.SetContactListener=function(t){this.m_contactManager.m_contactListener=t},t.prototype.SetDebugDraw=function(t){this.m_debugDraw=t},t.prototype.CreateBody=function(t){if(s.ENABLE_ASSERTS&&s.b2Assert(0==this.IsLocked()),this.IsLocked())return null;var e=new u.b2Body(t,this);return e.m_prev=null,e.m_next=this.m_bodyList,this.m_bodyList&&(this.m_bodyList.m_prev=e),this.m_bodyList=e,++this.m_bodyCount,e},t.prototype.DestroyBody=function(t){if(s.ENABLE_ASSERTS&&s.b2Assert(this.m_bodyCount>0),s.ENABLE_ASSERTS&&s.b2Assert(0==this.IsLocked()),!this.IsLocked()){for(var e=t.m_jointList;e;){var i=e;e=e.next,this.m_destructionListener&&this.m_destructionListener.SayGoodbyeJoint(i.joint),this.DestroyJoint(i.joint),t.m_jointList=e}t.m_jointList=null;for(var o=t.m_contactList;o;){var n=o;o=o.next,this.m_contactManager.Destroy(n.contact)}t.m_contactList=null;for(var r=t.m_fixtureList;r;){var a=r;r=r.m_next,this.m_destructionListener&&this.m_destructionListener.SayGoodbyeFixture(a),a.DestroyProxies(this.m_contactManager.m_broadPhase),a.Destroy(),t.m_fixtureList=r,t.m_fixtureCount-=1}t.m_fixtureList=null,t.m_fixtureCount=0,t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t==this.m_bodyList&&(this.m_bodyList=t.m_next),--this.m_bodyCount}},t.prototype.CreateJoint=function(t){if(s.ENABLE_ASSERTS&&s.b2Assert(0==this.IsLocked()),this.IsLocked())return null;var e=c.b2JointFactory.Create(t,null);e.m_prev=null,e.m_next=this.m_jointList,this.m_jointList&&(this.m_jointList.m_prev=e),this.m_jointList=e,++this.m_jointCount,e.m_edgeA.joint=e,e.m_edgeA.other=e.m_bodyB,e.m_edgeA.prev=null,e.m_edgeA.next=e.m_bodyA.m_jointList,e.m_bodyA.m_jointList&&(e.m_bodyA.m_jointList.prev=e.m_edgeA),e.m_bodyA.m_jointList=e.m_edgeA,e.m_edgeB.joint=e,e.m_edgeB.other=e.m_bodyA,e.m_edgeB.prev=null,e.m_edgeB.next=e.m_bodyB.m_jointList,e.m_bodyB.m_jointList&&(e.m_bodyB.m_jointList.prev=e.m_edgeB),e.m_bodyB.m_jointList=e.m_edgeB;var i=t.bodyA,o=t.bodyB;if(0==t.collideConnected)for(var n=o.GetContactList();n;)n.other==i&&n.contact.FlagForFiltering(),n=n.next;return e},t.prototype.DestroyJoint=function(t){if(s.ENABLE_ASSERTS&&s.b2Assert(0==this.IsLocked()),!this.IsLocked()){var e=t.m_collideConnected;t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t==this.m_jointList&&(this.m_jointList=t.m_next);var i=t.m_bodyA,o=t.m_bodyB;if(i.SetAwake(!0),o.SetAwake(!0),t.m_edgeA.prev&&(t.m_edgeA.prev.next=t.m_edgeA.next),t.m_edgeA.next&&(t.m_edgeA.next.prev=t.m_edgeA.prev),t.m_edgeA==i.m_jointList&&(i.m_jointList=t.m_edgeA.next),t.m_edgeA.prev=null,t.m_edgeA.next=null,t.m_edgeB.prev&&(t.m_edgeB.prev.next=t.m_edgeB.next),t.m_edgeB.next&&(t.m_edgeB.next.prev=t.m_edgeB.prev),t.m_edgeB==o.m_jointList&&(o.m_jointList=t.m_edgeB.next),t.m_edgeB.prev=null,t.m_edgeB.next=null,c.b2JointFactory.Destroy(t,null),s.ENABLE_ASSERTS&&s.b2Assert(this.m_jointCount>0),--this.m_jointCount,0==e)for(var n=o.GetContactList();n;)n.other==i&&n.contact.FlagForFiltering(),n=n.next}},t.prototype.Step=function(e,i,s){var o=new y.b2Timer;this.m_flags&A.e_newFixture&&(this.m_contactManager.FindNewContacts(),this.m_flags&=~A.e_newFixture),this.m_flags|=A.e_locked;var n=t.Step_s_step;n.dt=e,n.velocityIterations=i,n.positionIterations=s,e>0?n.inv_dt=1/e:n.inv_dt=0,n.dtRatio=this.m_inv_dt0*e,n.warmStarting=this.m_warmStarting;var r=new y.b2Timer;if(this.m_contactManager.Collide(),this.m_profile.collide=r.GetMilliseconds(),this.m_stepComplete&&n.dt>0){var r=new y.b2Timer;this.Solve(n),this.m_profile.solve=r.GetMilliseconds()}if(this.m_continuousPhysics&&n.dt>0){var r=new y.b2Timer;this.SolveTOI(n),this.m_profile.solveTOI=r.GetMilliseconds()}n.dt>0&&(this.m_inv_dt0=n.inv_dt),this.m_flags&A.e_clearForces&&this.ClearForces(),this.m_flags&=~A.e_locked,this.m_profile.step=o.GetMilliseconds()},t.prototype.ClearForces=function(){for(var t=this.m_bodyList;t;t=t.m_next)t.m_force.SetZero(),t.m_torque=0},t.prototype.DrawDebugData=function(){if(null!=this.m_debugDraw){var e=this.m_debugDraw.GetFlags(),i=t.DrawDebugData_s_color.SetRGB(0,0,0);if(e&n.b2DrawFlags.e_shapeBit)for(var s=this.m_bodyList;s;s=s.m_next){var o=s.m_xf;this.m_debugDraw.PushTransform(o);for(var r=s.GetFixtureList();r;r=r.m_next)0==s.IsActive()?(i.SetRGB(.5,.5,.3),this.DrawShape(r,i)):s.GetType()==u.b2BodyType.b2_staticBody?(i.SetRGB(.5,.9,.5),this.DrawShape(r,i)):s.GetType()==u.b2BodyType.b2_kinematicBody?(i.SetRGB(.5,.5,.9),this.DrawShape(r,i)):0==s.IsAwake()?(i.SetRGB(.6,.6,.6),this.DrawShape(r,i)):(i.SetRGB(.9,.7,.7),this.DrawShape(r,i));this.m_debugDraw.PopTransform(o)}if(e&n.b2DrawFlags.e_jointBit)for(var a=this.m_jointList;a;a=a.m_next)this.DrawJoint(a);if(e&n.b2DrawFlags.e_aabbBit){i.SetRGB(.9,.3,.9);for(var _=this.m_contactManager.m_broadPhase,m=t.DrawDebugData_s_vs,s=this.m_bodyList;s;s=s.m_next)if(0!=s.IsActive())for(var r=s.GetFixtureList();r;r=r.m_next)for(var h=0;h<r.m_proxyCount;++h){var l=r.m_proxies[h],c=_.GetFatAABB(l.proxy);m[0].SetXY(c.lowerBound.x,c.lowerBound.y),m[1].SetXY(c.upperBound.x,c.lowerBound.y),m[2].SetXY(c.upperBound.x,c.upperBound.y),m[3].SetXY(c.lowerBound.x,c.upperBound.y),this.m_debugDraw.DrawPolygon(m,4,i)}}if(e&n.b2DrawFlags.e_centerOfMassBit)for(var s=this.m_bodyList;s;s=s.m_next){var o=t.DrawDebugData_s_xf;o.q.Copy(s.m_xf.q),o.p.Copy(s.GetWorldCenter()),this.m_debugDraw.DrawTransform(o)}}},t.prototype.QueryAABB=function(t,e){var i=this.m_contactManager.m_broadPhase,o=function(e){var o=i.GetUserData(e);s.ENABLE_ASSERTS&&s.b2Assert(o instanceof m.b2FixtureProxy);var n=o.fixture;o.childIndex;return t instanceof f.b2QueryCallback?t.ReportFixture(n):t(n)};i.Query(o,e)},t.prototype.QueryShape=function(e,i,o){var n=this.m_contactManager.m_broadPhase,r=function(t){var r=n.GetUserData(t);s.ENABLE_ASSERTS&&s.b2Assert(r instanceof m.b2FixtureProxy);var _=r.fixture;r.childIndex;return!a.b2TestOverlapShape(i,0,_.GetShape(),0,o,_.GetBody().GetTransform())||(e instanceof f.b2QueryCallback?e.ReportFixture(_):e(_))},_=t.QueryShape_s_aabb;i.ComputeAABB(_,o,0),n.Query(r,_)},t.prototype.QueryPoint=function(e,i){var o=this.m_contactManager.m_broadPhase,n=function(t){var n=o.GetUserData(t);s.ENABLE_ASSERTS&&s.b2Assert(n instanceof m.b2FixtureProxy);var r=n.fixture;n.childIndex;return!r.TestPoint(i)||(e instanceof f.b2QueryCallback?e.ReportFixture(r):e(r))},r=t.QueryPoint_s_aabb;r.lowerBound.SetXY(i.x-s.b2_linearSlop,i.y-s.b2_linearSlop),r.upperBound.SetXY(i.x+s.b2_linearSlop,i.y+s.b2_linearSlop),o.Query(n,r)},t.prototype.RayCast=function(e,i,o){var n=this.m_contactManager.m_broadPhase,r=function(r,a){var _=n.GetUserData(a);s.ENABLE_ASSERTS&&s.b2Assert(_ instanceof m.b2FixtureProxy);var h=_.fixture,l=_.childIndex,c=t.RayCast_s_output,u=h.RayCast(c,r,l);if(u){var p=c.fraction,b=t.RayCast_s_point;return b.SetXY((1-p)*i.x+p*o.x,(1-p)*i.y+p*o.y),e instanceof f.b2RayCastCallback?e.ReportFixture(h,b,c.normal,p):e(h,b,c.normal,p)}return r.maxFraction},a=t.RayCast_s_input;a.maxFraction=1,a.p1.Copy(i),a.p2.Copy(o),n.RayCast(r,a)},t.prototype.RayCastOne=function(t,e){function i(t,e,i,n){return n<o&&(o=n,s=t),o}var s=null,o=1;return this.RayCast(i,t,e),s},t.prototype.RayCastAll=function(t,e,i){function s(t,e,s,o){return i.push(t),1}return i.length=0,this.RayCast(s,t,e),i},t.prototype.GetBodyList=function(){return this.m_bodyList},t.prototype.GetJointList=function(){return this.m_jointList},t.prototype.GetContactList=function(){return this.m_contactManager.m_contactList},t.prototype.SetAllowSleeping=function(t){if(t!=this.m_allowSleep&&(this.m_allowSleep=t,0==this.m_allowSleep))for(var e=this.m_bodyList;e;e=e.m_next)e.SetAwake(!0)},t.prototype.GetAllowSleeping=function(){return this.m_allowSleep},t.prototype.SetWarmStarting=function(t){this.m_warmStarting=t},t.prototype.GetWarmStarting=function(){return this.m_warmStarting},t.prototype.SetContinuousPhysics=function(t){this.m_continuousPhysics=t},t.prototype.GetContinuousPhysics=function(){return this.m_continuousPhysics},t.prototype.SetSubStepping=function(t){this.m_subStepping=t},t.prototype.GetSubStepping=function(){return this.m_subStepping},t.prototype.GetProxyCount=function(){return this.m_contactManager.m_broadPhase.GetProxyCount()},t.prototype.GetBodyCount=function(){return this.m_bodyCount},t.prototype.GetJointCount=function(){return this.m_jointCount},t.prototype.GetContactCount=function(){return this.m_contactManager.m_contactCount},t.prototype.GetTreeHeight=function(){return this.m_contactManager.m_broadPhase.GetTreeHeight()},t.prototype.GetTreeBalance=function(){return this.m_contactManager.m_broadPhase.GetTreeBalance()},t.prototype.GetTreeQuality=function(){return this.m_contactManager.m_broadPhase.GetTreeQuality()},t.prototype.SetGravity=function(t,e){if(void 0===e&&(e=!0),(this.m_gravity.x!==t.x||this.m_gravity.y!==t.y)&&(this.m_gravity.Copy(t),e))for(var i=this.m_bodyList;i;i=i.m_next)i.SetAwake(!0)},t.prototype.GetGravity=function(){return this.m_gravity},t.prototype.IsLocked=function(){return(this.m_flags&A.e_locked)>0},t.prototype.SetAutoClearForces=function(t){t?this.m_flags|=A.e_clearForces:this.m_flags&=~A.e_clearForces},t.prototype.GetAutoClearForces=function(){return(this.m_flags&A.e_clearForces)==A.e_clearForces},t.prototype.ShiftOrigin=function(t){if(s.ENABLE_ASSERTS&&s.b2Assert(0==this.IsLocked()),!this.IsLocked()){for(var e=this.m_bodyList;e;e=e.m_next)e.m_xf.p.SelfSub(t),e.m_sweep.c0.SelfSub(t),e.m_sweep.c.SelfSub(t);for(var i=this.m_jointList;i;i=i.m_next)i.ShiftOrigin(t);this.m_contactManager.m_broadPhase.ShiftOrigin(t)}},t.prototype.GetContactManager=function(){return this.m_contactManager},t.prototype.GetProfile=function(){return this.m_profile},t.prototype.Dump=function(){if(s.DEBUG){if((this.m_flags&A.e_locked)==A.e_locked)return;s.b2Log("var g: b2Vec2 = new b2Vec2(%.15f, %.15f);\n",this.m_gravity.x,this.m_gravity.y),s.b2Log("this.m_world.SetGravity(g);\n"),s.b2Log("var bodies: b2Body[] = new Array(%d);\n",this.m_bodyCount),s.b2Log("var joints: b2Joint[] = new Array(%d);\n",this.m_jointCount);for(var t=0,e=this.m_bodyList;e;e=e.m_next)e.m_islandIndex=t,e.Dump(),++t;t=0;for(var i=this.m_jointList;i;i=i.m_next)i.m_index=t,++t;for(var i=this.m_jointList;i;i=i.m_next)i.m_type!=l.b2JointType.e_gearJoint&&(s.b2Log("{\n"),i.Dump(),s.b2Log("}\n"));for(var i=this.m_jointList;i;i=i.m_next)i.m_type==l.b2JointType.e_gearJoint&&(s.b2Log("{\n"),i.Dump(),s.b2Log("}\n"))}},t.prototype.DrawJoint=function(e){var i=e.GetBodyA(),s=e.GetBodyB(),o=i.m_xf,n=s.m_xf,r=o.p,a=n.p,_=e.GetAnchorA(t.DrawJoint_s_p1),m=e.GetAnchorB(t.DrawJoint_s_p2),h=t.DrawJoint_s_color.SetRGB(.5,.8,.8);switch(e.m_type){case l.b2JointType.e_distanceJoint:this.m_debugDraw.DrawSegment(_,m,h);break;case l.b2JointType.e_pulleyJoint:var c=e,u=c.GetGroundAnchorA(),p=c.GetGroundAnchorB();this.m_debugDraw.DrawSegment(u,_,h),this.m_debugDraw.DrawSegment(p,m,h),this.m_debugDraw.DrawSegment(u,p,h);break;case l.b2JointType.e_mouseJoint:this.m_debugDraw.DrawSegment(_,m,h);break;default:this.m_debugDraw.DrawSegment(r,_,h),this.m_debugDraw.DrawSegment(_,m,h),this.m_debugDraw.DrawSegment(a,m,h)}},t.prototype.DrawShape=function(t,e){var i=t.GetShape();switch(i.m_type){case r.b2ShapeType.e_circleShape:var s=i,n=s.m_p,a=s.m_radius,_=o.b2Vec2.UNITX;this.m_debugDraw.DrawSolidCircle(n,a,_,e);break;case r.b2ShapeType.e_edgeShape:var m=i,h=m.m_vertex1,l=m.m_vertex2;this.m_debugDraw.DrawSegment(h,l,e);break;case r.b2ShapeType.e_chainShape:var c=i,u=c.m_count,p=c.m_vertices,h=p[0];this.m_debugDraw.DrawCircle(h,.05,e);for(var b=1;b<u;++b){var l=p[b];this.m_debugDraw.DrawSegment(h,l,e),this.m_debugDraw.DrawCircle(l,.05,e),h=l}break;case r.b2ShapeType.e_polygonShape:var y=i,d=y.m_count,p=y.m_vertices;this.m_debugDraw.DrawSolidPolygon(p,d,e)}},t.prototype.Solve=function(t){this.m_profile.solveInit=0,this.m_profile.solveVelocity=0,this.m_profile.solvePosition=0;var e=this.m_island;e.Initialize(this.m_bodyCount,this.m_contactManager.m_contactCount,this.m_jointCount,null,this.m_contactManager.m_contactListener);for(var i=this.m_bodyList;i;i=i.m_next)i.m_flags&=~u.b2BodyFlag.e_islandFlag;for(var o=this.m_contactManager.m_contactList;o;o=o.m_next)o.m_flags&=~h.b2ContactFlag.e_islandFlag;for(var n=this.m_jointList;n;n=n.m_next)n.m_islandFlag=!1;for(var r=this.m_bodyCount,a=this.s_stack,_=this.m_bodyList;_;_=_.m_next)if(!(_.m_flags&u.b2BodyFlag.e_islandFlag)&&0!=_.IsAwake()&&0!=_.IsActive()&&_.GetType()!=u.b2BodyType.b2_staticBody){e.Clear();var m=0;for(a[m++]=_,_.m_flags|=u.b2BodyFlag.e_islandFlag;m>0;){var i=a[--m];if(s.ENABLE_ASSERTS&&s.b2Assert(1==i.IsActive()),e.AddBody(i),i.SetAwake(!0),i.GetType()!=u.b2BodyType.b2_staticBody){for(var l=i.m_contactList;l;l=l.next){var c=l.contact;if(!(c.m_flags&h.b2ContactFlag.e_islandFlag)&&0!=c.IsEnabled()&&0!=c.IsTouching()){var p=c.m_fixtureA.m_isSensor,d=c.m_fixtureB.m_isSensor;if(!p&&!d){e.AddContact(c),c.m_flags|=h.b2ContactFlag.e_islandFlag;var f=l.other;f.m_flags&u.b2BodyFlag.e_islandFlag||(s.ENABLE_ASSERTS&&s.b2Assert(m<r),a[m++]=f,f.m_flags|=u.b2BodyFlag.e_islandFlag)}}}for(var A=i.m_jointList;A;A=A.next)if(1!=A.joint.m_islandFlag){var f=A.other;0!=f.IsActive()&&(e.AddJoint(A.joint),A.joint.m_islandFlag=!0,f.m_flags&u.b2BodyFlag.e_islandFlag||(s.ENABLE_ASSERTS&&s.b2Assert(m<r),a[m++]=f,f.m_flags|=u.b2BodyFlag.e_islandFlag))}}}var v=new b.b2Profile;e.Solve(v,t,this.m_gravity,this.m_allowSleep),this.m_profile.solveInit+=v.solveInit,this.m_profile.solveVelocity+=v.solveVelocity,this.m_profile.solvePosition+=v.solvePosition;for(var S=0;S<e.m_bodyCount;++S){var i=e.m_bodies[S];i.GetType()==u.b2BodyType.b2_staticBody&&(i.m_flags&=~u.b2BodyFlag.e_islandFlag)}}for(var S=0;S<a.length&&a[S];++S)a[S]=null;for(var V=new y.b2Timer,i=this.m_bodyList;i;i=i.m_next)0!=(i.m_flags&u.b2BodyFlag.e_islandFlag)&&i.GetType()!=u.b2BodyType.b2_staticBody&&i.SynchronizeFixtures();this.m_contactManager.FindNewContacts(),this.m_profile.broadphase=V.GetMilliseconds()},t.prototype.SolveTOI=function(e){var i=this.m_island;if(i.Initialize(2*s.b2_maxTOIContacts,s.b2_maxTOIContacts,0,null,this.m_contactManager.m_contactListener),this.m_stepComplete){for(var n=this.m_bodyList;n;n=n.m_next)n.m_flags&=~u.b2BodyFlag.e_islandFlag,n.m_sweep.alpha0=0;for(var r=this.m_contactManager.m_contactList;r;r=r.m_next)r.m_flags&=~(h.b2ContactFlag.e_toiFlag|h.b2ContactFlag.e_islandFlag),r.m_toiCount=0,r.m_toi=1}for(;;){for(var a=null,m=1,r=this.m_contactManager.m_contactList;r;r=r.m_next)if(0!=r.IsEnabled()&&!(r.m_toiCount>s.b2_maxSubSteps)){var l=1;if(r.m_flags&h.b2ContactFlag.e_toiFlag)l=r.m_toi;else{var c=r.GetFixtureA(),p=r.GetFixtureB();if(c.IsSensor()||p.IsSensor())continue;var b=c.GetBody(),y=p.GetBody(),d=b.m_type,f=y.m_type;s.ENABLE_ASSERTS&&s.b2Assert(d==u.b2BodyType.b2_dynamicBody||f==u.b2BodyType.b2_dynamicBody);var A=b.IsAwake()&&d!=u.b2BodyType.b2_staticBody,v=y.IsAwake()&&f!=u.b2BodyType.b2_staticBody;if(0==A&&0==v)continue;var S=b.IsBullet()||d!=u.b2BodyType.b2_dynamicBody,V=y.IsBullet()||f!=u.b2BodyType.b2_dynamicBody;if(0==S&&0==V)continue;var x=b.m_sweep.alpha0;b.m_sweep.alpha0<y.m_sweep.alpha0?(x=y.m_sweep.alpha0,b.m_sweep.Advance(x)):y.m_sweep.alpha0<b.m_sweep.alpha0&&(x=b.m_sweep.alpha0,y.m_sweep.Advance(x)),s.ENABLE_ASSERTS&&s.b2Assert(x<1);var C=r.GetChildIndexA(),B=r.GetChildIndexB(),g=t.SolveTOI_s_toi_input;g.proxyA.SetShape(c.GetShape(),C),g.proxyB.SetShape(p.GetShape(),B),g.sweepA.Copy(b.m_sweep),g.sweepB.Copy(y.m_sweep),g.tMax=1;var w=t.SolveTOI_s_toi_output;_.b2TimeOfImpact(w,g);var M=w.t;l=w.state==_.b2TOIOutputState.e_touching?o.b2Min(x+(1-x)*M,1):1,
r.m_toi=l,r.m_flags|=h.b2ContactFlag.e_toiFlag}l<m&&(a=r,m=l)}if(null==a||1-10*s.b2_epsilon<m){this.m_stepComplete=!0;break}var c=a.GetFixtureA(),p=a.GetFixtureB(),b=c.GetBody(),y=p.GetBody(),L=t.SolveTOI_s_backup1.Copy(b.m_sweep),I=t.SolveTOI_s_backup2.Copy(y.m_sweep);if(b.Advance(m),y.Advance(m),a.Update(this.m_contactManager.m_contactListener),a.m_flags&=~h.b2ContactFlag.e_toiFlag,++a.m_toiCount,0!=a.IsEnabled()&&0!=a.IsTouching()){b.SetAwake(!0),y.SetAwake(!0),i.Clear(),i.AddBody(b),i.AddBody(y),i.AddContact(a),b.m_flags|=u.b2BodyFlag.e_islandFlag,y.m_flags|=u.b2BodyFlag.e_islandFlag,a.m_flags|=h.b2ContactFlag.e_islandFlag;for(var T=0;T<2;++T){var R=0==T?b:y;if(R.m_type==u.b2BodyType.b2_dynamicBody)for(var E=R.m_contactList;E&&i.m_bodyCount!=i.m_bodyCapacity&&i.m_contactCount!=i.m_contactCapacity;E=E.next){var G=E.contact;if(!(G.m_flags&h.b2ContactFlag.e_islandFlag)){var D=E.other;if(D.m_type!=u.b2BodyType.b2_dynamicBody||0!=R.IsBullet()||0!=D.IsBullet()){var P=G.m_fixtureA.m_isSensor,F=G.m_fixtureB.m_isSensor;if(!P&&!F){var k=t.SolveTOI_s_backup.Copy(D.m_sweep);0==(D.m_flags&u.b2BodyFlag.e_islandFlag)&&D.Advance(m),G.Update(this.m_contactManager.m_contactListener),0!=G.IsEnabled()&&0!=G.IsTouching()?(G.m_flags|=h.b2ContactFlag.e_islandFlag,i.AddContact(G),D.m_flags&u.b2BodyFlag.e_islandFlag||(D.m_flags|=u.b2BodyFlag.e_islandFlag,D.m_type!=u.b2BodyType.b2_staticBody&&D.SetAwake(!0),i.AddBody(D))):(D.m_sweep.Copy(k),D.SynchronizeTransform())}}}}}var N=t.SolveTOI_s_subStep;N.dt=(1-m)*e.dt,N.inv_dt=1/N.dt,N.dtRatio=1,N.positionIterations=20,N.velocityIterations=e.velocityIterations,N.warmStarting=!1,i.SolveTOI(N,b.m_islandIndex,y.m_islandIndex);for(var T=0;T<i.m_bodyCount;++T){var R=i.m_bodies[T];if(R.m_flags&=~u.b2BodyFlag.e_islandFlag,R.m_type==u.b2BodyType.b2_dynamicBody){R.SynchronizeFixtures();for(var E=R.m_contactList;E;E=E.next)E.contact.m_flags&=~(h.b2ContactFlag.e_toiFlag|h.b2ContactFlag.e_islandFlag)}}if(this.m_contactManager.FindNewContacts(),this.m_subStepping){this.m_stepComplete=!1;break}}else a.SetEnabled(!1),b.m_sweep.Copy(L),y.m_sweep.Copy(I),b.SynchronizeTransform(),y.SynchronizeTransform()}},t.Step_s_step=new b.b2TimeStep,t.DrawDebugData_s_color=new n.b2Color(0,0,0),t.DrawDebugData_s_vs=o.b2Vec2.MakeArray(4),t.DrawDebugData_s_xf=new o.b2Transform,t.QueryShape_s_aabb=new a.b2AABB,t.QueryPoint_s_aabb=new a.b2AABB,t.RayCast_s_input=new a.b2RayCastInput,t.RayCast_s_output=new a.b2RayCastOutput,t.RayCast_s_point=new o.b2Vec2,t.DrawJoint_s_p1=new o.b2Vec2,t.DrawJoint_s_p2=new o.b2Vec2,t.DrawJoint_s_color=new n.b2Color(.5,.8,.8),t.SolveTOI_s_subStep=new b.b2TimeStep,t.SolveTOI_s_backup=new o.b2Sweep,t.SolveTOI_s_backup1=new o.b2Sweep,t.SolveTOI_s_backup2=new o.b2Sweep,t.SolveTOI_s_toi_input=new _.b2TOIInput,t.SolveTOI_s_toi_output=new _.b2TOIOutput,t}();e.b2World=v},function(t,e,i){"use strict";function s(t,e){return n.b2Sqrt(t*e)}function o(t,e){return t>e?t:e}var n=i(4),r=i(3),a=i(2),_=i(11);e.b2MixFriction=s,e.b2MixRestitution=o;var m=function(){function t(){this.other=null,this.contact=null,this.prev=null,this.next=null}return t}();e.b2ContactEdge=m,function(t){t[t.e_none=0]="e_none",t[t.e_islandFlag=1]="e_islandFlag",t[t.e_touchingFlag=2]="e_touchingFlag",t[t.e_enabledFlag=4]="e_enabledFlag",t[t.e_filterFlag=8]="e_filterFlag",t[t.e_bulletHitFlag=16]="e_bulletHitFlag",t[t.e_toiFlag=32]="e_toiFlag"}(e.b2ContactFlag||(e.b2ContactFlag={}));var h=e.b2ContactFlag,l=function(){function t(){this.m_flags=h.e_none,this.m_prev=null,this.m_next=null,this.m_nodeA=new m,this.m_nodeB=new m,this.m_fixtureA=null,this.m_fixtureB=null,this.m_indexA=0,this.m_indexB=0,this.m_manifold=new a.b2Manifold,this.m_toiCount=0,this.m_toi=0,this.m_friction=0,this.m_restitution=0,this.m_tangentSpeed=0,this.m_oldManifold=new a.b2Manifold}return t.prototype.GetManifold=function(){return this.m_manifold},t.prototype.GetWorldManifold=function(t){var e=this.m_fixtureA.GetBody(),i=this.m_fixtureB.GetBody(),s=this.m_fixtureA.GetShape(),o=this.m_fixtureB.GetShape();t.Initialize(this.m_manifold,e.GetTransform(),s.m_radius,i.GetTransform(),o.m_radius)},t.prototype.IsTouching=function(){return(this.m_flags&h.e_touchingFlag)==h.e_touchingFlag},t.prototype.SetEnabled=function(t){t?this.m_flags|=h.e_enabledFlag:this.m_flags&=~h.e_enabledFlag},t.prototype.IsEnabled=function(){return(this.m_flags&h.e_enabledFlag)==h.e_enabledFlag},t.prototype.GetNext=function(){return this.m_next},t.prototype.GetFixtureA=function(){return this.m_fixtureA},t.prototype.GetChildIndexA=function(){return this.m_indexA},t.prototype.GetFixtureB=function(){return this.m_fixtureB},t.prototype.GetChildIndexB=function(){return this.m_indexB},t.prototype.Evaluate=function(t,e,i){},t.prototype.FlagForFiltering=function(){this.m_flags|=h.e_filterFlag},t.prototype.SetFriction=function(t){this.m_friction=t},t.prototype.GetFriction=function(){return this.m_friction},t.prototype.ResetFriction=function(){this.m_friction=s(this.m_fixtureA.m_friction,this.m_fixtureB.m_friction)},t.prototype.SetRestitution=function(t){this.m_restitution=t},t.prototype.GetRestitution=function(){return this.m_restitution},t.prototype.ResetRestitution=function(){this.m_restitution=o(this.m_fixtureA.m_restitution,this.m_fixtureB.m_restitution)},t.prototype.SetTangentSpeed=function(t){this.m_tangentSpeed=t},t.prototype.GetTangentSpeed=function(){return this.m_tangentSpeed},t.prototype.Reset=function(t,e,i,n){this.m_flags=h.e_enabledFlag,this.m_fixtureA=t,this.m_fixtureB=i,this.m_indexA=e,this.m_indexB=n,this.m_manifold.pointCount=0,this.m_prev=null,this.m_next=null,this.m_nodeA.contact=null,this.m_nodeA.prev=null,this.m_nodeA.next=null,this.m_nodeA.other=null,this.m_nodeB.contact=null,this.m_nodeB.prev=null,this.m_nodeB.next=null,this.m_nodeB.other=null,this.m_toiCount=0,this.m_friction=s(this.m_fixtureA.m_friction,this.m_fixtureB.m_friction),this.m_restitution=o(this.m_fixtureA.m_restitution,this.m_fixtureB.m_restitution)},t.prototype.Update=function(t){var e=this.m_oldManifold;this.m_oldManifold=this.m_manifold,this.m_manifold=e,this.m_flags|=h.e_enabledFlag;var i=!1,s=(this.m_flags&h.e_touchingFlag)==h.e_touchingFlag,o=this.m_fixtureA.IsSensor(),n=this.m_fixtureB.IsSensor(),r=o||n,_=this.m_fixtureA.GetBody(),m=this.m_fixtureB.GetBody(),l=_.GetTransform(),c=m.GetTransform();if(r){var u=this.m_fixtureA.GetShape(),p=this.m_fixtureB.GetShape();i=a.b2TestOverlapShape(u,this.m_indexA,p,this.m_indexB,l,c),this.m_manifold.pointCount=0}else{this.Evaluate(this.m_manifold,l,c),i=this.m_manifold.pointCount>0;for(var b=0;b<this.m_manifold.pointCount;++b){var y=this.m_manifold.points[b];y.normalImpulse=0,y.tangentImpulse=0;for(var d=y.id,f=0;f<this.m_oldManifold.pointCount;++f){var A=this.m_oldManifold.points[f];if(A.id.key==d.key){y.normalImpulse=A.normalImpulse,y.tangentImpulse=A.tangentImpulse;break}}}i!=s&&(_.SetAwake(!0),m.SetAwake(!0))}i?this.m_flags|=h.e_touchingFlag:this.m_flags&=~h.e_touchingFlag,0==s&&1==i&&t&&t.BeginContact(this),1==s&&0==i&&t&&t.EndContact(this),0==r&&i&&t&&t.PreSolve(this,this.m_oldManifold)},t.prototype.ComputeTOI=function(e,i){var s=t.ComputeTOI_s_input;s.proxyA.SetShape(this.m_fixtureA.GetShape(),this.m_indexA),s.proxyB.SetShape(this.m_fixtureB.GetShape(),this.m_indexB),s.sweepA.Copy(e),s.sweepB.Copy(i),s.tMax=r.b2_linearSlop;var o=t.ComputeTOI_s_output;return _.b2TimeOfImpact(o,s),o.t},t.ComputeTOI_s_input=new _.b2TOIInput,t.ComputeTOI_s_output=new _.b2TOIOutput,t}();e.b2Contact=l},function(t,e,i){"use strict";var s=i(4),o=i(3);!function(t){t[t.e_unknownJoint=0]="e_unknownJoint",t[t.e_revoluteJoint=1]="e_revoluteJoint",t[t.e_prismaticJoint=2]="e_prismaticJoint",t[t.e_distanceJoint=3]="e_distanceJoint",t[t.e_pulleyJoint=4]="e_pulleyJoint",t[t.e_mouseJoint=5]="e_mouseJoint",t[t.e_gearJoint=6]="e_gearJoint",t[t.e_wheelJoint=7]="e_wheelJoint",t[t.e_weldJoint=8]="e_weldJoint",t[t.e_frictionJoint=9]="e_frictionJoint",t[t.e_ropeJoint=10]="e_ropeJoint",t[t.e_motorJoint=11]="e_motorJoint",t[t.e_areaJoint=12]="e_areaJoint"}(e.b2JointType||(e.b2JointType={}));var n=e.b2JointType;!function(t){t[t.e_inactiveLimit=0]="e_inactiveLimit",t[t.e_atLowerLimit=1]="e_atLowerLimit",t[t.e_atUpperLimit=2]="e_atUpperLimit",t[t.e_equalLimits=3]="e_equalLimits"}(e.b2LimitState||(e.b2LimitState={}));var r=(e.b2LimitState,function(){function t(){this.linear=new s.b2Vec2,this.angularA=0,this.angularB=0}return t.prototype.SetZero=function(){return this.linear.SetZero(),this.angularA=0,this.angularB=0,this},t.prototype.Set=function(t,e,i){return this.linear.Copy(t),this.angularA=e,this.angularB=i,this},t}());e.b2Jacobian=r;var a=function(){function t(){this.other=null,this.joint=null,this.prev=null,this.next=null}return t}();e.b2JointEdge=a;var _=function(){function t(t){this.type=n.e_unknownJoint,this.userData=null,this.bodyA=null,this.bodyB=null,this.collideConnected=!1,this.type=t}return t}();e.b2JointDef=_;var m=function(){function t(t){this.m_type=n.e_unknownJoint,this.m_prev=null,this.m_next=null,this.m_edgeA=new a,this.m_edgeB=new a,this.m_bodyA=null,this.m_bodyB=null,this.m_index=0,this.m_islandFlag=!1,this.m_collideConnected=!1,this.m_userData=null,o.ENABLE_ASSERTS&&o.b2Assert(t.bodyA!=t.bodyB),this.m_type=t.type,this.m_bodyA=t.bodyA,this.m_bodyB=t.bodyB,this.m_collideConnected=t.collideConnected,this.m_userData=t.userData}return t.prototype.GetType=function(){return this.m_type},t.prototype.GetBodyA=function(){return this.m_bodyA},t.prototype.GetBodyB=function(){return this.m_bodyB},t.prototype.GetAnchorA=function(t){return t.SetZero()},t.prototype.GetAnchorB=function(t){return t.SetZero()},t.prototype.GetReactionForce=function(t,e){return e.SetZero()},t.prototype.GetReactionTorque=function(t){return 0},t.prototype.GetNext=function(){return this.m_next},t.prototype.GetUserData=function(){return this.m_userData},t.prototype.SetUserData=function(t){this.m_userData=t},t.prototype.IsActive=function(){return this.m_bodyA.IsActive()&&this.m_bodyB.IsActive()},t.prototype.GetCollideConnected=function(){return this.m_collideConnected},t.prototype.Dump=function(){o.DEBUG&&o.b2Log("// Dump is not supported for this joint type.\n")},t.prototype.ShiftOrigin=function(t){},t.prototype.InitVelocityConstraints=function(t){},t.prototype.SolveVelocityConstraints=function(t){},t.prototype.SolvePositionConstraints=function(t){return!1},t}();e.b2Joint=m},function(t,e,i){"use strict";var s=i(3),o=i(23),n=i(25),r=i(26),a=i(27),_=i(28),m=i(29),h=i(30),l=i(31),c=i(32),u=i(33),p=i(34),b=i(35),y=i(36),d=function(){function t(){}return t.Create=function(t,e){var i=null;switch(t.type){case o.b2JointType.e_distanceJoint:i=new n.b2DistanceJoint(t);break;case o.b2JointType.e_mouseJoint:i=new r.b2MouseJoint(t);break;case o.b2JointType.e_prismaticJoint:i=new a.b2PrismaticJoint(t);break;case o.b2JointType.e_revoluteJoint:i=new _.b2RevoluteJoint(t);break;case o.b2JointType.e_pulleyJoint:i=new m.b2PulleyJoint(t);break;case o.b2JointType.e_gearJoint:i=new h.b2GearJoint(t);break;case o.b2JointType.e_wheelJoint:i=new l.b2WheelJoint(t);break;case o.b2JointType.e_weldJoint:i=new c.b2WeldJoint(t);break;case o.b2JointType.e_frictionJoint:i=new u.b2FrictionJoint(t);break;case o.b2JointType.e_ropeJoint:i=new p.b2RopeJoint(t);break;case o.b2JointType.e_motorJoint:i=new b.b2MotorJoint(t);break;case o.b2JointType.e_areaJoint:i=new y.b2AreaJoint(t);break;default:s.ENABLE_ASSERTS&&s.b2Assert(!1)}return i},t.Destroy=function(t,e){},t}();e.b2JointFactory=d},function(t,e,i){"use strict";var s=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},o=i(4),n=i(3),r=i(23),a=function(t){function e(){t.call(this,r.b2JointType.e_distanceJoint),this.localAnchorA=new o.b2Vec2,this.localAnchorB=new o.b2Vec2,this.length=1,this.frequencyHz=0,this.dampingRatio=0}return s(e,t),e.prototype.Initialize=function(t,e,i,s){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(i,this.localAnchorA),this.bodyB.GetLocalPoint(s,this.localAnchorB),this.length=o.b2DistanceVV(i,s),this.frequencyHz=0,this.dampingRatio=0},e}(r.b2JointDef);e.b2DistanceJointDef=a;var _=function(t){function e(e){t.call(this,e),this.m_frequencyHz=0,this.m_dampingRatio=0,this.m_bias=0,this.m_localAnchorA=null,this.m_localAnchorB=null,this.m_gamma=0,this.m_impulse=0,this.m_length=0,this.m_indexA=0,this.m_indexB=0,this.m_u=null,this.m_rA=null,this.m_rB=null,this.m_localCenterA=null,this.m_localCenterB=null,this.m_invMassA=0,this.m_invMassB=0,this.m_invIA=0,this.m_invIB=0,this.m_mass=0,this.m_qA=null,this.m_qB=null,this.m_lalcA=null,this.m_lalcB=null,this.m_u=new o.b2Vec2,this.m_rA=new o.b2Vec2,this.m_rB=new o.b2Vec2,this.m_localCenterA=new o.b2Vec2,this.m_localCenterB=new o.b2Vec2,this.m_qA=new o.b2Rot,this.m_qB=new o.b2Rot,this.m_lalcA=new o.b2Vec2,this.m_lalcB=new o.b2Vec2,this.m_frequencyHz=e.frequencyHz,this.m_dampingRatio=e.dampingRatio,this.m_localAnchorA=e.localAnchorA.Clone(),this.m_localAnchorB=e.localAnchorB.Clone(),this.m_length=e.length}return s(e,t),e.prototype.GetAnchorA=function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)},e.prototype.GetAnchorB=function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)},e.prototype.GetReactionForce=function(t,e){return e.SetXY(t*this.m_impulse*this.m_u.x,t*this.m_impulse*this.m_u.y)},e.prototype.GetReactionTorque=function(t){return 0},e.prototype.GetLocalAnchorA=function(){return this.m_localAnchorA},e.prototype.GetLocalAnchorB=function(){return this.m_localAnchorB},e.prototype.SetLength=function(t){this.m_length=t},e.prototype.GetLength=function(){return this.m_length},e.prototype.SetFrequency=function(t){this.m_frequencyHz=t},e.prototype.GetFrequency=function(){return this.m_frequencyHz},e.prototype.SetDampingRatio=function(t){this.m_dampingRatio=t},e.prototype.GetDampingRatio=function(){return this.m_dampingRatio},e.prototype.Dump=function(){if(n.DEBUG){var t=this.m_bodyA.m_islandIndex,e=this.m_bodyB.m_islandIndex;n.b2Log("  var jd: b2DistanceJointDef = new b2DistanceJointDef();\n"),n.b2Log("  jd.bodyA = bodies[%d];\n",t),n.b2Log("  jd.bodyB = bodies[%d];\n",e),n.b2Log("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),n.b2Log("  jd.localAnchorA.SetXY(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),n.b2Log("  jd.localAnchorB.SetXY(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),n.b2Log("  jd.length = %.15f;\n",this.m_length),n.b2Log("  jd.frequencyHz = %.15f;\n",this.m_frequencyHz),n.b2Log("  jd.dampingRatio = %.15f;\n",this.m_dampingRatio),n.b2Log("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}},e.prototype.InitVelocityConstraints=function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var i=t.positions[this.m_indexA].c,s=t.positions[this.m_indexA].a,r=t.velocities[this.m_indexA].v,a=t.velocities[this.m_indexA].w,_=t.positions[this.m_indexB].c,m=t.positions[this.m_indexB].a,h=t.velocities[this.m_indexB].v,l=t.velocities[this.m_indexB].w,c=this.m_qA.SetAngleRadians(s),u=this.m_qB.SetAngleRadians(m);o.b2SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),o.b2MulRV(c,this.m_lalcA,this.m_rA),o.b2SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),o.b2MulRV(u,this.m_lalcB,this.m_rB),this.m_u.x=_.x+this.m_rB.x-i.x-this.m_rA.x,this.m_u.y=_.y+this.m_rB.y-i.y-this.m_rA.y;var p=this.m_u.GetLength();p>n.b2_linearSlop?this.m_u.SelfMul(1/p):this.m_u.SetZero();var b=o.b2CrossVV(this.m_rA,this.m_u),y=o.b2CrossVV(this.m_rB,this.m_u),d=this.m_invMassA+this.m_invIA*b*b+this.m_invMassB+this.m_invIB*y*y;if(this.m_mass=0!=d?1/d:0,this.m_frequencyHz>0){var f=p-this.m_length,A=2*n.b2_pi*this.m_frequencyHz,v=2*this.m_mass*this.m_dampingRatio*A,S=this.m_mass*A*A,V=t.step.dt;this.m_gamma=V*(v+V*S),this.m_gamma=0!=this.m_gamma?1/this.m_gamma:0,this.m_bias=f*V*S*this.m_gamma,d+=this.m_gamma,this.m_mass=0!=d?1/d:0}else this.m_gamma=0,this.m_bias=0;if(t.step.warmStarting){this.m_impulse*=t.step.dtRatio;var x=o.b2MulSV(this.m_impulse,this.m_u,e.InitVelocityConstraints_s_P);r.SelfMulSub(this.m_invMassA,x),a-=this.m_invIA*o.b2CrossVV(this.m_rA,x),h.SelfMulAdd(this.m_invMassB,x),l+=this.m_invIB*o.b2CrossVV(this.m_rB,x)}else this.m_impulse=0;t.velocities[this.m_indexA].w=a,t.velocities[this.m_indexB].w=l},e.prototype.SolveVelocityConstraints=function(t){var i=t.velocities[this.m_indexA].v,s=t.velocities[this.m_indexA].w,n=t.velocities[this.m_indexB].v,r=t.velocities[this.m_indexB].w,a=o.b2AddVCrossSV(i,s,this.m_rA,e.SolveVelocityConstraints_s_vpA),_=o.b2AddVCrossSV(n,r,this.m_rB,e.SolveVelocityConstraints_s_vpB),m=o.b2DotVV(this.m_u,o.b2SubVV(_,a,o.b2Vec2.s_t0)),h=-this.m_mass*(m+this.m_bias+this.m_gamma*this.m_impulse);this.m_impulse+=h;var l=o.b2MulSV(h,this.m_u,e.SolveVelocityConstraints_s_P);i.SelfMulSub(this.m_invMassA,l),s-=this.m_invIA*o.b2CrossVV(this.m_rA,l),n.SelfMulAdd(this.m_invMassB,l),r+=this.m_invIB*o.b2CrossVV(this.m_rB,l),t.velocities[this.m_indexA].w=s,t.velocities[this.m_indexB].w=r},e.prototype.SolvePositionConstraints=function(t){if(this.m_frequencyHz>0)return!0;var i=t.positions[this.m_indexA].c,s=t.positions[this.m_indexA].a,r=t.positions[this.m_indexB].c,a=t.positions[this.m_indexB].a,_=(this.m_qA.SetAngleRadians(s),this.m_qB.SetAngleRadians(a),o.b2MulRV(this.m_qA,this.m_lalcA,this.m_rA)),m=o.b2MulRV(this.m_qB,this.m_lalcB,this.m_rB),h=this.m_u;h.x=r.x+m.x-i.x-_.x,h.y=r.y+m.y-i.y-_.y;var l=this.m_u.Normalize(),c=l-this.m_length;c=o.b2Clamp(c,-n.b2_maxLinearCorrection,n.b2_maxLinearCorrection);var u=-this.m_mass*c,p=o.b2MulSV(u,h,e.SolvePositionConstraints_s_P);return i.SelfMulSub(this.m_invMassA,p),s-=this.m_invIA*o.b2CrossVV(_,p),r.SelfMulAdd(this.m_invMassB,p),a+=this.m_invIB*o.b2CrossVV(m,p),t.positions[this.m_indexA].a=s,t.positions[this.m_indexB].a=a,o.b2Abs(c)<n.b2_linearSlop},e.InitVelocityConstraints_s_P=new o.b2Vec2,e.SolveVelocityConstraints_s_vpA=new o.b2Vec2,e.SolveVelocityConstraints_s_vpB=new o.b2Vec2,e.SolveVelocityConstraints_s_P=new o.b2Vec2,e.SolvePositionConstraints_s_P=new o.b2Vec2,e}(r.b2Joint);e.b2DistanceJoint=_},function(t,e,i){"use strict";var s=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},o=i(4),n=i(3),r=i(23),a=function(t){function e(){t.call(this,r.b2JointType.e_mouseJoint),this.target=new o.b2Vec2,this.maxForce=0,this.frequencyHz=5,this.dampingRatio=.7}return s(e,t),e}(r.b2JointDef);e.b2MouseJointDef=a;var _=function(t){function e(e){t.call(this,e),this.m_localAnchorB=null,this.m_targetA=null,this.m_frequencyHz=0,this.m_dampingRatio=0,this.m_beta=0,this.m_impulse=null,this.m_maxForce=0,this.m_gamma=0,this.m_indexA=0,this.m_indexB=0,this.m_rB=null,this.m_localCenterB=null,this.m_invMassB=0,this.m_invIB=0,this.m_mass=null,this.m_C=null,this.m_qB=null,this.m_lalcB=null,this.m_K=null,this.m_localAnchorB=new o.b2Vec2,this.m_targetA=new o.b2Vec2,this.m_impulse=new o.b2Vec2,this.m_rB=new o.b2Vec2,this.m_localCenterB=new o.b2Vec2,this.m_mass=new o.b2Mat22,this.m_C=new o.b2Vec2,this.m_qB=new o.b2Rot,this.m_lalcB=new o.b2Vec2,this.m_K=new o.b2Mat22,n.ENABLE_ASSERTS&&n.b2Assert(e.target.IsValid()),n.ENABLE_ASSERTS&&n.b2Assert(o.b2IsValid(e.maxForce)&&e.maxForce>=0),n.ENABLE_ASSERTS&&n.b2Assert(o.b2IsValid(e.frequencyHz)&&e.frequencyHz>=0),n.ENABLE_ASSERTS&&n.b2Assert(o.b2IsValid(e.dampingRatio)&&e.dampingRatio>=0),this.m_targetA.Copy(e.target),o.b2MulTXV(this.m_bodyB.GetTransform(),this.m_targetA,this.m_localAnchorB),this.m_maxForce=e.maxForce,this.m_impulse.SetZero(),this.m_frequencyHz=e.frequencyHz,this.m_dampingRatio=e.dampingRatio,this.m_beta=0,this.m_gamma=0}return s(e,t),e.prototype.SetTarget=function(t){0==this.m_bodyB.IsAwake()&&this.m_bodyB.SetAwake(!0),this.m_targetA.Copy(t)},e.prototype.GetTarget=function(){return this.m_targetA},e.prototype.SetMaxForce=function(t){this.m_maxForce=t},e.prototype.GetMaxForce=function(){return this.m_maxForce},e.prototype.SetFrequency=function(t){this.m_frequencyHz=t},e.prototype.GetFrequency=function(){return this.m_frequencyHz},e.prototype.SetDampingRatio=function(t){this.m_dampingRatio=t},e.prototype.GetDampingRatio=function(){return this.m_dampingRatio},e.prototype.InitVelocityConstraints=function(t){this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIB=this.m_bodyB.m_invI;var e=t.positions[this.m_indexB].c,i=t.positions[this.m_indexB].a,s=t.velocities[this.m_indexB].v,r=t.velocities[this.m_indexB].w,a=this.m_qB.SetAngleRadians(i),_=this.m_bodyB.GetMass(),m=2*n.b2_pi*this.m_frequencyHz,h=2*_*this.m_dampingRatio*m,l=_*(m*m),c=t.step.dt;n.ENABLE_ASSERTS&&n.b2Assert(h+c*l>n.b2_epsilon),this.m_gamma=c*(h+c*l),0!=this.m_gamma&&(this.m_gamma=1/this.m_gamma),this.m_beta=c*l*this.m_gamma,o.b2SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),o.b2MulRV(a,this.m_lalcB,this.m_rB);var u=this.m_K;u.ex.x=this.m_invMassB+this.m_invIB*this.m_rB.y*this.m_rB.y+this.m_gamma,u.ex.y=-this.m_invIB*this.m_rB.x*this.m_rB.y,u.ey.x=u.ex.y,u.ey.y=this.m_invMassB+this.m_invIB*this.m_rB.x*this.m_rB.x+this.m_gamma,u.GetInverse(this.m_mass),this.m_C.x=e.x+this.m_rB.x-this.m_targetA.x,this.m_C.y=e.y+this.m_rB.y-this.m_targetA.y,this.m_C.SelfMul(this.m_beta),r*=.98,t.step.warmStarting?(this.m_impulse.SelfMul(t.step.dtRatio),s.x+=this.m_invMassB*this.m_impulse.x,s.y+=this.m_invMassB*this.m_impulse.y,r+=this.m_invIB*o.b2CrossVV(this.m_rB,this.m_impulse)):this.m_impulse.SetZero(),t.velocities[this.m_indexB].w=r},e.prototype.SolveVelocityConstraints=function(t){var i=t.velocities[this.m_indexB].v,s=t.velocities[this.m_indexB].w,n=o.b2AddVCrossSV(i,s,this.m_rB,e.SolveVelocityConstraints_s_Cdot),r=o.b2MulMV(this.m_mass,o.b2AddVV(n,o.b2AddVV(this.m_C,o.b2MulSV(this.m_gamma,this.m_impulse,o.b2Vec2.s_t0),o.b2Vec2.s_t0),o.b2Vec2.s_t0).SelfNeg(),e.SolveVelocityConstraints_s_impulse),a=e.SolveVelocityConstraints_s_oldImpulse.Copy(this.m_impulse);this.m_impulse.SelfAdd(r);var _=t.step.dt*this.m_maxForce;this.m_impulse.GetLengthSquared()>_*_&&this.m_impulse.SelfMul(_/this.m_impulse.GetLength()),o.b2SubVV(this.m_impulse,a,r),i.SelfMulAdd(this.m_invMassB,r),s+=this.m_invIB*o.b2CrossVV(this.m_rB,r),t.velocities[this.m_indexB].w=s},e.prototype.SolvePositionConstraints=function(t){return!0},e.prototype.GetAnchorA=function(t){return t.Copy(this.m_targetA)},e.prototype.GetAnchorB=function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)},e.prototype.GetReactionForce=function(t,e){return o.b2MulSV(t,this.m_impulse,e)},e.prototype.GetReactionTorque=function(t){return 0},e.prototype.Dump=function(){n.DEBUG&&n.b2Log("Mouse joint dumping is not supported.\n")},e.prototype.ShiftOrigin=function(t){this.m_targetA.SelfSub(t)},e.SolveVelocityConstraints_s_Cdot=new o.b2Vec2,e.SolveVelocityConstraints_s_impulse=new o.b2Vec2,e.SolveVelocityConstraints_s_oldImpulse=new o.b2Vec2,e}(r.b2Joint);e.b2MouseJoint=_},function(t,e,i){"use strict";var s=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},o=i(4),n=i(3),r=i(23),a=function(t){function e(){t.call(this,r.b2JointType.e_prismaticJoint),this.localAnchorA=null,this.localAnchorB=null,this.localAxisA=null,this.referenceAngle=0,this.enableLimit=!1,this.lowerTranslation=0,this.upperTranslation=0,this.enableMotor=!1,this.maxMotorForce=0,this.motorSpeed=0,this.localAnchorA=new o.b2Vec2,this.localAnchorB=new o.b2Vec2,this.localAxisA=new o.b2Vec2(1,0)}return s(e,t),e.prototype.Initialize=function(t,e,i,s){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(i,this.localAnchorA),this.bodyB.GetLocalPoint(i,this.localAnchorB),this.bodyA.GetLocalVector(s,this.localAxisA),this.referenceAngle=this.bodyB.GetAngleRadians()-this.bodyA.GetAngleRadians()},e}(r.b2JointDef);e.b2PrismaticJointDef=a;var _=function(t){function e(e){t.call(this,e),this.m_localAnchorA=null,this.m_localAnchorB=null,this.m_localXAxisA=null,this.m_localYAxisA=null,this.m_referenceAngle=0,this.m_impulse=null,this.m_motorImpulse=0,this.m_lowerTranslation=0,this.m_upperTranslation=0,this.m_maxMotorForce=0,this.m_motorSpeed=0,this.m_enableLimit=!1,this.m_enableMotor=!1,this.m_limitState=r.b2LimitState.e_inactiveLimit,this.m_indexA=0,this.m_indexB=0,this.m_localCenterA=null,this.m_localCenterB=null,this.m_invMassA=0,this.m_invMassB=0,this.m_invIA=0,this.m_invIB=0,this.m_axis=null,this.m_perp=null,this.m_s1=0,this.m_s2=0,this.m_a1=0,this.m_a2=0,this.m_K=null,this.m_K3=null,this.m_K2=null,this.m_motorMass=0,this.m_qA=null,this.m_qB=null,this.m_lalcA=null,this.m_lalcB=null,this.m_rA=null,this.m_rB=null,this.m_localAnchorA=e.localAnchorA.Clone(),this.m_localAnchorB=e.localAnchorB.Clone(),this.m_localXAxisA=e.localAxisA.Clone().SelfNormalize(),this.m_localYAxisA=o.b2CrossOneV(this.m_localXAxisA,new o.b2Vec2),this.m_referenceAngle=e.referenceAngle,this.m_impulse=new o.b2Vec3(0,0,0),this.m_lowerTranslation=e.lowerTranslation,this.m_upperTranslation=e.upperTranslation,this.m_maxMotorForce=e.maxMotorForce,this.m_motorSpeed=e.motorSpeed,this.m_enableLimit=e.enableLimit,this.m_enableMotor=e.enableMotor,this.m_localCenterA=new o.b2Vec2,this.m_localCenterB=new o.b2Vec2,this.m_axis=new o.b2Vec2(0,0),this.m_perp=new o.b2Vec2(0,0),this.m_K=new o.b2Mat33,this.m_K3=new o.b2Mat33,this.m_K2=new o.b2Mat22,this.m_qA=new o.b2Rot,this.m_qB=new o.b2Rot,this.m_lalcA=new o.b2Vec2,this.m_lalcB=new o.b2Vec2,this.m_rA=new o.b2Vec2,this.m_rB=new o.b2Vec2}return s(e,t),e.prototype.InitVelocityConstraints=function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var i=t.positions[this.m_indexA].c,s=t.positions[this.m_indexA].a,a=t.velocities[this.m_indexA].v,_=t.velocities[this.m_indexA].w,m=t.positions[this.m_indexB].c,h=t.positions[this.m_indexB].a,l=t.velocities[this.m_indexB].v,c=t.velocities[this.m_indexB].w,u=this.m_qA.SetAngleRadians(s),p=this.m_qB.SetAngleRadians(h);o.b2SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var b=o.b2MulRV(u,this.m_lalcA,this.m_rA);o.b2SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var y=o.b2MulRV(p,this.m_lalcB,this.m_rB),d=o.b2AddVV(o.b2SubVV(m,i,o.b2Vec2.s_t0),o.b2SubVV(y,b,o.b2Vec2.s_t1),e.InitVelocityConstraints_s_d),f=this.m_invMassA,A=this.m_invMassB,v=this.m_invIA,S=this.m_invIB;if(o.b2MulRV(u,this.m_localXAxisA,this.m_axis),this.m_a1=o.b2CrossVV(o.b2AddVV(d,b,o.b2Vec2.s_t0),this.m_axis),this.m_a2=o.b2CrossVV(y,this.m_axis),this.m_motorMass=f+A+v*this.m_a1*this.m_a1+S*this.m_a2*this.m_a2,this.m_motorMass>0&&(this.m_motorMass=1/this.m_motorMass),o.b2MulRV(u,this.m_localYAxisA,this.m_perp),this.m_s1=o.b2CrossVV(o.b2AddVV(d,b,o.b2Vec2.s_t0),this.m_perp),this.m_s2=o.b2CrossVV(y,this.m_perp),this.m_K.ex.x=f+A+v*this.m_s1*this.m_s1+S*this.m_s2*this.m_s2,this.m_K.ex.y=v*this.m_s1+S*this.m_s2,this.m_K.ex.z=v*this.m_s1*this.m_a1+S*this.m_s2*this.m_a2,this.m_K.ey.x=this.m_K.ex.y,this.m_K.ey.y=v+S,0==this.m_K.ey.y&&(this.m_K.ey.y=1),this.m_K.ey.z=v*this.m_a1+S*this.m_a2,this.m_K.ez.x=this.m_K.ex.z,this.m_K.ez.y=this.m_K.ey.z,this.m_K.ez.z=f+A+v*this.m_a1*this.m_a1+S*this.m_a2*this.m_a2,this.m_enableLimit){var V=o.b2DotVV(this.m_axis,d);o.b2Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*n.b2_linearSlop?this.m_limitState=r.b2LimitState.e_equalLimits:V<=this.m_lowerTranslation?this.m_limitState!=r.b2LimitState.e_atLowerLimit&&(this.m_limitState=r.b2LimitState.e_atLowerLimit,this.m_impulse.z=0):V>=this.m_upperTranslation?this.m_limitState!=r.b2LimitState.e_atUpperLimit&&(this.m_limitState=r.b2LimitState.e_atUpperLimit,this.m_impulse.z=0):(this.m_limitState=r.b2LimitState.e_inactiveLimit,this.m_impulse.z=0)}else this.m_limitState=r.b2LimitState.e_inactiveLimit,this.m_impulse.z=0;if(0==this.m_enableMotor&&(this.m_motorImpulse=0),t.step.warmStarting){this.m_impulse.SelfMul(t.step.dtRatio),this.m_motorImpulse*=t.step.dtRatio;var x=o.b2AddVV(o.b2MulSV(this.m_impulse.x,this.m_perp,o.b2Vec2.s_t0),o.b2MulSV(this.m_motorImpulse+this.m_impulse.z,this.m_axis,o.b2Vec2.s_t1),e.InitVelocityConstraints_s_P),C=this.m_impulse.x*this.m_s1+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a1,B=this.m_impulse.x*this.m_s2+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a2;a.SelfMulSub(f,x),_-=v*C,l.SelfMulAdd(A,x),c+=S*B}else this.m_impulse.SetZero(),this.m_motorImpulse=0;t.velocities[this.m_indexA].w=_,t.velocities[this.m_indexB].w=c},e.prototype.SolveVelocityConstraints=function(t){var i=t.velocities[this.m_indexA].v,s=t.velocities[this.m_indexA].w,n=t.velocities[this.m_indexB].v,a=t.velocities[this.m_indexB].w,_=this.m_invMassA,m=this.m_invMassB,h=this.m_invIA,l=this.m_invIB;if(this.m_enableMotor&&this.m_limitState!=r.b2LimitState.e_equalLimits){var c=o.b2DotVV(this.m_axis,o.b2SubVV(n,i,o.b2Vec2.s_t0))+this.m_a2*a-this.m_a1*s,u=this.m_motorMass*(this.m_motorSpeed-c),p=this.m_motorImpulse,b=t.step.dt*this.m_maxMotorForce;this.m_motorImpulse=o.b2Clamp(this.m_motorImpulse+u,-b,b),u=this.m_motorImpulse-p;var y=o.b2MulSV(u,this.m_axis,e.SolveVelocityConstraints_s_P),d=u*this.m_a1,f=u*this.m_a2;i.SelfMulSub(_,y),s-=h*d,n.SelfMulAdd(m,y),a+=l*f}var A=o.b2DotVV(this.m_perp,o.b2SubVV(n,i,o.b2Vec2.s_t0))+this.m_s2*a-this.m_s1*s,v=a-s;if(this.m_enableLimit&&this.m_limitState!=r.b2LimitState.e_inactiveLimit){var S=o.b2DotVV(this.m_axis,o.b2SubVV(n,i,o.b2Vec2.s_t0))+this.m_a2*a-this.m_a1*s,V=e.SolveVelocityConstraints_s_f1.Copy(this.m_impulse),x=this.m_K.Solve33(-A,-v,-S,e.SolveVelocityConstraints_s_df3);this.m_impulse.SelfAdd(x),this.m_limitState==r.b2LimitState.e_atLowerLimit?this.m_impulse.z=o.b2Max(this.m_impulse.z,0):this.m_limitState==r.b2LimitState.e_atUpperLimit&&(this.m_impulse.z=o.b2Min(this.m_impulse.z,0));var C=-A-(this.m_impulse.z-V.z)*this.m_K.ez.x,B=-v-(this.m_impulse.z-V.z)*this.m_K.ez.y,g=this.m_K.Solve22(C,B,e.SolveVelocityConstraints_s_f2r);g.x+=V.x,g.y+=V.y,this.m_impulse.x=g.x,this.m_impulse.y=g.y,x.x=this.m_impulse.x-V.x,x.y=this.m_impulse.y-V.y,x.z=this.m_impulse.z-V.z;var y=o.b2AddVV(o.b2MulSV(x.x,this.m_perp,o.b2Vec2.s_t0),o.b2MulSV(x.z,this.m_axis,o.b2Vec2.s_t1),e.SolveVelocityConstraints_s_P),d=x.x*this.m_s1+x.y+x.z*this.m_a1,f=x.x*this.m_s2+x.y+x.z*this.m_a2;i.SelfMulSub(_,y),s-=h*d,n.SelfMulAdd(m,y),a+=l*f}else{var w=this.m_K.Solve22(-A,-v,e.SolveVelocityConstraints_s_df2);this.m_impulse.x+=w.x,this.m_impulse.y+=w.y;var y=o.b2MulSV(w.x,this.m_perp,e.SolveVelocityConstraints_s_P),d=w.x*this.m_s1+w.y,f=w.x*this.m_s2+w.y;i.SelfMulSub(_,y),s-=h*d,n.SelfMulAdd(m,y),a+=l*f}t.velocities[this.m_indexA].w=s,t.velocities[this.m_indexB].w=a},e.prototype.SolvePositionConstraints=function(t){var i=t.positions[this.m_indexA].c,s=t.positions[this.m_indexA].a,r=t.positions[this.m_indexB].c,a=t.positions[this.m_indexB].a,_=this.m_qA.SetAngleRadians(s),m=this.m_qB.SetAngleRadians(a),h=this.m_invMassA,l=this.m_invMassB,c=this.m_invIA,u=this.m_invIB,p=o.b2MulRV(_,this.m_lalcA,this.m_rA),b=o.b2MulRV(m,this.m_lalcB,this.m_rB),y=o.b2SubVV(o.b2AddVV(r,b,o.b2Vec2.s_t0),o.b2AddVV(i,p,o.b2Vec2.s_t1),e.SolvePositionConstraints_s_d),d=o.b2MulRV(_,this.m_localXAxisA,this.m_axis),f=o.b2CrossVV(o.b2AddVV(y,p,o.b2Vec2.s_t0),d),A=o.b2CrossVV(b,d),v=o.b2MulRV(_,this.m_localYAxisA,this.m_perp),S=o.b2CrossVV(o.b2AddVV(y,p,o.b2Vec2.s_t0),v),V=o.b2CrossVV(b,v),x=e.SolvePositionConstraints_s_impulse,C=o.b2DotVV(v,y),B=a-s-this.m_referenceAngle,g=o.b2Abs(C),w=o.b2Abs(B),M=!1,L=0;
if(this.m_enableLimit){var I=o.b2DotVV(d,y);o.b2Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*n.b2_linearSlop?(L=o.b2Clamp(I,-n.b2_maxLinearCorrection,n.b2_maxLinearCorrection),g=o.b2Max(g,o.b2Abs(I)),M=!0):I<=this.m_lowerTranslation?(L=o.b2Clamp(I-this.m_lowerTranslation+n.b2_linearSlop,-n.b2_maxLinearCorrection,0),g=o.b2Max(g,this.m_lowerTranslation-I),M=!0):I>=this.m_upperTranslation&&(L=o.b2Clamp(I-this.m_upperTranslation-n.b2_linearSlop,0,n.b2_maxLinearCorrection),g=o.b2Max(g,I-this.m_upperTranslation),M=!0)}if(M){var T=h+l+c*S*S+u*V*V,R=c*S+u*V,E=c*S*f+u*V*A,G=c+u;0==G&&(G=1);var D=c*f+u*A,P=h+l+c*f*f+u*A*A,F=this.m_K3;F.ex.SetXYZ(T,R,E),F.ey.SetXYZ(R,G,D),F.ez.SetXYZ(E,D,P),x=F.Solve33(-C,-B,-L,x)}else{var T=h+l+c*S*S+u*V*V,R=c*S+u*V,G=c+u;0==G&&(G=1);var k=this.m_K2;k.ex.SetXY(T,R),k.ey.SetXY(R,G);var N=k.Solve(-C,-B,e.SolvePositionConstraints_s_impulse1);x.x=N.x,x.y=N.y,x.z=0}var q=o.b2AddVV(o.b2MulSV(x.x,v,o.b2Vec2.s_t0),o.b2MulSV(x.z,d,o.b2Vec2.s_t1),e.SolvePositionConstraints_s_P),z=x.x*S+x.y+x.z*f,J=x.x*V+x.y+x.z*A;return i.SelfMulSub(h,q),s-=c*z,r.SelfMulAdd(l,q),a+=u*J,t.positions[this.m_indexA].a=s,t.positions[this.m_indexB].a=a,g<=n.b2_linearSlop&&w<=n.b2_angularSlop},e.prototype.GetAnchorA=function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)},e.prototype.GetAnchorB=function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)},e.prototype.GetReactionForce=function(t,e){return e.SetXY(t*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x),t*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y))},e.prototype.GetReactionTorque=function(t){return t*this.m_impulse.y},e.prototype.GetLocalAnchorA=function(){return this.m_localAnchorA},e.prototype.GetLocalAnchorB=function(){return this.m_localAnchorB},e.prototype.GetLocalAxisA=function(){return this.m_localXAxisA},e.prototype.GetReferenceAngle=function(){return this.m_referenceAngle},e.prototype.GetJointTranslation=function(){var t=this.m_bodyA.GetWorldPoint(this.m_localAnchorA,e.GetJointTranslation_s_pA),i=this.m_bodyB.GetWorldPoint(this.m_localAnchorB,e.GetJointTranslation_s_pB),s=o.b2SubVV(i,t,e.GetJointTranslation_s_d),n=this.m_bodyA.GetWorldVector(this.m_localXAxisA,e.GetJointTranslation_s_axis),r=o.b2DotVV(s,n);return r},e.prototype.GetJointSpeed=function(){var t=this.m_bodyA,e=this.m_bodyB;o.b2SubVV(this.m_localAnchorA,t.m_sweep.localCenter,this.m_lalcA);var i=o.b2MulRV(t.m_xf.q,this.m_lalcA,this.m_rA);o.b2SubVV(this.m_localAnchorB,e.m_sweep.localCenter,this.m_lalcB);var s=o.b2MulRV(e.m_xf.q,this.m_lalcB,this.m_rB),n=o.b2AddVV(t.m_sweep.c,i,o.b2Vec2.s_t0),r=o.b2AddVV(e.m_sweep.c,s,o.b2Vec2.s_t1),a=o.b2SubVV(r,n,o.b2Vec2.s_t2),_=t.GetWorldVector(this.m_localXAxisA,this.m_axis),m=t.m_linearVelocity,h=e.m_linearVelocity,l=t.m_angularVelocity,c=e.m_angularVelocity,u=o.b2DotVV(a,o.b2CrossSV(l,_,o.b2Vec2.s_t0))+o.b2DotVV(_,o.b2SubVV(o.b2AddVCrossSV(h,c,s,o.b2Vec2.s_t0),o.b2AddVCrossSV(m,l,i,o.b2Vec2.s_t1),o.b2Vec2.s_t0));return u},e.prototype.IsLimitEnabled=function(){return this.m_enableLimit},e.prototype.EnableLimit=function(t){t!=this.m_enableLimit&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=t,this.m_impulse.z=0)},e.prototype.GetLowerLimit=function(){return this.m_lowerTranslation},e.prototype.GetUpperLimit=function(){return this.m_upperTranslation},e.prototype.SetLimits=function(t,e){t==this.m_lowerTranslation&&e==this.m_upperTranslation||(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_lowerTranslation=t,this.m_upperTranslation=e,this.m_impulse.z=0)},e.prototype.IsMotorEnabled=function(){return this.m_enableMotor},e.prototype.EnableMotor=function(t){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=t},e.prototype.SetMotorSpeed=function(t){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=t},e.prototype.GetMotorSpeed=function(){return this.m_motorSpeed},e.prototype.SetMaxMotorForce=function(t){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorForce=t},e.prototype.GetMaxMotorForce=function(){return this.m_maxMotorForce},e.prototype.GetMotorForce=function(t){return t*this.m_motorImpulse},e.prototype.Dump=function(){if(n.DEBUG){var t=this.m_bodyA.m_islandIndex,e=this.m_bodyB.m_islandIndex;n.b2Log("  var jd: b2PrismaticJointDef = new b2PrismaticJointDef();\n"),n.b2Log("  jd.bodyA = bodies[%d];\n",t),n.b2Log("  jd.bodyB = bodies[%d];\n",e),n.b2Log("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),n.b2Log("  jd.localAnchorA.SetXY(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),n.b2Log("  jd.localAnchorB.SetXY(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),n.b2Log("  jd.localAxisA.SetXY(%.15f, %.15f);\n",this.m_localXAxisA.x,this.m_localXAxisA.y),n.b2Log("  jd.referenceAngle = %.15f;\n",this.m_referenceAngle),n.b2Log("  jd.enableLimit = %s;\n",this.m_enableLimit?"true":"false"),n.b2Log("  jd.lowerTranslation = %.15f;\n",this.m_lowerTranslation),n.b2Log("  jd.upperTranslation = %.15f;\n",this.m_upperTranslation),n.b2Log("  jd.enableMotor = %s;\n",this.m_enableMotor?"true":"false"),n.b2Log("  jd.motorSpeed = %.15f;\n",this.m_motorSpeed),n.b2Log("  jd.maxMotorForce = %.15f;\n",this.m_maxMotorForce),n.b2Log("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}},e.InitVelocityConstraints_s_d=new o.b2Vec2,e.InitVelocityConstraints_s_P=new o.b2Vec2,e.SolveVelocityConstraints_s_P=new o.b2Vec2,e.SolveVelocityConstraints_s_f2r=new o.b2Vec2,e.SolveVelocityConstraints_s_f1=new o.b2Vec3,e.SolveVelocityConstraints_s_df3=new o.b2Vec3,e.SolveVelocityConstraints_s_df2=new o.b2Vec2,e.SolvePositionConstraints_s_d=new o.b2Vec2,e.SolvePositionConstraints_s_impulse=new o.b2Vec3,e.SolvePositionConstraints_s_impulse1=new o.b2Vec2,e.SolvePositionConstraints_s_P=new o.b2Vec2,e.GetJointTranslation_s_pA=new o.b2Vec2,e.GetJointTranslation_s_pB=new o.b2Vec2,e.GetJointTranslation_s_d=new o.b2Vec2,e.GetJointTranslation_s_axis=new o.b2Vec2,e}(r.b2Joint);e.b2PrismaticJoint=_},function(t,e,i){"use strict";var s=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},o=i(4),n=i(3),r=i(23),a=function(t){function e(){t.call(this,r.b2JointType.e_revoluteJoint),this.localAnchorA=new o.b2Vec2(0,0),this.localAnchorB=new o.b2Vec2(0,0),this.referenceAngle=0,this.enableLimit=!1,this.lowerAngle=0,this.upperAngle=0,this.enableMotor=!1,this.motorSpeed=0,this.maxMotorTorque=0}return s(e,t),e.prototype.Initialize=function(t,e,i){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(i,this.localAnchorA),this.bodyB.GetLocalPoint(i,this.localAnchorB),this.referenceAngle=this.bodyB.GetAngleRadians()-this.bodyA.GetAngleRadians()},e}(r.b2JointDef);e.b2RevoluteJointDef=a;var _=function(t){function e(e){t.call(this,e),this.m_localAnchorA=new o.b2Vec2,this.m_localAnchorB=new o.b2Vec2,this.m_impulse=new o.b2Vec3,this.m_motorImpulse=0,this.m_enableMotor=!1,this.m_maxMotorTorque=0,this.m_motorSpeed=0,this.m_enableLimit=!1,this.m_referenceAngle=0,this.m_lowerAngle=0,this.m_upperAngle=0,this.m_indexA=0,this.m_indexB=0,this.m_rA=new o.b2Vec2,this.m_rB=new o.b2Vec2,this.m_localCenterA=new o.b2Vec2,this.m_localCenterB=new o.b2Vec2,this.m_invMassA=0,this.m_invMassB=0,this.m_invIA=0,this.m_invIB=0,this.m_mass=new o.b2Mat33,this.m_motorMass=0,this.m_limitState=r.b2LimitState.e_inactiveLimit,this.m_qA=new o.b2Rot,this.m_qB=new o.b2Rot,this.m_lalcA=new o.b2Vec2,this.m_lalcB=new o.b2Vec2,this.m_K=new o.b2Mat22,this.m_localAnchorA.Copy(e.localAnchorA),this.m_localAnchorB.Copy(e.localAnchorB),this.m_referenceAngle=e.referenceAngle,this.m_impulse.SetZero(),this.m_motorImpulse=0,this.m_lowerAngle=e.lowerAngle,this.m_upperAngle=e.upperAngle,this.m_maxMotorTorque=e.maxMotorTorque,this.m_motorSpeed=e.motorSpeed,this.m_enableLimit=e.enableLimit,this.m_enableMotor=e.enableMotor,this.m_limitState=r.b2LimitState.e_inactiveLimit}return s(e,t),e.prototype.InitVelocityConstraints=function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var i=t.positions[this.m_indexA].a,s=t.velocities[this.m_indexA].v,a=t.velocities[this.m_indexA].w,_=t.positions[this.m_indexB].a,m=t.velocities[this.m_indexB].v,h=t.velocities[this.m_indexB].w,l=this.m_qA.SetAngleRadians(i),c=this.m_qB.SetAngleRadians(_);o.b2SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),o.b2MulRV(l,this.m_lalcA,this.m_rA),o.b2SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),o.b2MulRV(c,this.m_lalcB,this.m_rB);var u=this.m_invMassA,p=this.m_invMassB,b=this.m_invIA,y=this.m_invIB,d=b+y==0;if(this.m_mass.ex.x=u+p+this.m_rA.y*this.m_rA.y*b+this.m_rB.y*this.m_rB.y*y,this.m_mass.ey.x=-this.m_rA.y*this.m_rA.x*b-this.m_rB.y*this.m_rB.x*y,this.m_mass.ez.x=-this.m_rA.y*b-this.m_rB.y*y,this.m_mass.ex.y=this.m_mass.ey.x,this.m_mass.ey.y=u+p+this.m_rA.x*this.m_rA.x*b+this.m_rB.x*this.m_rB.x*y,this.m_mass.ez.y=this.m_rA.x*b+this.m_rB.x*y,this.m_mass.ex.z=this.m_mass.ez.x,this.m_mass.ey.z=this.m_mass.ez.y,this.m_mass.ez.z=b+y,this.m_motorMass=b+y,this.m_motorMass>0&&(this.m_motorMass=1/this.m_motorMass),(0==this.m_enableMotor||d)&&(this.m_motorImpulse=0),this.m_enableLimit&&0==d){var f=_-i-this.m_referenceAngle;o.b2Abs(this.m_upperAngle-this.m_lowerAngle)<2*n.b2_angularSlop?this.m_limitState=r.b2LimitState.e_equalLimits:f<=this.m_lowerAngle?(this.m_limitState!=r.b2LimitState.e_atLowerLimit&&(this.m_impulse.z=0),this.m_limitState=r.b2LimitState.e_atLowerLimit):f>=this.m_upperAngle?(this.m_limitState!=r.b2LimitState.e_atUpperLimit&&(this.m_impulse.z=0),this.m_limitState=r.b2LimitState.e_atUpperLimit):(this.m_limitState=r.b2LimitState.e_inactiveLimit,this.m_impulse.z=0)}else this.m_limitState=r.b2LimitState.e_inactiveLimit;if(t.step.warmStarting){this.m_impulse.SelfMul(t.step.dtRatio),this.m_motorImpulse*=t.step.dtRatio;var A=e.InitVelocityConstraints_s_P.SetXY(this.m_impulse.x,this.m_impulse.y);s.SelfMulSub(u,A),a-=b*(o.b2CrossVV(this.m_rA,A)+this.m_motorImpulse+this.m_impulse.z),m.SelfMulAdd(p,A),h+=y*(o.b2CrossVV(this.m_rB,A)+this.m_motorImpulse+this.m_impulse.z)}else this.m_impulse.SetZero(),this.m_motorImpulse=0;t.velocities[this.m_indexA].w=a,t.velocities[this.m_indexB].w=h},e.prototype.SolveVelocityConstraints=function(t){var i=t.velocities[this.m_indexA].v,s=t.velocities[this.m_indexA].w,n=t.velocities[this.m_indexB].v,a=t.velocities[this.m_indexB].w,_=this.m_invMassA,m=this.m_invMassB,h=this.m_invIA,l=this.m_invIB,c=h+l==0;if(this.m_enableMotor&&this.m_limitState!=r.b2LimitState.e_equalLimits&&0==c){var u=a-s-this.m_motorSpeed,p=-this.m_motorMass*u,b=this.m_motorImpulse,y=t.step.dt*this.m_maxMotorTorque;this.m_motorImpulse=o.b2Clamp(this.m_motorImpulse+p,-y,y),p=this.m_motorImpulse-b,s-=h*p,a+=l*p}if(this.m_enableLimit&&this.m_limitState!=r.b2LimitState.e_inactiveLimit&&0==c){var d=o.b2SubVV(o.b2AddVCrossSV(n,a,this.m_rB,o.b2Vec2.s_t0),o.b2AddVCrossSV(i,s,this.m_rA,o.b2Vec2.s_t1),e.SolveVelocityConstraints_s_Cdot1),f=a-s,A=this.m_mass.Solve33(d.x,d.y,f,e.SolveVelocityConstraints_s_impulse_v3).SelfNeg();if(this.m_limitState==r.b2LimitState.e_equalLimits)this.m_impulse.SelfAdd(A);else if(this.m_limitState==r.b2LimitState.e_atLowerLimit){var v=this.m_impulse.z+A.z;if(v<0){var S=-d.x+this.m_impulse.z*this.m_mass.ez.x,V=-d.y+this.m_impulse.z*this.m_mass.ez.y,x=this.m_mass.Solve22(S,V,e.SolveVelocityConstraints_s_reduced_v2);A.x=x.x,A.y=x.y,A.z=-this.m_impulse.z,this.m_impulse.x+=x.x,this.m_impulse.y+=x.y,this.m_impulse.z=0}else this.m_impulse.SelfAdd(A)}else if(this.m_limitState==r.b2LimitState.e_atUpperLimit){var v=this.m_impulse.z+A.z;if(v>0){var S=-d.x+this.m_impulse.z*this.m_mass.ez.x,V=-d.y+this.m_impulse.z*this.m_mass.ez.y,x=this.m_mass.Solve22(S,V,e.SolveVelocityConstraints_s_reduced_v2);A.x=x.x,A.y=x.y,A.z=-this.m_impulse.z,this.m_impulse.x+=x.x,this.m_impulse.y+=x.y,this.m_impulse.z=0}else this.m_impulse.SelfAdd(A)}var C=e.SolveVelocityConstraints_s_P.SetXY(A.x,A.y);i.SelfMulSub(_,C),s-=h*(o.b2CrossVV(this.m_rA,C)+A.z),n.SelfMulAdd(m,C),a+=l*(o.b2CrossVV(this.m_rB,C)+A.z)}else{var B=o.b2SubVV(o.b2AddVCrossSV(n,a,this.m_rB,o.b2Vec2.s_t0),o.b2AddVCrossSV(i,s,this.m_rA,o.b2Vec2.s_t1),e.SolveVelocityConstraints_s_Cdot_v2),g=this.m_mass.Solve22(-B.x,-B.y,e.SolveVelocityConstraints_s_impulse_v2);this.m_impulse.x+=g.x,this.m_impulse.y+=g.y,i.SelfMulSub(_,g),s-=h*o.b2CrossVV(this.m_rA,g),n.SelfMulAdd(m,g),a+=l*o.b2CrossVV(this.m_rB,g)}t.velocities[this.m_indexA].w=s,t.velocities[this.m_indexB].w=a},e.prototype.SolvePositionConstraints=function(t){var i=t.positions[this.m_indexA].c,s=t.positions[this.m_indexA].a,a=t.positions[this.m_indexB].c,_=t.positions[this.m_indexB].a,m=this.m_qA.SetAngleRadians(s),h=this.m_qB.SetAngleRadians(_),l=0,c=0,u=this.m_invIA+this.m_invIB==0;if(this.m_enableLimit&&this.m_limitState!=r.b2LimitState.e_inactiveLimit&&0==u){var p=_-s-this.m_referenceAngle,b=0;if(this.m_limitState==r.b2LimitState.e_equalLimits){var y=o.b2Clamp(p-this.m_lowerAngle,-n.b2_maxAngularCorrection,n.b2_maxAngularCorrection);b=-this.m_motorMass*y,l=o.b2Abs(y)}else if(this.m_limitState==r.b2LimitState.e_atLowerLimit){var y=p-this.m_lowerAngle;l=-y,y=o.b2Clamp(y+n.b2_angularSlop,-n.b2_maxAngularCorrection,0),b=-this.m_motorMass*y}else if(this.m_limitState==r.b2LimitState.e_atUpperLimit){var y=p-this.m_upperAngle;l=y,y=o.b2Clamp(y-n.b2_angularSlop,0,n.b2_maxAngularCorrection),b=-this.m_motorMass*y}s-=this.m_invIA*b,_+=this.m_invIB*b}m.SetAngleRadians(s),h.SetAngleRadians(_),o.b2SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var d=o.b2MulRV(m,this.m_lalcA,this.m_rA);o.b2SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var f=o.b2MulRV(h,this.m_lalcB,this.m_rB),A=o.b2SubVV(o.b2AddVV(a,f,o.b2Vec2.s_t0),o.b2AddVV(i,d,o.b2Vec2.s_t1),e.SolvePositionConstraints_s_C_v2);c=A.GetLength();var v=this.m_invMassA,S=this.m_invMassB,V=this.m_invIA,x=this.m_invIB,C=this.m_K;C.ex.x=v+S+V*d.y*d.y+x*f.y*f.y,C.ex.y=-V*d.x*d.y-x*f.x*f.y,C.ey.x=C.ex.y,C.ey.y=v+S+V*d.x*d.x+x*f.x*f.x;var B=C.Solve(A.x,A.y,e.SolvePositionConstraints_s_impulse).SelfNeg();return i.SelfMulSub(v,B),s-=V*o.b2CrossVV(d,B),a.SelfMulAdd(S,B),_+=x*o.b2CrossVV(f,B),t.positions[this.m_indexA].a=s,t.positions[this.m_indexB].a=_,c<=n.b2_linearSlop&&l<=n.b2_angularSlop},e.prototype.GetAnchorA=function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)},e.prototype.GetAnchorB=function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)},e.prototype.GetReactionForce=function(t,e){return e.SetXY(t*this.m_impulse.x,t*this.m_impulse.y)},e.prototype.GetReactionTorque=function(t){return t*this.m_impulse.z},e.prototype.GetLocalAnchorA=function(){return this.m_localAnchorA},e.prototype.GetLocalAnchorB=function(){return this.m_localAnchorB},e.prototype.GetReferenceAngle=function(){return this.m_referenceAngle},e.prototype.GetJointAngleRadians=function(){return this.m_bodyB.m_sweep.a-this.m_bodyA.m_sweep.a-this.m_referenceAngle},e.prototype.GetJointSpeed=function(){return this.m_bodyB.m_angularVelocity-this.m_bodyA.m_angularVelocity},e.prototype.IsMotorEnabled=function(){return this.m_enableMotor},e.prototype.EnableMotor=function(t){this.m_enableMotor!=t&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=t)},e.prototype.GetMotorTorque=function(t){return t*this.m_motorImpulse},e.prototype.GetMotorSpeed=function(){return this.m_motorSpeed},e.prototype.SetMaxMotorTorque=function(t){this.m_maxMotorTorque=t},e.prototype.GetMaxMotorTorque=function(){return this.m_maxMotorTorque},e.prototype.IsLimitEnabled=function(){return this.m_enableLimit},e.prototype.EnableLimit=function(t){t!=this.m_enableLimit&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=t,this.m_impulse.z=0)},e.prototype.GetLowerLimit=function(){return this.m_lowerAngle},e.prototype.GetUpperLimit=function(){return this.m_upperAngle},e.prototype.SetLimits=function(t,e){t==this.m_lowerAngle&&e==this.m_upperAngle||(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_impulse.z=0,this.m_lowerAngle=t,this.m_upperAngle=e)},e.prototype.SetMotorSpeed=function(t){this.m_motorSpeed!=t&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=t)},e.prototype.Dump=function(){if(n.DEBUG){var t=this.m_bodyA.m_islandIndex,e=this.m_bodyB.m_islandIndex;n.b2Log("  var jd: b2RevoluteJointDef = new b2RevoluteJointDef();\n"),n.b2Log("  jd.bodyA = bodies[%d];\n",t),n.b2Log("  jd.bodyB = bodies[%d];\n",e),n.b2Log("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),n.b2Log("  jd.localAnchorA.SetXY(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),n.b2Log("  jd.localAnchorB.SetXY(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),n.b2Log("  jd.referenceAngle = %.15f;\n",this.m_referenceAngle),n.b2Log("  jd.enableLimit = %s;\n",this.m_enableLimit?"true":"false"),n.b2Log("  jd.lowerAngle = %.15f;\n",this.m_lowerAngle),n.b2Log("  jd.upperAngle = %.15f;\n",this.m_upperAngle),n.b2Log("  jd.enableMotor = %s;\n",this.m_enableMotor?"true":"false"),n.b2Log("  jd.motorSpeed = %.15f;\n",this.m_motorSpeed),n.b2Log("  jd.maxMotorTorque = %.15f;\n",this.m_maxMotorTorque),n.b2Log("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}},e.InitVelocityConstraints_s_P=new o.b2Vec2,e.SolveVelocityConstraints_s_P=new o.b2Vec2,e.SolveVelocityConstraints_s_Cdot_v2=new o.b2Vec2,e.SolveVelocityConstraints_s_Cdot1=new o.b2Vec2,e.SolveVelocityConstraints_s_impulse_v3=new o.b2Vec3,e.SolveVelocityConstraints_s_reduced_v2=new o.b2Vec2,e.SolveVelocityConstraints_s_impulse_v2=new o.b2Vec2,e.SolvePositionConstraints_s_C_v2=new o.b2Vec2,e.SolvePositionConstraints_s_impulse=new o.b2Vec2,e}(r.b2Joint);e.b2RevoluteJoint=_},function(t,e,i){"use strict";var s=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},o=i(4),n=i(3),r=i(23);e.b2_minPulleyLength=2;var a=function(t){function e(){t.call(this,r.b2JointType.e_pulleyJoint),this.groundAnchorA=new o.b2Vec2((-1),1),this.groundAnchorB=new o.b2Vec2(1,1),this.localAnchorA=new o.b2Vec2((-1),0),this.localAnchorB=new o.b2Vec2(1,0),this.lengthA=0,this.lengthB=0,this.ratio=1,this.collideConnected=!0}return s(e,t),e.prototype.Initialize=function(t,e,i,s,r,a,_){this.bodyA=t,this.bodyB=e,this.groundAnchorA.Copy(i),this.groundAnchorB.Copy(s),this.bodyA.GetLocalPoint(r,this.localAnchorA),this.bodyB.GetLocalPoint(a,this.localAnchorB),this.lengthA=o.b2DistanceVV(r,i),this.lengthB=o.b2DistanceVV(a,s),this.ratio=_,n.ENABLE_ASSERTS&&n.b2Assert(this.ratio>n.b2_epsilon)},e}(r.b2JointDef);e.b2PulleyJointDef=a;var _=function(t){function e(e){t.call(this,e),this.m_groundAnchorA=new o.b2Vec2,this.m_groundAnchorB=new o.b2Vec2,this.m_lengthA=0,this.m_lengthB=0,this.m_localAnchorA=new o.b2Vec2,this.m_localAnchorB=new o.b2Vec2,this.m_constant=0,this.m_ratio=0,this.m_impulse=0,this.m_indexA=0,this.m_indexB=0,this.m_uA=new o.b2Vec2,this.m_uB=new o.b2Vec2,this.m_rA=new o.b2Vec2,this.m_rB=new o.b2Vec2,this.m_localCenterA=new o.b2Vec2,this.m_localCenterB=new o.b2Vec2,this.m_invMassA=0,this.m_invMassB=0,this.m_invIA=0,this.m_invIB=0,this.m_mass=0,this.m_qA=new o.b2Rot,this.m_qB=new o.b2Rot,this.m_lalcA=new o.b2Vec2,this.m_lalcB=new o.b2Vec2,this.m_groundAnchorA.Copy(e.groundAnchorA),this.m_groundAnchorB.Copy(e.groundAnchorB),this.m_localAnchorA.Copy(e.localAnchorA),this.m_localAnchorB.Copy(e.localAnchorB),this.m_lengthA=e.lengthA,this.m_lengthB=e.lengthB,n.ENABLE_ASSERTS&&n.b2Assert(0!=e.ratio),this.m_ratio=e.ratio,this.m_constant=e.lengthA+this.m_ratio*e.lengthB,this.m_impulse=0}return s(e,t),e.prototype.InitVelocityConstraints=function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var i=t.positions[this.m_indexA].c,s=t.positions[this.m_indexA].a,r=t.velocities[this.m_indexA].v,a=t.velocities[this.m_indexA].w,_=t.positions[this.m_indexB].c,m=t.positions[this.m_indexB].a,h=t.velocities[this.m_indexB].v,l=t.velocities[this.m_indexB].w,c=this.m_qA.SetAngleRadians(s),u=this.m_qB.SetAngleRadians(m);o.b2SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),o.b2MulRV(c,this.m_lalcA,this.m_rA),o.b2SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),o.b2MulRV(u,this.m_lalcB,this.m_rB),this.m_uA.Copy(i).SelfAdd(this.m_rA).SelfSub(this.m_groundAnchorA),this.m_uB.Copy(_).SelfAdd(this.m_rB).SelfSub(this.m_groundAnchorB);var p=this.m_uA.GetLength(),b=this.m_uB.GetLength();p>10*n.b2_linearSlop?this.m_uA.SelfMul(1/p):this.m_uA.SetZero(),b>10*n.b2_linearSlop?this.m_uB.SelfMul(1/b):this.m_uB.SetZero();var y=o.b2CrossVV(this.m_rA,this.m_uA),d=o.b2CrossVV(this.m_rB,this.m_uB),f=this.m_invMassA+this.m_invIA*y*y,A=this.m_invMassB+this.m_invIB*d*d;if(this.m_mass=f+this.m_ratio*this.m_ratio*A,this.m_mass>0&&(this.m_mass=1/this.m_mass),t.step.warmStarting){this.m_impulse*=t.step.dtRatio;var v=o.b2MulSV(-this.m_impulse,this.m_uA,e.InitVelocityConstraints_s_PA),S=o.b2MulSV(-this.m_ratio*this.m_impulse,this.m_uB,e.InitVelocityConstraints_s_PB);r.SelfMulAdd(this.m_invMassA,v),a+=this.m_invIA*o.b2CrossVV(this.m_rA,v),h.SelfMulAdd(this.m_invMassB,S),l+=this.m_invIB*o.b2CrossVV(this.m_rB,S)}else this.m_impulse=0;t.velocities[this.m_indexA].w=a,t.velocities[this.m_indexB].w=l},e.prototype.SolveVelocityConstraints=function(t){var i=t.velocities[this.m_indexA].v,s=t.velocities[this.m_indexA].w,n=t.velocities[this.m_indexB].v,r=t.velocities[this.m_indexB].w,a=o.b2AddVCrossSV(i,s,this.m_rA,e.SolveVelocityConstraints_s_vpA),_=o.b2AddVCrossSV(n,r,this.m_rB,e.SolveVelocityConstraints_s_vpB),m=-o.b2DotVV(this.m_uA,a)-this.m_ratio*o.b2DotVV(this.m_uB,_),h=-this.m_mass*m;this.m_impulse+=h;var l=o.b2MulSV(-h,this.m_uA,e.SolveVelocityConstraints_s_PA),c=o.b2MulSV(-this.m_ratio*h,this.m_uB,e.SolveVelocityConstraints_s_PB);i.SelfMulAdd(this.m_invMassA,l),s+=this.m_invIA*o.b2CrossVV(this.m_rA,l),n.SelfMulAdd(this.m_invMassB,c),r+=this.m_invIB*o.b2CrossVV(this.m_rB,c),t.velocities[this.m_indexA].w=s,t.velocities[this.m_indexB].w=r},e.prototype.SolvePositionConstraints=function(t){var i=t.positions[this.m_indexA].c,s=t.positions[this.m_indexA].a,r=t.positions[this.m_indexB].c,a=t.positions[this.m_indexB].a,_=this.m_qA.SetAngleRadians(s),m=this.m_qB.SetAngleRadians(a);o.b2SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var h=o.b2MulRV(_,this.m_lalcA,this.m_rA);o.b2SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var l=o.b2MulRV(m,this.m_lalcB,this.m_rB),c=this.m_uA.Copy(i).SelfAdd(h).SelfSub(this.m_groundAnchorA),u=this.m_uB.Copy(r).SelfAdd(l).SelfSub(this.m_groundAnchorB),p=c.GetLength(),b=u.GetLength();p>10*n.b2_linearSlop?c.SelfMul(1/p):c.SetZero(),b>10*n.b2_linearSlop?u.SelfMul(1/b):u.SetZero();var y=o.b2CrossVV(h,c),d=o.b2CrossVV(l,u),f=this.m_invMassA+this.m_invIA*y*y,A=this.m_invMassB+this.m_invIB*d*d,v=f+this.m_ratio*this.m_ratio*A;v>0&&(v=1/v);var S=this.m_constant-p-this.m_ratio*b,V=o.b2Abs(S),x=-v*S,C=o.b2MulSV(-x,c,e.SolvePositionConstraints_s_PA),B=o.b2MulSV(-this.m_ratio*x,u,e.SolvePositionConstraints_s_PB);return i.SelfMulAdd(this.m_invMassA,C),s+=this.m_invIA*o.b2CrossVV(h,C),r.SelfMulAdd(this.m_invMassB,B),a+=this.m_invIB*o.b2CrossVV(l,B),t.positions[this.m_indexA].a=s,t.positions[this.m_indexB].a=a,V<n.b2_linearSlop},e.prototype.GetAnchorA=function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)},e.prototype.GetAnchorB=function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)},e.prototype.GetReactionForce=function(t,e){return e.SetXY(t*this.m_impulse*this.m_uB.x,t*this.m_impulse*this.m_uB.y)},e.prototype.GetReactionTorque=function(t){return 0},e.prototype.GetGroundAnchorA=function(){return this.m_groundAnchorA},e.prototype.GetGroundAnchorB=function(){return this.m_groundAnchorB},e.prototype.GetLengthA=function(){return this.m_lengthA},e.prototype.GetLengthB=function(){return this.m_lengthB},e.prototype.GetRatio=function(){return this.m_ratio},e.prototype.GetCurrentLengthA=function(){var t=this.m_bodyA.GetWorldPoint(this.m_localAnchorA,e.GetCurrentLengthA_s_p),i=this.m_groundAnchorA;return o.b2DistanceVV(t,i)},e.prototype.GetCurrentLengthB=function(){var t=this.m_bodyB.GetWorldPoint(this.m_localAnchorB,e.GetCurrentLengthB_s_p),i=this.m_groundAnchorB;return o.b2DistanceVV(t,i)},e.prototype.Dump=function(){if(n.DEBUG){var t=this.m_bodyA.m_islandIndex,e=this.m_bodyB.m_islandIndex;n.b2Log("  var jd: b2PulleyJointDef = new b2PulleyJointDef();\n"),n.b2Log("  jd.bodyA = bodies[%d];\n",t),n.b2Log("  jd.bodyB = bodies[%d];\n",e),n.b2Log("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),n.b2Log("  jd.groundAnchorA.SetXY(%.15f, %.15f);\n",this.m_groundAnchorA.x,this.m_groundAnchorA.y),n.b2Log("  jd.groundAnchorB.SetXY(%.15f, %.15f);\n",this.m_groundAnchorB.x,this.m_groundAnchorB.y),n.b2Log("  jd.localAnchorA.SetXY(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),n.b2Log("  jd.localAnchorB.SetXY(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),n.b2Log("  jd.lengthA = %.15f;\n",this.m_lengthA),n.b2Log("  jd.lengthB = %.15f;\n",this.m_lengthB),n.b2Log("  jd.ratio = %.15f;\n",this.m_ratio),n.b2Log("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}},e.prototype.ShiftOrigin=function(t){this.m_groundAnchorA.SelfSub(t),this.m_groundAnchorB.SelfSub(t)},e.InitVelocityConstraints_s_PA=new o.b2Vec2,e.InitVelocityConstraints_s_PB=new o.b2Vec2,e.SolveVelocityConstraints_s_vpA=new o.b2Vec2,e.SolveVelocityConstraints_s_vpB=new o.b2Vec2,e.SolveVelocityConstraints_s_PA=new o.b2Vec2,e.SolveVelocityConstraints_s_PB=new o.b2Vec2,e.SolvePositionConstraints_s_PA=new o.b2Vec2,e.SolvePositionConstraints_s_PB=new o.b2Vec2,e.GetCurrentLengthA_s_p=new o.b2Vec2,e.GetCurrentLengthB_s_p=new o.b2Vec2,e}(r.b2Joint);e.b2PulleyJoint=_},function(t,e,i){"use strict";var s=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},o=i(4),n=i(3),r=i(23),a=function(t){function e(){t.call(this,r.b2JointType.e_gearJoint),this.joint1=null,this.joint2=null,this.ratio=1}return s(e,t),e}(r.b2JointDef);e.b2GearJointDef=a;var _=function(t){function e(e){t.call(this,e),this.m_joint1=null,this.m_joint2=null,this.m_typeA=r.b2JointType.e_unknownJoint,this.m_typeB=r.b2JointType.e_unknownJoint,this.m_bodyC=null,this.m_bodyD=null,this.m_localAnchorA=new o.b2Vec2,this.m_localAnchorB=new o.b2Vec2,this.m_localAnchorC=new o.b2Vec2,this.m_localAnchorD=new o.b2Vec2,this.m_localAxisC=new o.b2Vec2,this.m_localAxisD=new o.b2Vec2,this.m_referenceAngleA=0,this.m_referenceAngleB=0,this.m_constant=0,this.m_ratio=0,this.m_impulse=0,this.m_indexA=0,this.m_indexB=0,this.m_indexC=0,this.m_indexD=0,this.m_lcA=new o.b2Vec2,this.m_lcB=new o.b2Vec2,this.m_lcC=new o.b2Vec2,this.m_lcD=new o.b2Vec2,this.m_mA=0,this.m_mB=0,this.m_mC=0,this.m_mD=0,this.m_iA=0,this.m_iB=0,this.m_iC=0,this.m_iD=0,this.m_JvAC=new o.b2Vec2,this.m_JvBD=new o.b2Vec2,this.m_JwA=0,this.m_JwB=0,this.m_JwC=0,this.m_JwD=0,this.m_mass=0,this.m_qA=new o.b2Rot,this.m_qB=new o.b2Rot,this.m_qC=new o.b2Rot,this.m_qD=new o.b2Rot,this.m_lalcA=new o.b2Vec2,this.m_lalcB=new o.b2Vec2,this.m_lalcC=new o.b2Vec2,this.m_lalcD=new o.b2Vec2,this.m_joint1=e.joint1,this.m_joint2=e.joint2,this.m_typeA=this.m_joint1.GetType(),this.m_typeB=this.m_joint2.GetType(),n.ENABLE_ASSERTS&&n.b2Assert(this.m_typeA==r.b2JointType.e_revoluteJoint||this.m_typeA==r.b2JointType.e_prismaticJoint),n.ENABLE_ASSERTS&&n.b2Assert(this.m_typeB==r.b2JointType.e_revoluteJoint||this.m_typeB==r.b2JointType.e_prismaticJoint);var i,s;this.m_bodyC=this.m_joint1.GetBodyA(),this.m_bodyA=this.m_joint1.GetBodyB();var a=this.m_bodyA.m_xf,_=this.m_bodyA.m_sweep.a,m=this.m_bodyC.m_xf,h=this.m_bodyC.m_sweep.a;if(this.m_typeA==r.b2JointType.e_revoluteJoint){var l=e.joint1;this.m_localAnchorC.Copy(l.m_localAnchorA),this.m_localAnchorA.Copy(l.m_localAnchorB),this.m_referenceAngleA=l.m_referenceAngle,this.m_localAxisC.SetZero(),i=_-h-this.m_referenceAngleA}else{var c=e.joint1;this.m_localAnchorC.Copy(c.m_localAnchorA),this.m_localAnchorA.Copy(c.m_localAnchorB),this.m_referenceAngleA=c.m_referenceAngle,this.m_localAxisC.Copy(c.m_localXAxisA);var u=this.m_localAnchorC,p=o.b2MulTRV(m.q,o.b2AddVV(o.b2MulRV(a.q,this.m_localAnchorA,o.b2Vec2.s_t0),o.b2SubVV(a.p,m.p,o.b2Vec2.s_t1),o.b2Vec2.s_t0),o.b2Vec2.s_t0);i=o.b2DotVV(o.b2SubVV(p,u,o.b2Vec2.s_t0),this.m_localAxisC)}this.m_bodyD=this.m_joint2.GetBodyA(),this.m_bodyB=this.m_joint2.GetBodyB();var b=this.m_bodyB.m_xf,y=this.m_bodyB.m_sweep.a,d=this.m_bodyD.m_xf,f=this.m_bodyD.m_sweep.a;if(this.m_typeB==r.b2JointType.e_revoluteJoint){var l=e.joint2;this.m_localAnchorD.Copy(l.m_localAnchorA),this.m_localAnchorB.Copy(l.m_localAnchorB),this.m_referenceAngleB=l.m_referenceAngle,this.m_localAxisD.SetZero(),s=y-f-this.m_referenceAngleB}else{var c=e.joint2;this.m_localAnchorD.Copy(c.m_localAnchorA),this.m_localAnchorB.Copy(c.m_localAnchorB),this.m_referenceAngleB=c.m_referenceAngle,this.m_localAxisD.Copy(c.m_localXAxisA);var A=this.m_localAnchorD,v=o.b2MulTRV(d.q,o.b2AddVV(o.b2MulRV(b.q,this.m_localAnchorB,o.b2Vec2.s_t0),o.b2SubVV(b.p,d.p,o.b2Vec2.s_t1),o.b2Vec2.s_t0),o.b2Vec2.s_t0);s=o.b2DotVV(o.b2SubVV(v,A,o.b2Vec2.s_t0),this.m_localAxisD)}this.m_ratio=e.ratio,this.m_constant=i+this.m_ratio*s,this.m_impulse=0}return s(e,t),e.prototype.InitVelocityConstraints=function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_indexC=this.m_bodyC.m_islandIndex,this.m_indexD=this.m_bodyD.m_islandIndex,this.m_lcA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_lcB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_lcC.Copy(this.m_bodyC.m_sweep.localCenter),this.m_lcD.Copy(this.m_bodyD.m_sweep.localCenter),this.m_mA=this.m_bodyA.m_invMass,this.m_mB=this.m_bodyB.m_invMass,this.m_mC=this.m_bodyC.m_invMass,this.m_mD=this.m_bodyD.m_invMass,this.m_iA=this.m_bodyA.m_invI,this.m_iB=this.m_bodyB.m_invI,this.m_iC=this.m_bodyC.m_invI,this.m_iD=this.m_bodyD.m_invI;var i=t.positions[this.m_indexA].a,s=t.velocities[this.m_indexA].v,n=t.velocities[this.m_indexA].w,a=t.positions[this.m_indexB].a,_=t.velocities[this.m_indexB].v,m=t.velocities[this.m_indexB].w,h=t.positions[this.m_indexC].a,l=t.velocities[this.m_indexC].v,c=t.velocities[this.m_indexC].w,u=t.positions[this.m_indexD].a,p=t.velocities[this.m_indexD].v,b=t.velocities[this.m_indexD].w,y=this.m_qA.SetAngleRadians(i),d=this.m_qB.SetAngleRadians(a),f=this.m_qC.SetAngleRadians(h),A=this.m_qD.SetAngleRadians(u);if(this.m_mass=0,this.m_typeA==r.b2JointType.e_revoluteJoint)this.m_JvAC.SetZero(),this.m_JwA=1,this.m_JwC=1,this.m_mass+=this.m_iA+this.m_iC;else{var v=o.b2MulRV(f,this.m_localAxisC,e.InitVelocityConstraints_s_u);o.b2SubVV(this.m_localAnchorC,this.m_lcC,this.m_lalcC);var S=o.b2MulRV(f,this.m_lalcC,e.InitVelocityConstraints_s_rC);o.b2SubVV(this.m_localAnchorA,this.m_lcA,this.m_lalcA);var V=o.b2MulRV(y,this.m_lalcA,e.InitVelocityConstraints_s_rA);this.m_JvAC.Copy(v),this.m_JwC=o.b2CrossVV(S,v),this.m_JwA=o.b2CrossVV(V,v),this.m_mass+=this.m_mC+this.m_mA+this.m_iC*this.m_JwC*this.m_JwC+this.m_iA*this.m_JwA*this.m_JwA}if(this.m_typeB==r.b2JointType.e_revoluteJoint)this.m_JvBD.SetZero(),this.m_JwB=this.m_ratio,this.m_JwD=this.m_ratio,this.m_mass+=this.m_ratio*this.m_ratio*(this.m_iB+this.m_iD);else{var v=o.b2MulRV(A,this.m_localAxisD,e.InitVelocityConstraints_s_u);
o.b2SubVV(this.m_localAnchorD,this.m_lcD,this.m_lalcD);var x=o.b2MulRV(A,this.m_lalcD,e.InitVelocityConstraints_s_rD);o.b2SubVV(this.m_localAnchorB,this.m_lcB,this.m_lalcB);var C=o.b2MulRV(d,this.m_lalcB,e.InitVelocityConstraints_s_rB);o.b2MulSV(this.m_ratio,v,this.m_JvBD),this.m_JwD=this.m_ratio*o.b2CrossVV(x,v),this.m_JwB=this.m_ratio*o.b2CrossVV(C,v),this.m_mass+=this.m_ratio*this.m_ratio*(this.m_mD+this.m_mB)+this.m_iD*this.m_JwD*this.m_JwD+this.m_iB*this.m_JwB*this.m_JwB}this.m_mass=this.m_mass>0?1/this.m_mass:0,t.step.warmStarting?(s.SelfMulAdd(this.m_mA*this.m_impulse,this.m_JvAC),n+=this.m_iA*this.m_impulse*this.m_JwA,_.SelfMulAdd(this.m_mB*this.m_impulse,this.m_JvBD),m+=this.m_iB*this.m_impulse*this.m_JwB,l.SelfMulSub(this.m_mC*this.m_impulse,this.m_JvAC),c-=this.m_iC*this.m_impulse*this.m_JwC,p.SelfMulSub(this.m_mD*this.m_impulse,this.m_JvBD),b-=this.m_iD*this.m_impulse*this.m_JwD):this.m_impulse=0,t.velocities[this.m_indexA].w=n,t.velocities[this.m_indexB].w=m,t.velocities[this.m_indexC].w=c,t.velocities[this.m_indexD].w=b},e.prototype.SolveVelocityConstraints=function(t){var e=t.velocities[this.m_indexA].v,i=t.velocities[this.m_indexA].w,s=t.velocities[this.m_indexB].v,n=t.velocities[this.m_indexB].w,r=t.velocities[this.m_indexC].v,a=t.velocities[this.m_indexC].w,_=t.velocities[this.m_indexD].v,m=t.velocities[this.m_indexD].w,h=o.b2DotVV(this.m_JvAC,o.b2SubVV(e,r,o.b2Vec2.s_t0))+o.b2DotVV(this.m_JvBD,o.b2SubVV(s,_,o.b2Vec2.s_t0));h+=this.m_JwA*i-this.m_JwC*a+(this.m_JwB*n-this.m_JwD*m);var l=-this.m_mass*h;this.m_impulse+=l,e.SelfMulAdd(this.m_mA*l,this.m_JvAC),i+=this.m_iA*l*this.m_JwA,s.SelfMulAdd(this.m_mB*l,this.m_JvBD),n+=this.m_iB*l*this.m_JwB,r.SelfMulSub(this.m_mC*l,this.m_JvAC),a-=this.m_iC*l*this.m_JwC,_.SelfMulSub(this.m_mD*l,this.m_JvBD),m-=this.m_iD*l*this.m_JwD,t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=n,t.velocities[this.m_indexC].w=a,t.velocities[this.m_indexD].w=m},e.prototype.SolvePositionConstraints=function(t){var i,s,a,_,m,h,l=t.positions[this.m_indexA].c,c=t.positions[this.m_indexA].a,u=t.positions[this.m_indexB].c,p=t.positions[this.m_indexB].a,b=t.positions[this.m_indexC].c,y=t.positions[this.m_indexC].a,d=t.positions[this.m_indexD].c,f=t.positions[this.m_indexD].a,A=this.m_qA.SetAngleRadians(c),v=this.m_qB.SetAngleRadians(p),S=this.m_qC.SetAngleRadians(y),V=this.m_qD.SetAngleRadians(f),x=0,C=this.m_JvAC,B=this.m_JvBD,g=0;if(this.m_typeA==r.b2JointType.e_revoluteJoint)C.SetZero(),a=1,m=1,g+=this.m_iA+this.m_iC,i=c-y-this.m_referenceAngleA;else{var w=o.b2MulRV(S,this.m_localAxisC,e.SolvePositionConstraints_s_u),M=o.b2MulRV(S,this.m_lalcC,e.SolvePositionConstraints_s_rC),L=o.b2MulRV(A,this.m_lalcA,e.SolvePositionConstraints_s_rA);C.Copy(w),m=o.b2CrossVV(M,w),a=o.b2CrossVV(L,w),g+=this.m_mC+this.m_mA+this.m_iC*m*m+this.m_iA*a*a;var I=this.m_lalcC,T=o.b2MulTRV(S,o.b2AddVV(L,o.b2SubVV(l,b,o.b2Vec2.s_t0),o.b2Vec2.s_t0),o.b2Vec2.s_t0);i=o.b2DotVV(o.b2SubVV(T,I,o.b2Vec2.s_t0),this.m_localAxisC)}if(this.m_typeB==r.b2JointType.e_revoluteJoint)B.SetZero(),_=this.m_ratio,h=this.m_ratio,g+=this.m_ratio*this.m_ratio*(this.m_iB+this.m_iD),s=p-f-this.m_referenceAngleB;else{var w=o.b2MulRV(V,this.m_localAxisD,e.SolvePositionConstraints_s_u),R=o.b2MulRV(V,this.m_lalcD,e.SolvePositionConstraints_s_rD),E=o.b2MulRV(v,this.m_lalcB,e.SolvePositionConstraints_s_rB);o.b2MulSV(this.m_ratio,w,B),h=this.m_ratio*o.b2CrossVV(R,w),_=this.m_ratio*o.b2CrossVV(E,w),g+=this.m_ratio*this.m_ratio*(this.m_mD+this.m_mB)+this.m_iD*h*h+this.m_iB*_*_;var G=this.m_lalcD,D=o.b2MulTRV(V,o.b2AddVV(E,o.b2SubVV(u,d,o.b2Vec2.s_t0),o.b2Vec2.s_t0),o.b2Vec2.s_t0);s=o.b2DotVV(o.b2SubVV(D,G,o.b2Vec2.s_t0),this.m_localAxisD)}var P=i+this.m_ratio*s-this.m_constant,F=0;return g>0&&(F=-P/g),l.SelfMulAdd(this.m_mA*F,C),c+=this.m_iA*F*a,u.SelfMulAdd(this.m_mB*F,B),p+=this.m_iB*F*_,b.SelfMulSub(this.m_mC*F,C),y-=this.m_iC*F*m,d.SelfMulSub(this.m_mD*F,B),f-=this.m_iD*F*h,t.positions[this.m_indexA].a=c,t.positions[this.m_indexB].a=p,t.positions[this.m_indexC].a=y,t.positions[this.m_indexD].a=f,x<n.b2_linearSlop},e.prototype.GetAnchorA=function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)},e.prototype.GetAnchorB=function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)},e.prototype.GetReactionForce=function(t,e){return o.b2MulSV(t*this.m_impulse,this.m_JvAC,e)},e.prototype.GetReactionTorque=function(t){return t*this.m_impulse*this.m_JwA},e.prototype.GetJoint1=function(){return this.m_joint1},e.prototype.GetJoint2=function(){return this.m_joint2},e.prototype.GetRatio=function(){return this.m_ratio},e.prototype.SetRatio=function(t){n.ENABLE_ASSERTS&&n.b2Assert(o.b2IsValid(t)),this.m_ratio=t},e.prototype.Dump=function(){if(n.DEBUG){var t=this.m_bodyA.m_islandIndex,e=this.m_bodyB.m_islandIndex,i=this.m_joint1.m_index,s=this.m_joint2.m_index;n.b2Log("  var jd: b2GearJointDef = new b2GearJointDef();\n"),n.b2Log("  jd.bodyA = bodies[%d];\n",t),n.b2Log("  jd.bodyB = bodies[%d];\n",e),n.b2Log("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),n.b2Log("  jd.joint1 = joints[%d];\n",i),n.b2Log("  jd.joint2 = joints[%d];\n",s),n.b2Log("  jd.ratio = %.15f;\n",this.m_ratio),n.b2Log("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}},e.InitVelocityConstraints_s_u=new o.b2Vec2,e.InitVelocityConstraints_s_rA=new o.b2Vec2,e.InitVelocityConstraints_s_rB=new o.b2Vec2,e.InitVelocityConstraints_s_rC=new o.b2Vec2,e.InitVelocityConstraints_s_rD=new o.b2Vec2,e.SolvePositionConstraints_s_u=new o.b2Vec2,e.SolvePositionConstraints_s_rA=new o.b2Vec2,e.SolvePositionConstraints_s_rB=new o.b2Vec2,e.SolvePositionConstraints_s_rC=new o.b2Vec2,e.SolvePositionConstraints_s_rD=new o.b2Vec2,e}(r.b2Joint);e.b2GearJoint=_},function(t,e,i){"use strict";var s=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},o=i(4),n=i(3),r=i(23),a=function(t){function e(){t.call(this,r.b2JointType.e_wheelJoint),this.localAnchorA=new o.b2Vec2(0,0),this.localAnchorB=new o.b2Vec2(0,0),this.localAxisA=new o.b2Vec2(1,0),this.enableMotor=!1,this.maxMotorTorque=0,this.motorSpeed=0,this.frequencyHz=2,this.dampingRatio=.7}return s(e,t),e.prototype.Initialize=function(t,e,i,s){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(i,this.localAnchorA),this.bodyB.GetLocalPoint(i,this.localAnchorB),this.bodyA.GetLocalVector(s,this.localAxisA)},e}(r.b2JointDef);e.b2WheelJointDef=a;var _=function(t){function e(e){t.call(this,e),this.m_frequencyHz=0,this.m_dampingRatio=0,this.m_localAnchorA=new o.b2Vec2,this.m_localAnchorB=new o.b2Vec2,this.m_localXAxisA=new o.b2Vec2,this.m_localYAxisA=new o.b2Vec2,this.m_impulse=0,this.m_motorImpulse=0,this.m_springImpulse=0,this.m_maxMotorTorque=0,this.m_motorSpeed=0,this.m_enableMotor=!1,this.m_indexA=0,this.m_indexB=0,this.m_localCenterA=new o.b2Vec2,this.m_localCenterB=new o.b2Vec2,this.m_invMassA=0,this.m_invMassB=0,this.m_invIA=0,this.m_invIB=0,this.m_ax=new o.b2Vec2,this.m_ay=new o.b2Vec2,this.m_sAx=0,this.m_sBx=0,this.m_sAy=0,this.m_sBy=0,this.m_mass=0,this.m_motorMass=0,this.m_springMass=0,this.m_bias=0,this.m_gamma=0,this.m_qA=new o.b2Rot,this.m_qB=new o.b2Rot,this.m_lalcA=new o.b2Vec2,this.m_lalcB=new o.b2Vec2,this.m_rA=new o.b2Vec2,this.m_rB=new o.b2Vec2,this.m_frequencyHz=e.frequencyHz,this.m_dampingRatio=e.dampingRatio,this.m_localAnchorA.Copy(e.localAnchorA),this.m_localAnchorB.Copy(e.localAnchorB),this.m_localXAxisA.Copy(e.localAxisA),o.b2CrossOneV(this.m_localXAxisA,this.m_localYAxisA),this.m_maxMotorTorque=e.maxMotorTorque,this.m_motorSpeed=e.motorSpeed,this.m_enableMotor=e.enableMotor,this.m_ax.SetZero(),this.m_ay.SetZero()}return s(e,t),e.prototype.GetMotorSpeed=function(){return this.m_motorSpeed},e.prototype.GetMaxMotorTorque=function(){return this.m_maxMotorTorque},e.prototype.SetSpringFrequencyHz=function(t){this.m_frequencyHz=t},e.prototype.GetSpringFrequencyHz=function(){return this.m_frequencyHz},e.prototype.SetSpringDampingRatio=function(t){this.m_dampingRatio=t},e.prototype.GetSpringDampingRatio=function(){return this.m_dampingRatio},e.prototype.InitVelocityConstraints=function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var i=this.m_invMassA,s=this.m_invMassB,r=this.m_invIA,a=this.m_invIB,_=t.positions[this.m_indexA].c,m=t.positions[this.m_indexA].a,h=t.velocities[this.m_indexA].v,l=t.velocities[this.m_indexA].w,c=t.positions[this.m_indexB].c,u=t.positions[this.m_indexB].a,p=t.velocities[this.m_indexB].v,b=t.velocities[this.m_indexB].w,y=this.m_qA.SetAngleRadians(m),d=this.m_qB.SetAngleRadians(u);o.b2SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var f=o.b2MulRV(y,this.m_lalcA,this.m_rA);o.b2SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var A=o.b2MulRV(d,this.m_lalcB,this.m_rB),v=o.b2SubVV(o.b2AddVV(c,A,o.b2Vec2.s_t0),o.b2AddVV(_,f,o.b2Vec2.s_t1),e.InitVelocityConstraints_s_d);if(o.b2MulRV(y,this.m_localYAxisA,this.m_ay),this.m_sAy=o.b2CrossVV(o.b2AddVV(v,f,o.b2Vec2.s_t0),this.m_ay),this.m_sBy=o.b2CrossVV(A,this.m_ay),this.m_mass=i+s+r*this.m_sAy*this.m_sAy+a*this.m_sBy*this.m_sBy,this.m_mass>0&&(this.m_mass=1/this.m_mass),this.m_springMass=0,this.m_bias=0,this.m_gamma=0,this.m_frequencyHz>0){o.b2MulRV(y,this.m_localXAxisA,this.m_ax),this.m_sAx=o.b2CrossVV(o.b2AddVV(v,f,o.b2Vec2.s_t0),this.m_ax),this.m_sBx=o.b2CrossVV(A,this.m_ax);var S=i+s+r*this.m_sAx*this.m_sAx+a*this.m_sBx*this.m_sBx;if(S>0){this.m_springMass=1/S;var V=o.b2DotVV(v,this.m_ax),x=2*n.b2_pi*this.m_frequencyHz,C=2*this.m_springMass*this.m_dampingRatio*x,B=this.m_springMass*x*x,g=t.step.dt;this.m_gamma=g*(C+g*B),this.m_gamma>0&&(this.m_gamma=1/this.m_gamma),this.m_bias=V*g*B*this.m_gamma,this.m_springMass=S+this.m_gamma,this.m_springMass>0&&(this.m_springMass=1/this.m_springMass)}}else this.m_springImpulse=0;if(this.m_enableMotor?(this.m_motorMass=r+a,this.m_motorMass>0&&(this.m_motorMass=1/this.m_motorMass)):(this.m_motorMass=0,this.m_motorImpulse=0),t.step.warmStarting){this.m_impulse*=t.step.dtRatio,this.m_springImpulse*=t.step.dtRatio,this.m_motorImpulse*=t.step.dtRatio;var w=o.b2AddVV(o.b2MulSV(this.m_impulse,this.m_ay,o.b2Vec2.s_t0),o.b2MulSV(this.m_springImpulse,this.m_ax,o.b2Vec2.s_t1),e.InitVelocityConstraints_s_P),M=this.m_impulse*this.m_sAy+this.m_springImpulse*this.m_sAx+this.m_motorImpulse,L=this.m_impulse*this.m_sBy+this.m_springImpulse*this.m_sBx+this.m_motorImpulse;h.SelfMulSub(this.m_invMassA,w),l-=this.m_invIA*M,p.SelfMulAdd(this.m_invMassB,w),b+=this.m_invIB*L}else this.m_impulse=0,this.m_springImpulse=0,this.m_motorImpulse=0;t.velocities[this.m_indexA].w=l,t.velocities[this.m_indexB].w=b},e.prototype.SolveVelocityConstraints=function(t){var i=this.m_invMassA,s=this.m_invMassB,n=this.m_invIA,r=this.m_invIB,a=t.velocities[this.m_indexA].v,_=t.velocities[this.m_indexA].w,m=t.velocities[this.m_indexB].v,h=t.velocities[this.m_indexB].w,l=o.b2DotVV(this.m_ax,o.b2SubVV(m,a,o.b2Vec2.s_t0))+this.m_sBx*h-this.m_sAx*_,c=-this.m_springMass*(l+this.m_bias+this.m_gamma*this.m_springImpulse);this.m_springImpulse+=c;var u=o.b2MulSV(c,this.m_ax,e.SolveVelocityConstraints_s_P),p=c*this.m_sAx,b=c*this.m_sBx;a.SelfMulSub(i,u),_-=n*p,m.SelfMulAdd(s,u),h+=r*b;var l=h-_-this.m_motorSpeed,c=-this.m_motorMass*l,y=this.m_motorImpulse,d=t.step.dt*this.m_maxMotorTorque;this.m_motorImpulse=o.b2Clamp(this.m_motorImpulse+c,-d,d),c=this.m_motorImpulse-y,_-=n*c,h+=r*c;var l=o.b2DotVV(this.m_ay,o.b2SubVV(m,a,o.b2Vec2.s_t0))+this.m_sBy*h-this.m_sAy*_,c=-this.m_mass*l;this.m_impulse+=c;var u=o.b2MulSV(c,this.m_ay,e.SolveVelocityConstraints_s_P),p=c*this.m_sAy,b=c*this.m_sBy;a.SelfMulSub(i,u),_-=n*p,m.SelfMulAdd(s,u),h+=r*b,t.velocities[this.m_indexA].w=_,t.velocities[this.m_indexB].w=h},e.prototype.SolvePositionConstraints=function(t){var i=t.positions[this.m_indexA].c,s=t.positions[this.m_indexA].a,r=t.positions[this.m_indexB].c,a=t.positions[this.m_indexB].a,_=this.m_qA.SetAngleRadians(s),m=this.m_qB.SetAngleRadians(a);o.b2SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var h=o.b2MulRV(_,this.m_lalcA,this.m_rA);o.b2SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var l,c=o.b2MulRV(m,this.m_lalcB,this.m_rB),u=o.b2AddVV(o.b2SubVV(r,i,o.b2Vec2.s_t0),o.b2SubVV(c,h,o.b2Vec2.s_t1),e.SolvePositionConstraints_s_d),p=o.b2MulRV(_,this.m_localYAxisA,this.m_ay),b=o.b2CrossVV(o.b2AddVV(u,h,o.b2Vec2.s_t0),p),y=o.b2CrossVV(c,p),d=o.b2DotVV(u,this.m_ay),f=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_sAy*this.m_sAy+this.m_invIB*this.m_sBy*this.m_sBy;l=0!=f?-d/f:0;var A=o.b2MulSV(l,p,e.SolvePositionConstraints_s_P),v=l*b,S=l*y;return i.SelfMulSub(this.m_invMassA,A),s-=this.m_invIA*v,r.SelfMulAdd(this.m_invMassB,A),a+=this.m_invIB*S,t.positions[this.m_indexA].a=s,t.positions[this.m_indexB].a=a,o.b2Abs(d)<=n.b2_linearSlop},e.prototype.GetDefinition=function(t){return n.ENABLE_ASSERTS&&n.b2Assert(!1),t},e.prototype.GetAnchorA=function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)},e.prototype.GetAnchorB=function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)},e.prototype.GetReactionForce=function(t,e){return e.x=t*(this.m_impulse*this.m_ay.x+this.m_springImpulse*this.m_ax.x),e.y=t*(this.m_impulse*this.m_ay.y+this.m_springImpulse*this.m_ax.y),e},e.prototype.GetReactionTorque=function(t){return t*this.m_motorImpulse},e.prototype.GetLocalAnchorA=function(){return this.m_localAnchorA},e.prototype.GetLocalAnchorB=function(){return this.m_localAnchorB},e.prototype.GetLocalAxisA=function(){return this.m_localXAxisA},e.prototype.GetJointTranslation=function(){var t=this.m_bodyA,e=this.m_bodyB,i=t.GetWorldPoint(this.m_localAnchorA,new o.b2Vec2),s=e.GetWorldPoint(this.m_localAnchorB,new o.b2Vec2),n=o.b2SubVV(s,i,new o.b2Vec2),r=t.GetWorldVector(this.m_localXAxisA,new o.b2Vec2),a=o.b2DotVV(n,r);return a},e.prototype.GetJointSpeed=function(){var t=this.m_bodyA.m_angularVelocity,e=this.m_bodyB.m_angularVelocity;return e-t},e.prototype.IsMotorEnabled=function(){return this.m_enableMotor},e.prototype.EnableMotor=function(t){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=t},e.prototype.SetMotorSpeed=function(t){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=t},e.prototype.SetMaxMotorTorque=function(t){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorTorque=t},e.prototype.GetMotorTorque=function(t){return t*this.m_motorImpulse},e.prototype.Dump=function(){if(n.DEBUG){var t=this.m_bodyA.m_islandIndex,e=this.m_bodyB.m_islandIndex;n.b2Log("  var jd: b2WheelJointDef = new b2WheelJointDef();\n"),n.b2Log("  jd.bodyA = bodies[%d];\n",t),n.b2Log("  jd.bodyB = bodies[%d];\n",e),n.b2Log("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),n.b2Log("  jd.localAnchorA.SetXY(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),n.b2Log("  jd.localAnchorB.SetXY(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),n.b2Log("  jd.localAxisA.Set(%.15f, %.15f);\n",this.m_localXAxisA.x,this.m_localXAxisA.y),n.b2Log("  jd.enableMotor = %s;\n",this.m_enableMotor?"true":"false"),n.b2Log("  jd.motorSpeed = %.15f;\n",this.m_motorSpeed),n.b2Log("  jd.maxMotorTorque = %.15f;\n",this.m_maxMotorTorque),n.b2Log("  jd.frequencyHz = %.15f;\n",this.m_frequencyHz),n.b2Log("  jd.dampingRatio = %.15f;\n",this.m_dampingRatio),n.b2Log("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}},e.InitVelocityConstraints_s_d=new o.b2Vec2,e.InitVelocityConstraints_s_P=new o.b2Vec2,e.SolveVelocityConstraints_s_P=new o.b2Vec2,e.SolvePositionConstraints_s_d=new o.b2Vec2,e.SolvePositionConstraints_s_P=new o.b2Vec2,e}(r.b2Joint);e.b2WheelJoint=_},function(t,e,i){"use strict";var s=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},o=i(4),n=i(3),r=i(23),a=function(t){function e(){t.call(this,r.b2JointType.e_weldJoint),this.localAnchorA=new o.b2Vec2,this.localAnchorB=new o.b2Vec2,this.referenceAngle=0,this.frequencyHz=0,this.dampingRatio=0}return s(e,t),e.prototype.Initialize=function(t,e,i){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(i,this.localAnchorA),this.bodyB.GetLocalPoint(i,this.localAnchorB),this.referenceAngle=this.bodyB.GetAngleRadians()-this.bodyA.GetAngleRadians()},e}(r.b2JointDef);e.b2WeldJointDef=a;var _=function(t){function e(e){t.call(this,e),this.m_frequencyHz=0,this.m_dampingRatio=0,this.m_bias=0,this.m_localAnchorA=new o.b2Vec2,this.m_localAnchorB=new o.b2Vec2,this.m_referenceAngle=0,this.m_gamma=0,this.m_impulse=new o.b2Vec3(0,0,0),this.m_indexA=0,this.m_indexB=0,this.m_rA=new o.b2Vec2,this.m_rB=new o.b2Vec2,this.m_localCenterA=new o.b2Vec2,this.m_localCenterB=new o.b2Vec2,this.m_invMassA=0,this.m_invMassB=0,this.m_invIA=0,this.m_invIB=0,this.m_mass=new o.b2Mat33,this.m_qA=new o.b2Rot,this.m_qB=new o.b2Rot,this.m_lalcA=new o.b2Vec2,this.m_lalcB=new o.b2Vec2,this.m_K=new o.b2Mat33,this.m_frequencyHz=e.frequencyHz,this.m_dampingRatio=e.dampingRatio,this.m_localAnchorA.Copy(e.localAnchorA),this.m_localAnchorB.Copy(e.localAnchorB),this.m_referenceAngle=e.referenceAngle,this.m_impulse.SetZero()}return s(e,t),e.prototype.InitVelocityConstraints=function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var i=t.positions[this.m_indexA].a,s=t.velocities[this.m_indexA].v,r=t.velocities[this.m_indexA].w,a=t.positions[this.m_indexB].a,_=t.velocities[this.m_indexB].v,m=t.velocities[this.m_indexB].w,h=this.m_qA.SetAngleRadians(i),l=this.m_qB.SetAngleRadians(a);o.b2SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),o.b2MulRV(h,this.m_lalcA,this.m_rA),o.b2SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),o.b2MulRV(l,this.m_lalcB,this.m_rB);var c=this.m_invMassA,u=this.m_invMassB,p=this.m_invIA,b=this.m_invIB,y=this.m_K;if(y.ex.x=c+u+this.m_rA.y*this.m_rA.y*p+this.m_rB.y*this.m_rB.y*b,y.ey.x=-this.m_rA.y*this.m_rA.x*p-this.m_rB.y*this.m_rB.x*b,y.ez.x=-this.m_rA.y*p-this.m_rB.y*b,y.ex.y=y.ey.x,y.ey.y=c+u+this.m_rA.x*this.m_rA.x*p+this.m_rB.x*this.m_rB.x*b,y.ez.y=this.m_rA.x*p+this.m_rB.x*b,y.ex.z=y.ez.x,y.ey.z=y.ez.y,y.ez.z=p+b,this.m_frequencyHz>0){y.GetInverse22(this.m_mass);var d=p+b,f=d>0?1/d:0,A=a-i-this.m_referenceAngle,v=2*n.b2_pi*this.m_frequencyHz,S=2*f*this.m_dampingRatio*v,V=f*v*v,x=t.step.dt;this.m_gamma=x*(S+x*V),this.m_gamma=0!=this.m_gamma?1/this.m_gamma:0,this.m_bias=A*x*V*this.m_gamma,d+=this.m_gamma,this.m_mass.ez.z=0!=d?1/d:0}else y.GetSymInverse33(this.m_mass),this.m_gamma=0,this.m_bias=0;if(t.step.warmStarting){this.m_impulse.SelfMul(t.step.dtRatio);var C=e.InitVelocityConstraints_s_P.SetXY(this.m_impulse.x,this.m_impulse.y);s.SelfMulSub(c,C),r-=p*(o.b2CrossVV(this.m_rA,C)+this.m_impulse.z),_.SelfMulAdd(u,C),m+=b*(o.b2CrossVV(this.m_rB,C)+this.m_impulse.z)}else this.m_impulse.SetZero();t.velocities[this.m_indexA].w=r,t.velocities[this.m_indexB].w=m},e.prototype.SolveVelocityConstraints=function(t){var i=t.velocities[this.m_indexA].v,s=t.velocities[this.m_indexA].w,n=t.velocities[this.m_indexB].v,r=t.velocities[this.m_indexB].w,a=this.m_invMassA,_=this.m_invMassB,m=this.m_invIA,h=this.m_invIB;if(this.m_frequencyHz>0){var l=r-s,c=-this.m_mass.ez.z*(l+this.m_bias+this.m_gamma*this.m_impulse.z);this.m_impulse.z+=c,s-=m*c,r+=h*c;var u=o.b2SubVV(o.b2AddVCrossSV(n,r,this.m_rB,o.b2Vec2.s_t0),o.b2AddVCrossSV(i,s,this.m_rA,o.b2Vec2.s_t1),e.SolveVelocityConstraints_s_Cdot1),p=o.b2MulM33XY(this.m_mass,u.x,u.y,e.SolveVelocityConstraints_s_impulse1).SelfNeg();this.m_impulse.x+=p.x,this.m_impulse.y+=p.y;var b=p;i.SelfMulSub(a,b),s-=m*o.b2CrossVV(this.m_rA,b),n.SelfMulAdd(_,b),r+=h*o.b2CrossVV(this.m_rB,b)}else{var u=o.b2SubVV(o.b2AddVCrossSV(n,r,this.m_rB,o.b2Vec2.s_t0),o.b2AddVCrossSV(i,s,this.m_rA,o.b2Vec2.s_t1),e.SolveVelocityConstraints_s_Cdot1),l=r-s,y=o.b2MulM33XYZ(this.m_mass,u.x,u.y,l,e.SolveVelocityConstraints_s_impulse).SelfNeg();this.m_impulse.SelfAdd(y);var b=e.SolveVelocityConstraints_s_P.SetXY(y.x,y.y);i.SelfMulSub(a,b),s-=m*(o.b2CrossVV(this.m_rA,b)+y.z),n.SelfMulAdd(_,b),r+=h*(o.b2CrossVV(this.m_rB,b)+y.z)}t.velocities[this.m_indexA].w=s,t.velocities[this.m_indexB].w=r},e.prototype.SolvePositionConstraints=function(t){var i=t.positions[this.m_indexA].c,s=t.positions[this.m_indexA].a,r=t.positions[this.m_indexB].c,a=t.positions[this.m_indexB].a,_=this.m_qA.SetAngleRadians(s),m=this.m_qB.SetAngleRadians(a),h=this.m_invMassA,l=this.m_invMassB,c=this.m_invIA,u=this.m_invIB;o.b2SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var p=o.b2MulRV(_,this.m_lalcA,this.m_rA);o.b2SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var b,y,d=o.b2MulRV(m,this.m_lalcB,this.m_rB),f=this.m_K;if(f.ex.x=h+l+p.y*p.y*c+d.y*d.y*u,f.ey.x=-p.y*p.x*c-d.y*d.x*u,f.ez.x=-p.y*c-d.y*u,f.ex.y=f.ey.x,f.ey.y=h+l+p.x*p.x*c+d.x*d.x*u,f.ez.y=p.x*c+d.x*u,f.ex.z=f.ez.x,f.ey.z=f.ez.y,f.ez.z=c+u,this.m_frequencyHz>0){var A=o.b2SubVV(o.b2AddVV(r,d,o.b2Vec2.s_t0),o.b2AddVV(i,p,o.b2Vec2.s_t1),e.SolvePositionConstraints_s_C1);b=A.GetLength(),y=0;var v=f.Solve22(A.x,A.y,e.SolvePositionConstraints_s_P).SelfNeg();i.SelfMulSub(h,v),s-=c*o.b2CrossVV(p,v),r.SelfMulAdd(l,v),a+=u*o.b2CrossVV(d,v)}else{var A=o.b2SubVV(o.b2AddVV(r,d,o.b2Vec2.s_t0),o.b2AddVV(i,p,o.b2Vec2.s_t1),e.SolvePositionConstraints_s_C1),S=a-s-this.m_referenceAngle;b=A.GetLength(),y=o.b2Abs(S);var V=f.Solve33(A.x,A.y,S,e.SolvePositionConstraints_s_impulse).SelfNeg(),v=e.SolvePositionConstraints_s_P.SetXY(V.x,V.y);i.SelfMulSub(h,v),s-=c*(o.b2CrossVV(this.m_rA,v)+V.z),r.SelfMulAdd(l,v),a+=u*(o.b2CrossVV(this.m_rB,v)+V.z)}return t.positions[this.m_indexA].a=s,t.positions[this.m_indexB].a=a,b<=n.b2_linearSlop&&y<=n.b2_angularSlop},e.prototype.GetAnchorA=function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)},e.prototype.GetAnchorB=function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)},e.prototype.GetReactionForce=function(t,e){return e.SetXY(t*this.m_impulse.x,t*this.m_impulse.y)},e.prototype.GetReactionTorque=function(t){return t*this.m_impulse.z},e.prototype.GetLocalAnchorA=function(){return this.m_localAnchorA},e.prototype.GetLocalAnchorB=function(){return this.m_localAnchorB},e.prototype.GetReferenceAngle=function(){return this.m_referenceAngle},e.prototype.SetFrequency=function(t){this.m_frequencyHz=t},e.prototype.GetFrequency=function(){return this.m_frequencyHz},e.prototype.SetDampingRatio=function(t){this.m_dampingRatio=t},e.prototype.GetDampingRatio=function(){return this.m_dampingRatio},e.prototype.Dump=function(){if(n.DEBUG){var t=this.m_bodyA.m_islandIndex,e=this.m_bodyB.m_islandIndex;n.b2Log("  var jd: b2WeldJointDef = new b2WeldJointDef();\n"),n.b2Log("  jd.bodyA = bodies[%d];\n",t),n.b2Log("  jd.bodyB = bodies[%d];\n",e),n.b2Log("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),n.b2Log("  jd.localAnchorA.SetXY(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),n.b2Log("  jd.localAnchorB.SetXY(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),n.b2Log("  jd.referenceAngle = %.15f;\n",this.m_referenceAngle),n.b2Log("  jd.frequencyHz = %.15f;\n",this.m_frequencyHz),n.b2Log("  jd.dampingRatio = %.15f;\n",this.m_dampingRatio),n.b2Log("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}},e.InitVelocityConstraints_s_P=new o.b2Vec2,e.SolveVelocityConstraints_s_Cdot1=new o.b2Vec2,e.SolveVelocityConstraints_s_impulse1=new o.b2Vec2,e.SolveVelocityConstraints_s_impulse=new o.b2Vec3,e.SolveVelocityConstraints_s_P=new o.b2Vec2,e.SolvePositionConstraints_s_C1=new o.b2Vec2,e.SolvePositionConstraints_s_P=new o.b2Vec2,e.SolvePositionConstraints_s_impulse=new o.b2Vec3,e}(r.b2Joint);e.b2WeldJoint=_},function(t,e,i){"use strict";var s=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},o=i(4),n=i(3),r=i(23),a=function(t){function e(){t.call(this,r.b2JointType.e_frictionJoint),this.localAnchorA=new o.b2Vec2,this.localAnchorB=new o.b2Vec2,this.maxForce=0,this.maxTorque=0}return s(e,t),e.prototype.Initialize=function(t,e,i){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(i,this.localAnchorA),this.bodyB.GetLocalPoint(i,this.localAnchorB)},e}(r.b2JointDef);e.b2FrictionJointDef=a;var _=function(t){function e(e){t.call(this,e),this.m_localAnchorA=new o.b2Vec2,this.m_localAnchorB=new o.b2Vec2,this.m_linearImpulse=new o.b2Vec2,this.m_angularImpulse=0,this.m_maxForce=0,this.m_maxTorque=0,this.m_indexA=0,this.m_indexB=0,this.m_rA=new o.b2Vec2,this.m_rB=new o.b2Vec2,this.m_localCenterA=new o.b2Vec2,this.m_localCenterB=new o.b2Vec2,this.m_invMassA=0,this.m_invMassB=0,this.m_invIA=0,this.m_invIB=0,this.m_linearMass=new o.b2Mat22,this.m_angularMass=0,this.m_qA=new o.b2Rot,this.m_qB=new o.b2Rot,this.m_lalcA=new o.b2Vec2,this.m_lalcB=new o.b2Vec2,this.m_K=new o.b2Mat22,this.m_localAnchorA.Copy(e.localAnchorA),this.m_localAnchorB.Copy(e.localAnchorB),this.m_linearImpulse.SetZero(),this.m_maxForce=e.maxForce,this.m_maxTorque=e.maxTorque,this.m_linearMass.SetZero()}return s(e,t),e.prototype.InitVelocityConstraints=function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=t.positions[this.m_indexA].a,i=t.velocities[this.m_indexA].v,s=t.velocities[this.m_indexA].w,n=t.positions[this.m_indexB].a,r=t.velocities[this.m_indexB].v,a=t.velocities[this.m_indexB].w,_=this.m_qA.SetAngleRadians(e),m=this.m_qB.SetAngleRadians(n);o.b2SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var h=o.b2MulRV(_,this.m_lalcA,this.m_rA);o.b2SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var l=o.b2MulRV(m,this.m_lalcB,this.m_rB),c=this.m_invMassA,u=this.m_invMassB,p=this.m_invIA,b=this.m_invIB,y=this.m_K;if(y.ex.x=c+u+p*h.y*h.y+b*l.y*l.y,y.ex.y=-p*h.x*h.y-b*l.x*l.y,y.ey.x=y.ex.y,y.ey.y=c+u+p*h.x*h.x+b*l.x*l.x,y.GetInverse(this.m_linearMass),this.m_angularMass=p+b,this.m_angularMass>0&&(this.m_angularMass=1/this.m_angularMass),t.step.warmStarting){this.m_linearImpulse.SelfMul(t.step.dtRatio),this.m_angularImpulse*=t.step.dtRatio;var d=this.m_linearImpulse;i.SelfMulSub(c,d),s-=p*(o.b2CrossVV(this.m_rA,d)+this.m_angularImpulse),r.SelfMulAdd(u,d),a+=b*(o.b2CrossVV(this.m_rB,d)+this.m_angularImpulse)}else this.m_linearImpulse.SetZero(),this.m_angularImpulse=0;t.velocities[this.m_indexA].w=s,t.velocities[this.m_indexB].w=a},e.prototype.SolveVelocityConstraints=function(t){var i=t.velocities[this.m_indexA].v,s=t.velocities[this.m_indexA].w,n=t.velocities[this.m_indexB].v,r=t.velocities[this.m_indexB].w,a=this.m_invMassA,_=this.m_invMassB,m=this.m_invIA,h=this.m_invIB,l=t.step.dt,c=r-s,u=-this.m_angularMass*c,p=this.m_angularImpulse,b=l*this.m_maxTorque;this.m_angularImpulse=o.b2Clamp(this.m_angularImpulse+u,-b,b),u=this.m_angularImpulse-p,s-=m*u,r+=h*u;var y=o.b2SubVV(o.b2AddVCrossSV(n,r,this.m_rB,o.b2Vec2.s_t0),o.b2AddVCrossSV(i,s,this.m_rA,o.b2Vec2.s_t1),e.SolveVelocityConstraints_s_Cdot_v2),d=o.b2MulMV(this.m_linearMass,y,e.SolveVelocityConstraints_s_impulseV).SelfNeg(),f=e.SolveVelocityConstraints_s_oldImpulseV.Copy(this.m_linearImpulse);this.m_linearImpulse.SelfAdd(d);var b=l*this.m_maxForce;this.m_linearImpulse.GetLengthSquared()>b*b&&(this.m_linearImpulse.Normalize(),this.m_linearImpulse.SelfMul(b)),o.b2SubVV(this.m_linearImpulse,f,d),i.SelfMulSub(a,d),s-=m*o.b2CrossVV(this.m_rA,d),n.SelfMulAdd(_,d),r+=h*o.b2CrossVV(this.m_rB,d),t.velocities[this.m_indexA].w=s,t.velocities[this.m_indexB].w=r},e.prototype.SolvePositionConstraints=function(t){return!0},e.prototype.GetAnchorA=function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)},e.prototype.GetAnchorB=function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)},e.prototype.GetReactionForce=function(t,e){return e.SetXY(t*this.m_linearImpulse.x,t*this.m_linearImpulse.y)},e.prototype.GetReactionTorque=function(t){return t*this.m_angularImpulse},e.prototype.GetLocalAnchorA=function(){return this.m_localAnchorA},e.prototype.GetLocalAnchorB=function(){return this.m_localAnchorB},e.prototype.SetMaxForce=function(t){this.m_maxForce=t},e.prototype.GetMaxForce=function(){return this.m_maxForce},e.prototype.SetMaxTorque=function(t){this.m_maxTorque=t},e.prototype.GetMaxTorque=function(){return this.m_maxTorque},e.prototype.Dump=function(){if(n.DEBUG){var t=this.m_bodyA.m_islandIndex,e=this.m_bodyB.m_islandIndex;n.b2Log("  var jd: b2FrictionJointDef = new b2FrictionJointDef();\n"),n.b2Log("  jd.bodyA = bodies[%d];\n",t),n.b2Log("  jd.bodyB = bodies[%d];\n",e),n.b2Log("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),n.b2Log("  jd.localAnchorA.SetXY(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),n.b2Log("  jd.localAnchorB.SetXY(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),n.b2Log("  jd.maxForce = %.15f;\n",this.m_maxForce),n.b2Log("  jd.maxTorque = %.15f;\n",this.m_maxTorque),n.b2Log("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}},e.SolveVelocityConstraints_s_Cdot_v2=new o.b2Vec2,e.SolveVelocityConstraints_s_impulseV=new o.b2Vec2,e.SolveVelocityConstraints_s_oldImpulseV=new o.b2Vec2,e}(r.b2Joint);e.b2FrictionJoint=_},function(t,e,i){"use strict";var s=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},o=i(4),n=i(3),r=i(23),a=function(t){function e(){t.call(this,r.b2JointType.e_ropeJoint),this.localAnchorA=new o.b2Vec2((-1),0),this.localAnchorB=new o.b2Vec2(1,0),this.maxLength=0}return s(e,t),e}(r.b2JointDef);e.b2RopeJointDef=a;var _=function(t){function e(e){t.call(this,e),this.m_localAnchorA=new o.b2Vec2,this.m_localAnchorB=new o.b2Vec2,this.m_maxLength=0,this.m_length=0,this.m_impulse=0,this.m_indexA=0,this.m_indexB=0,this.m_u=new o.b2Vec2,this.m_rA=new o.b2Vec2,this.m_rB=new o.b2Vec2,this.m_localCenterA=new o.b2Vec2,this.m_localCenterB=new o.b2Vec2,this.m_invMassA=0,this.m_invMassB=0,this.m_invIA=0,this.m_invIB=0,this.m_mass=0,this.m_state=r.b2LimitState.e_inactiveLimit,this.m_qA=new o.b2Rot,this.m_qB=new o.b2Rot,this.m_lalcA=new o.b2Vec2,this.m_lalcB=new o.b2Vec2,this.m_localAnchorA=e.localAnchorA.Clone(),this.m_localAnchorB=e.localAnchorB.Clone(),this.m_maxLength=e.maxLength}return s(e,t),e.prototype.InitVelocityConstraints=function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var i=t.positions[this.m_indexA].c,s=t.positions[this.m_indexA].a,a=t.velocities[this.m_indexA].v,_=t.velocities[this.m_indexA].w,m=t.positions[this.m_indexB].c,h=t.positions[this.m_indexB].a,l=t.velocities[this.m_indexB].v,c=t.velocities[this.m_indexB].w,u=this.m_qA.SetAngleRadians(s),p=this.m_qB.SetAngleRadians(h);o.b2SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),o.b2MulRV(u,this.m_lalcA,this.m_rA),o.b2SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),
o.b2MulRV(p,this.m_lalcB,this.m_rB),this.m_u.Copy(m).SelfAdd(this.m_rB).SelfSub(i).SelfSub(this.m_rA),this.m_length=this.m_u.GetLength();var b=this.m_length-this.m_maxLength;if(b>0?this.m_state=r.b2LimitState.e_atUpperLimit:this.m_state=r.b2LimitState.e_inactiveLimit,!(this.m_length>n.b2_linearSlop))return this.m_u.SetZero(),this.m_mass=0,void(this.m_impulse=0);this.m_u.SelfMul(1/this.m_length);var y=o.b2CrossVV(this.m_rA,this.m_u),d=o.b2CrossVV(this.m_rB,this.m_u),f=this.m_invMassA+this.m_invIA*y*y+this.m_invMassB+this.m_invIB*d*d;if(this.m_mass=0!=f?1/f:0,t.step.warmStarting){this.m_impulse*=t.step.dtRatio;var A=o.b2MulSV(this.m_impulse,this.m_u,e.InitVelocityConstraints_s_P);a.SelfMulSub(this.m_invMassA,A),_-=this.m_invIA*o.b2CrossVV(this.m_rA,A),l.SelfMulAdd(this.m_invMassB,A),c+=this.m_invIB*o.b2CrossVV(this.m_rB,A)}else this.m_impulse=0;t.velocities[this.m_indexA].w=_,t.velocities[this.m_indexB].w=c},e.prototype.SolveVelocityConstraints=function(t){var i=t.velocities[this.m_indexA].v,s=t.velocities[this.m_indexA].w,n=t.velocities[this.m_indexB].v,r=t.velocities[this.m_indexB].w,a=o.b2AddVCrossSV(i,s,this.m_rA,e.SolveVelocityConstraints_s_vpA),_=o.b2AddVCrossSV(n,r,this.m_rB,e.SolveVelocityConstraints_s_vpB),m=this.m_length-this.m_maxLength,h=o.b2DotVV(this.m_u,o.b2SubVV(_,a,o.b2Vec2.s_t0));m<0&&(h+=t.step.inv_dt*m);var l=-this.m_mass*h,c=this.m_impulse;this.m_impulse=o.b2Min(0,this.m_impulse+l),l=this.m_impulse-c;var u=o.b2MulSV(l,this.m_u,e.SolveVelocityConstraints_s_P);i.SelfMulSub(this.m_invMassA,u),s-=this.m_invIA*o.b2CrossVV(this.m_rA,u),n.SelfMulAdd(this.m_invMassB,u),r+=this.m_invIB*o.b2CrossVV(this.m_rB,u),t.velocities[this.m_indexA].w=s,t.velocities[this.m_indexB].w=r},e.prototype.SolvePositionConstraints=function(t){var i=t.positions[this.m_indexA].c,s=t.positions[this.m_indexA].a,r=t.positions[this.m_indexB].c,a=t.positions[this.m_indexB].a,_=this.m_qA.SetAngleRadians(s),m=this.m_qB.SetAngleRadians(a);o.b2SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var h=o.b2MulRV(_,this.m_lalcA,this.m_rA);o.b2SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var l=o.b2MulRV(m,this.m_lalcB,this.m_rB),c=this.m_u.Copy(r).SelfAdd(l).SelfSub(i).SelfSub(h),u=c.Normalize(),p=u-this.m_maxLength;p=o.b2Clamp(p,0,n.b2_maxLinearCorrection);var b=-this.m_mass*p,y=o.b2MulSV(b,c,e.SolvePositionConstraints_s_P);return i.SelfMulSub(this.m_invMassA,y),s-=this.m_invIA*o.b2CrossVV(h,y),r.SelfMulAdd(this.m_invMassB,y),a+=this.m_invIB*o.b2CrossVV(l,y),t.positions[this.m_indexA].a=s,t.positions[this.m_indexB].a=a,u-this.m_maxLength<n.b2_linearSlop},e.prototype.GetAnchorA=function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)},e.prototype.GetAnchorB=function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)},e.prototype.GetReactionForce=function(t,e){var i=o.b2MulSV(t*this.m_impulse,this.m_u,e);return i},e.prototype.GetReactionTorque=function(t){return 0},e.prototype.GetLocalAnchorA=function(){return this.m_localAnchorA},e.prototype.GetLocalAnchorB=function(){return this.m_localAnchorB},e.prototype.SetMaxLength=function(t){this.m_maxLength=t},e.prototype.GetMaxLength=function(){return this.m_maxLength},e.prototype.GetLimitState=function(){return this.m_state},e.prototype.Dump=function(){if(n.DEBUG){var t=this.m_bodyA.m_islandIndex,e=this.m_bodyB.m_islandIndex;n.b2Log("  var jd: b2RopeJointDef = new b2RopeJointDef();\n"),n.b2Log("  jd.bodyA = bodies[%d];\n",t),n.b2Log("  jd.bodyB = bodies[%d];\n",e),n.b2Log("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),n.b2Log("  jd.localAnchorA.SetXY(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),n.b2Log("  jd.localAnchorB.SetXY(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),n.b2Log("  jd.maxLength = %.15f;\n",this.m_maxLength),n.b2Log("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}},e.InitVelocityConstraints_s_P=new o.b2Vec2,e.SolveVelocityConstraints_s_vpA=new o.b2Vec2,e.SolveVelocityConstraints_s_vpB=new o.b2Vec2,e.SolveVelocityConstraints_s_P=new o.b2Vec2,e.SolvePositionConstraints_s_P=new o.b2Vec2,e}(r.b2Joint);e.b2RopeJoint=_},function(t,e,i){"use strict";var s=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},o=i(4),n=i(3),r=i(23),a=function(t){function e(){t.call(this,r.b2JointType.e_motorJoint),this.linearOffset=new o.b2Vec2(0,0),this.angularOffset=0,this.maxForce=1,this.maxTorque=1,this.correctionFactor=.3}return s(e,t),e.prototype.Initialize=function(t,e){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(this.bodyB.GetPosition(),this.linearOffset);var i=this.bodyA.GetAngleRadians(),s=this.bodyB.GetAngleRadians();this.angularOffset=s-i},e}(r.b2JointDef);e.b2MotorJointDef=a;var _=function(t){function e(e){t.call(this,e),this.m_linearOffset=new o.b2Vec2,this.m_angularOffset=0,this.m_linearImpulse=new o.b2Vec2,this.m_angularImpulse=0,this.m_maxForce=0,this.m_maxTorque=0,this.m_correctionFactor=.3,this.m_indexA=0,this.m_indexB=0,this.m_rA=new o.b2Vec2,this.m_rB=new o.b2Vec2,this.m_localCenterA=new o.b2Vec2,this.m_localCenterB=new o.b2Vec2,this.m_linearError=new o.b2Vec2,this.m_angularError=0,this.m_invMassA=0,this.m_invMassB=0,this.m_invIA=0,this.m_invIB=0,this.m_linearMass=new o.b2Mat22,this.m_angularMass=0,this.m_qA=new o.b2Rot,this.m_qB=new o.b2Rot,this.m_K=new o.b2Mat22,this.m_linearOffset.Copy(e.linearOffset),this.m_linearImpulse.SetZero(),this.m_maxForce=e.maxForce,this.m_maxTorque=e.maxTorque,this.m_correctionFactor=e.correctionFactor}return s(e,t),e.prototype.GetAnchorA=function(){return this.m_bodyA.GetPosition()},e.prototype.GetAnchorB=function(){return this.m_bodyB.GetPosition()},e.prototype.GetReactionForce=function(t,e){return o.b2MulSV(t,this.m_linearImpulse,e)},e.prototype.GetReactionTorque=function(t){return t*this.m_angularImpulse},e.prototype.SetLinearOffset=function(t){o.b2IsEqualToV(t,this.m_linearOffset)||(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_linearOffset.Copy(t))},e.prototype.GetLinearOffset=function(){return this.m_linearOffset},e.prototype.SetAngularOffset=function(t){t!=this.m_angularOffset&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_angularOffset=t)},e.prototype.GetAngularOffset=function(){return this.m_angularOffset},e.prototype.SetMaxForce=function(t){n.ENABLE_ASSERTS&&n.b2Assert(o.b2IsValid(t)&&t>=0),this.m_maxForce=t},e.prototype.GetMaxForce=function(){return this.m_maxForce},e.prototype.SetMaxTorque=function(t){n.ENABLE_ASSERTS&&n.b2Assert(o.b2IsValid(t)&&t>=0),this.m_maxTorque=t},e.prototype.GetMaxTorque=function(){return this.m_maxTorque},e.prototype.InitVelocityConstraints=function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=t.positions[this.m_indexA].c,i=t.positions[this.m_indexA].a,s=t.velocities[this.m_indexA].v,n=t.velocities[this.m_indexA].w,r=t.positions[this.m_indexB].c,a=t.positions[this.m_indexB].a,_=t.velocities[this.m_indexB].v,m=t.velocities[this.m_indexB].w,h=this.m_qA.SetAngleRadians(i),l=this.m_qB.SetAngleRadians(a),c=o.b2MulRV(h,o.b2NegV(this.m_localCenterA,o.b2Vec2.s_t0),this.m_rA),u=o.b2MulRV(l,o.b2NegV(this.m_localCenterB,o.b2Vec2.s_t0),this.m_rB),p=this.m_invMassA,b=this.m_invMassB,y=this.m_invIA,d=this.m_invIB,f=this.m_K;if(f.ex.x=p+b+y*c.y*c.y+d*u.y*u.y,f.ex.y=-y*c.x*c.y-d*u.x*u.y,f.ey.x=f.ex.y,f.ey.y=p+b+y*c.x*c.x+d*u.x*u.x,f.GetInverse(this.m_linearMass),this.m_angularMass=y+d,this.m_angularMass>0&&(this.m_angularMass=1/this.m_angularMass),o.b2SubVV(o.b2SubVV(o.b2AddVV(r,u,o.b2Vec2.s_t0),o.b2AddVV(e,c,o.b2Vec2.s_t1),o.b2Vec2.s_t2),o.b2MulRV(h,this.m_linearOffset,o.b2Vec2.s_t3),this.m_linearError),this.m_angularError=a-i-this.m_angularOffset,t.step.warmStarting){this.m_linearImpulse.SelfMul(t.step.dtRatio),this.m_angularImpulse*=t.step.dtRatio;var A=this.m_linearImpulse;s.SelfMulSub(p,A),n-=y*(o.b2CrossVV(c,A)+this.m_angularImpulse),_.SelfMulAdd(b,A),m+=d*(o.b2CrossVV(u,A)+this.m_angularImpulse)}else this.m_linearImpulse.SetZero(),this.m_angularImpulse=0;t.velocities[this.m_indexA].w=n,t.velocities[this.m_indexB].w=m},e.prototype.SolveVelocityConstraints=function(t){var i=t.velocities[this.m_indexA].v,s=t.velocities[this.m_indexA].w,n=t.velocities[this.m_indexB].v,r=t.velocities[this.m_indexB].w,a=this.m_invMassA,_=this.m_invMassB,m=this.m_invIA,h=this.m_invIB,l=t.step.dt,c=t.step.inv_dt,u=r-s+c*this.m_correctionFactor*this.m_angularError,p=-this.m_angularMass*u,b=this.m_angularImpulse,y=l*this.m_maxTorque;this.m_angularImpulse=o.b2Clamp(this.m_angularImpulse+p,-y,y),p=this.m_angularImpulse-b,s-=m*p,r+=h*p;var d=this.m_rA,f=this.m_rB,A=o.b2AddVV(o.b2SubVV(o.b2AddVV(n,o.b2CrossSV(r,f,o.b2Vec2.s_t0),o.b2Vec2.s_t0),o.b2AddVV(i,o.b2CrossSV(s,d,o.b2Vec2.s_t1),o.b2Vec2.s_t1),o.b2Vec2.s_t2),o.b2MulSV(c*this.m_correctionFactor,this.m_linearError,o.b2Vec2.s_t3),e.SolveVelocityConstraints_s_Cdot_v2),v=o.b2MulMV(this.m_linearMass,A,e.SolveVelocityConstraints_s_impulse_v2).SelfNeg(),S=e.SolveVelocityConstraints_s_oldImpulse_v2.Copy(this.m_linearImpulse);this.m_linearImpulse.SelfAdd(v);var y=l*this.m_maxForce;this.m_linearImpulse.GetLengthSquared()>y*y&&(this.m_linearImpulse.Normalize(),this.m_linearImpulse.SelfMul(y)),o.b2SubVV(this.m_linearImpulse,S,v),i.SelfMulSub(a,v),s-=m*o.b2CrossVV(d,v),n.SelfMulAdd(_,v),r+=h*o.b2CrossVV(f,v),t.velocities[this.m_indexA].w=s,t.velocities[this.m_indexB].w=r},e.prototype.SolvePositionConstraints=function(t){return!0},e.prototype.Dump=function(){if(n.DEBUG){var t=this.m_bodyA.m_islandIndex,e=this.m_bodyB.m_islandIndex;n.b2Log("  var jd: b2MotorJointDef = new b2MotorJointDef();\n"),n.b2Log("  jd.bodyA = bodies[%d];\n",t),n.b2Log("  jd.bodyB = bodies[%d];\n",e),n.b2Log("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),n.b2Log("  jd.linearOffset.SetXY(%.15f, %.15f);\n",this.m_linearOffset.x,this.m_linearOffset.y),n.b2Log("  jd.angularOffset = %.15f;\n",this.m_angularOffset),n.b2Log("  jd.maxForce = %.15f;\n",this.m_maxForce),n.b2Log("  jd.maxTorque = %.15f;\n",this.m_maxTorque),n.b2Log("  jd.correctionFactor = %.15f;\n",this.m_correctionFactor),n.b2Log("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}},e.SolveVelocityConstraints_s_Cdot_v2=new o.b2Vec2,e.SolveVelocityConstraints_s_impulse_v2=new o.b2Vec2,e.SolveVelocityConstraints_s_oldImpulse_v2=new o.b2Vec2,e}(r.b2Joint);e.b2MotorJoint=_},function(t,e,i){"use strict";var s=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},o=i(4),n=i(3),r=i(23),a=i(25),_=function(t){function e(){t.call(this,r.b2JointType.e_areaJoint),this.world=null,this.bodies=new Array,this.frequencyHz=0,this.dampingRatio=0}return s(e,t),e.prototype.AddBody=function(t){this.bodies.push(t),1==this.bodies.length?this.bodyA=t:2==this.bodies.length&&(this.bodyB=t)},e}(r.b2JointDef);e.b2AreaJointDef=_;var m=function(t){function e(e){t.call(this,e),this.m_bodies=null,this.m_frequencyHz=0,this.m_dampingRatio=0,this.m_impulse=0,this.m_targetLengths=null,this.m_targetArea=0,this.m_normals=null,this.m_joints=null,this.m_deltas=null,this.m_delta=null,n.ENABLE_ASSERTS&&n.b2Assert(e.bodies.length>=3,"You cannot create an area joint with less than three bodies."),this.m_bodies=e.bodies,this.m_frequencyHz=e.frequencyHz,this.m_dampingRatio=e.dampingRatio,this.m_targetLengths=n.b2MakeNumberArray(e.bodies.length),this.m_normals=o.b2Vec2.MakeArray(e.bodies.length),this.m_joints=new Array(e.bodies.length),this.m_deltas=o.b2Vec2.MakeArray(e.bodies.length),this.m_delta=new o.b2Vec2;var i=new a.b2DistanceJointDef;i.frequencyHz=e.frequencyHz,i.dampingRatio=e.dampingRatio,this.m_targetArea=0;for(var s=0,r=this.m_bodies.length;s<r;++s){var _=this.m_bodies[s],m=this.m_bodies[(s+1)%r],h=_.GetWorldCenter(),l=m.GetWorldCenter();this.m_targetLengths[s]=o.b2DistanceVV(h,l),this.m_targetArea+=o.b2CrossVV(h,l),i.Initialize(_,m,h,l),this.m_joints[s]=e.world.CreateJoint(i)}this.m_targetArea*=.5}return s(e,t),e.prototype.GetAnchorA=function(t){return t.SetZero()},e.prototype.GetAnchorB=function(t){return t.SetZero()},e.prototype.GetReactionForce=function(t,e){return e.SetZero()},e.prototype.GetReactionTorque=function(t){return 0},e.prototype.SetFrequency=function(t){this.m_frequencyHz=t;for(var e=0,i=this.m_joints.length;e<i;++e)this.m_joints[e].SetFrequency(t)},e.prototype.GetFrequency=function(){return this.m_frequencyHz},e.prototype.SetDampingRatio=function(t){this.m_dampingRatio=t;for(var e=0,i=this.m_joints.length;e<i;++e)this.m_joints[e].SetDampingRatio(t)},e.prototype.GetDampingRatio=function(){return this.m_dampingRatio},e.prototype.Dump=function(){n.DEBUG&&n.b2Log("Area joint dumping is not supported.\n")},e.prototype.InitVelocityConstraints=function(t){for(var e=0,i=this.m_bodies.length;e<i;++e){var s=this.m_bodies[(e+i-1)%i],n=this.m_bodies[(e+1)%i],r=t.positions[s.m_islandIndex].c,a=t.positions[n.m_islandIndex].c,_=this.m_deltas[e];o.b2SubVV(a,r,_)}if(t.step.warmStarting){this.m_impulse*=t.step.dtRatio;for(var e=0,i=this.m_bodies.length;e<i;++e){var m=this.m_bodies[e],h=t.velocities[m.m_islandIndex].v,_=this.m_deltas[e];h.x+=m.m_invMass*_.y*.5*this.m_impulse,h.y+=m.m_invMass*-_.x*.5*this.m_impulse}}else this.m_impulse=0},e.prototype.SolveVelocityConstraints=function(t){for(var e=0,i=0,s=0,n=this.m_bodies.length;s<n;++s){var r=this.m_bodies[s],a=t.velocities[r.m_islandIndex].v,_=this.m_deltas[s];e+=_.GetLengthSquared()/r.GetMass(),i+=o.b2CrossVV(a,_)}var m=-2*i/e;this.m_impulse+=m;for(var s=0,n=this.m_bodies.length;s<n;++s){var r=this.m_bodies[s],a=t.velocities[r.m_islandIndex].v,_=this.m_deltas[s];a.x+=r.m_invMass*_.y*.5*m,a.y+=r.m_invMass*-_.x*.5*m}},e.prototype.SolvePositionConstraints=function(t){for(var e=0,i=0,s=0,r=this.m_bodies.length;s<r;++s){var a=this.m_bodies[s],_=this.m_bodies[(s+1)%r],m=t.positions[a.m_islandIndex].c,h=t.positions[_.m_islandIndex].c,l=o.b2SubVV(h,m,this.m_delta),c=l.GetLength();c<n.b2_epsilon&&(c=1),this.m_normals[s].x=l.y/c,this.m_normals[s].y=-l.x/c,e+=c,i+=o.b2CrossVV(m,h)}i*=.5;for(var u=this.m_targetArea-i,p=.5*u/e,b=!0,s=0,r=this.m_bodies.length;s<r;++s){var a=this.m_bodies[s],m=t.positions[a.m_islandIndex].c,y=(s+1)%r,l=o.b2AddVV(this.m_normals[s],this.m_normals[y],this.m_delta);l.SelfMul(p);var d=l.GetLengthSquared();d>o.b2Sq(n.b2_maxLinearCorrection)&&l.SelfMul(n.b2_maxLinearCorrection/o.b2Sqrt(d)),d>o.b2Sq(n.b2_linearSlop)&&(b=!1),m.x+=l.x,m.y+=l.y}return b},e}(r.b2Joint);e.b2AreaJoint=m},function(t,e,i){"use strict";var s=i(3),o=i(19),n=i(38),r=i(39),a=i(4),_=i(12),m=i(40),h=function(){function t(){this.m_allocator=null,this.m_listener=null,this.m_bodies=new Array(1024),this.m_contacts=new Array(1024),this.m_joints=new Array(1024),this.m_positions=n.b2Position.MakeArray(1024),this.m_velocities=n.b2Velocity.MakeArray(1024),this.m_bodyCount=0,this.m_jointCount=0,this.m_contactCount=0,this.m_bodyCapacity=0,this.m_contactCapacity=0,this.m_jointCapacity=0}return t.prototype.Initialize=function(t,e,i,o,r){for(this.m_bodyCapacity=t,this.m_contactCapacity=e,this.m_jointCapacity=i,this.m_bodyCount=0,this.m_contactCount=0,this.m_jointCount=0,this.m_allocator=o,this.m_listener=r;this.m_bodies.length<t;)this.m_bodies[this.m_bodies.length]=null;for(;this.m_contacts.length<e;)this.m_contacts[this.m_contacts.length]=null;for(;this.m_joints.length<i;)this.m_joints[this.m_joints.length]=null;if(this.m_positions.length<t){var _=a.b2Max(2*this.m_positions.length,t);for(s.DEBUG&&console.log("b2Island.m_positions: "+_);this.m_positions.length<_;)this.m_positions[this.m_positions.length]=new n.b2Position}if(this.m_velocities.length<t){var _=a.b2Max(2*this.m_velocities.length,t);for(s.DEBUG&&console.log("b2Island.m_velocities: "+_);this.m_velocities.length<_;)this.m_velocities[this.m_velocities.length]=new n.b2Velocity}},t.prototype.Clear=function(){this.m_bodyCount=0,this.m_contactCount=0,this.m_jointCount=0},t.prototype.AddBody=function(t){s.ENABLE_ASSERTS&&s.b2Assert(this.m_bodyCount<this.m_bodyCapacity),t.m_islandIndex=this.m_bodyCount,this.m_bodies[this.m_bodyCount++]=t},t.prototype.AddContact=function(t){s.ENABLE_ASSERTS&&s.b2Assert(this.m_contactCount<this.m_contactCapacity),this.m_contacts[this.m_contactCount++]=t},t.prototype.AddJoint=function(t){s.ENABLE_ASSERTS&&s.b2Assert(this.m_jointCount<this.m_jointCapacity),this.m_joints[this.m_jointCount++]=t},t.prototype.Solve=function(e,i,n,r){for(var _=t.s_timer.Reset(),m=i.dt,h=0;h<this.m_bodyCount;++h){var l=this.m_bodies[h],c=this.m_positions[h].c.Copy(l.m_sweep.c),u=l.m_sweep.a,p=this.m_velocities[h].v.Copy(l.m_linearVelocity),b=l.m_angularVelocity;l.m_sweep.c0.Copy(l.m_sweep.c),l.m_sweep.a0=l.m_sweep.a,l.m_type==o.b2BodyType.b2_dynamicBody&&(p.x+=m*(l.m_gravityScale*n.x+l.m_invMass*l.m_force.x),p.y+=m*(l.m_gravityScale*n.y+l.m_invMass*l.m_force.y),b+=m*l.m_invI*l.m_torque,p.SelfMul(a.b2Clamp(1-m*l.m_linearDamping,0,1)),b*=a.b2Clamp(1-m*l.m_angularDamping,0,1)),this.m_positions[h].a=u,this.m_velocities[h].w=b}_.Reset();var y=t.s_solverData;y.step.Copy(i),y.positions=this.m_positions,y.velocities=this.m_velocities;var d=t.s_contactSolverDef;d.step.Copy(i),d.contacts=this.m_contacts,d.count=this.m_contactCount,d.positions=this.m_positions,d.velocities=this.m_velocities,d.allocator=this.m_allocator;var f=t.s_contactSolver.Initialize(d);f.InitializeVelocityConstraints(),i.warmStarting&&f.WarmStart();for(var h=0;h<this.m_jointCount;++h)this.m_joints[h].InitVelocityConstraints(y);e.solveInit=_.GetMilliseconds(),_.Reset();for(var h=0;h<i.velocityIterations;++h){for(var A=0;A<this.m_jointCount;++A)this.m_joints[A].SolveVelocityConstraints(y);f.SolveVelocityConstraints()}f.StoreImpulses(),e.solveVelocity=_.GetMilliseconds();for(var h=0;h<this.m_bodyCount;++h){var c=this.m_positions[h].c,u=this.m_positions[h].a,p=this.m_velocities[h].v,b=this.m_velocities[h].w,v=a.b2MulSV(m,p,t.s_translation);if(a.b2DotVV(v,v)>s.b2_maxTranslationSquared){var S=s.b2_maxTranslation/v.GetLength();p.SelfMul(S)}var V=m*b;if(V*V>s.b2_maxRotationSquared){var S=s.b2_maxRotation/a.b2Abs(V);b*=S}c.x+=m*p.x,c.y+=m*p.y,u+=m*b,this.m_positions[h].a=u,this.m_velocities[h].w=b}_.Reset();for(var x=!1,h=0;h<i.positionIterations;++h){for(var C=f.SolvePositionConstraints(),B=!0,A=0;A<this.m_jointCount;++A){var g=this.m_joints[A].SolvePositionConstraints(y);B=B&&g}if(C&&B){x=!0;break}}for(var h=0;h<this.m_bodyCount;++h){var w=this.m_bodies[h];w.m_sweep.c.Copy(this.m_positions[h].c),w.m_sweep.a=this.m_positions[h].a,w.m_linearVelocity.Copy(this.m_velocities[h].v),w.m_angularVelocity=this.m_velocities[h].w,w.SynchronizeTransform()}if(e.solvePosition=_.GetMilliseconds(),this.Report(f.m_velocityConstraints),r){for(var M=s.b2_maxFloat,L=s.b2_linearSleepTolerance*s.b2_linearSleepTolerance,I=s.b2_angularSleepTolerance*s.b2_angularSleepTolerance,h=0;h<this.m_bodyCount;++h){var l=this.m_bodies[h];l.GetType()!=o.b2BodyType.b2_staticBody&&(0==(l.m_flags&o.b2BodyFlag.e_autoSleepFlag)||l.m_angularVelocity*l.m_angularVelocity>I||a.b2DotVV(l.m_linearVelocity,l.m_linearVelocity)>L?(l.m_sleepTime=0,M=0):(l.m_sleepTime+=m,M=a.b2Min(M,l.m_sleepTime)))}if(M>=s.b2_timeToSleep&&x)for(var h=0;h<this.m_bodyCount;++h){var l=this.m_bodies[h];l.SetAwake(!1)}}},t.prototype.SolveTOI=function(e,i,o){s.ENABLE_ASSERTS&&s.b2Assert(i<this.m_bodyCount),s.ENABLE_ASSERTS&&s.b2Assert(o<this.m_bodyCount);for(var n=0;n<this.m_bodyCount;++n){var r=this.m_bodies[n];this.m_positions[n].c.Copy(r.m_sweep.c),this.m_positions[n].a=r.m_sweep.a,this.m_velocities[n].v.Copy(r.m_linearVelocity),this.m_velocities[n].w=r.m_angularVelocity}var _=t.s_contactSolverDef;_.contacts=this.m_contacts,_.count=this.m_contactCount,_.allocator=this.m_allocator,_.step.Copy(e),_.positions=this.m_positions,_.velocities=this.m_velocities;for(var m=t.s_contactSolver.Initialize(_),n=0;n<e.positionIterations;++n){var h=m.SolveTOIPositionConstraints(i,o);if(h)break}this.m_bodies[i].m_sweep.c0.Copy(this.m_positions[i].c),this.m_bodies[i].m_sweep.a0=this.m_positions[i].a,this.m_bodies[o].m_sweep.c0.Copy(this.m_positions[o].c),this.m_bodies[o].m_sweep.a0=this.m_positions[o].a,m.InitializeVelocityConstraints();for(var n=0;n<e.velocityIterations;++n)m.SolveVelocityConstraints();for(var l=e.dt,n=0;n<this.m_bodyCount;++n){var c=this.m_positions[n].c,u=this.m_positions[n].a,p=this.m_velocities[n].v,b=this.m_velocities[n].w,y=a.b2MulSV(l,p,t.s_translation);if(a.b2DotVV(y,y)>s.b2_maxTranslationSquared){var d=s.b2_maxTranslation/y.GetLength();p.SelfMul(d)}var f=l*b;if(f*f>s.b2_maxRotationSquared){var d=s.b2_maxRotation/a.b2Abs(f);b*=d}c.SelfMulAdd(l,p),u+=l*b,this.m_positions[n].a=u,this.m_velocities[n].w=b;var A=this.m_bodies[n];A.m_sweep.c.Copy(c),A.m_sweep.a=u,A.m_linearVelocity.Copy(p),A.m_angularVelocity=b,A.SynchronizeTransform()}this.Report(m.m_velocityConstraints)},t.prototype.Report=function(e){if(null!=this.m_listener)for(var i=0;i<this.m_contactCount;++i){var s=this.m_contacts[i];if(s){var o=e[i],n=t.s_impulse;n.count=o.pointCount;for(var r=0;r<o.pointCount;++r)n.normalImpulses[r]=o.points[r].normalImpulse,n.tangentImpulses[r]=o.points[r].tangentImpulse;this.m_listener.PostSolve(s,n)}}},t.s_timer=new _.b2Timer,t.s_solverData=new n.b2SolverData,t.s_contactSolverDef=new r.b2ContactSolverDef,t.s_contactSolver=new r.b2ContactSolver,t.s_translation=new a.b2Vec2,t.s_impulse=new m.b2ContactImpulse,t}();e.b2Island=h},function(t,e,i){"use strict";var s=i(3),o=i(4),n=function(){function t(){this.step=0,this.collide=0,this.solve=0,this.solveInit=0,this.solveVelocity=0,this.solvePosition=0,this.broadphase=0,this.solveTOI=0}return t.prototype.Reset=function(){return this.step=0,this.collide=0,this.solve=0,this.solveInit=0,this.solveVelocity=0,this.solvePosition=0,this.broadphase=0,this.solveTOI=0,this},t}();e.b2Profile=n;var r=function(){function t(){this.dt=0,this.inv_dt=0,this.dtRatio=0,this.velocityIterations=0,this.positionIterations=0,this.warmStarting=!1}return t.prototype.Copy=function(t){return this.dt=t.dt,this.inv_dt=t.inv_dt,this.dtRatio=t.dtRatio,this.positionIterations=t.positionIterations,this.velocityIterations=t.velocityIterations,this.warmStarting=t.warmStarting,this},t}();e.b2TimeStep=r;var a=function(){function t(){this.c=new o.b2Vec2,this.a=0}return t.MakeArray=function(e){return s.b2MakeArray(e,function(e){return new t})},t}();e.b2Position=a;var _=function(){function t(){this.v=new o.b2Vec2,this.w=0}return t.MakeArray=function(e){return s.b2MakeArray(e,function(e){return new t})},t}();e.b2Velocity=_;var m=function(){function t(){this.step=new r,this.positions=null,this.velocities=null}return t}();e.b2SolverData=m},function(t,e,i){"use strict";var s=i(3),o=i(4),n=i(38),r=i(2),a=function(){function t(){this.rA=new o.b2Vec2,this.rB=new o.b2Vec2,this.normalImpulse=0,this.tangentImpulse=0,this.normalMass=0,this.tangentMass=0,this.velocityBias=0}return t.MakeArray=function(e){return s.b2MakeArray(e,function(e){return new t})},t}();e.b2VelocityConstraintPoint=a;var _=function(){function t(){this.points=a.MakeArray(s.b2_maxManifoldPoints),this.normal=new o.b2Vec2,this.tangent=new o.b2Vec2,this.normalMass=new o.b2Mat22,this.K=new o.b2Mat22,this.indexA=0,this.indexB=0,this.invMassA=0,this.invMassB=0,this.invIA=0,this.invIB=0,this.friction=0,this.restitution=0,this.tangentSpeed=0,this.pointCount=0,this.contactIndex=0}return t.MakeArray=function(e){return s.b2MakeArray(e,function(e){return new t})},t}();e.b2ContactVelocityConstraint=_;var m=function(){function t(){this.localPoints=o.b2Vec2.MakeArray(s.b2_maxManifoldPoints),this.localNormal=new o.b2Vec2,this.localPoint=new o.b2Vec2,this.indexA=0,this.indexB=0,this.invMassA=0,this.invMassB=0,this.localCenterA=new o.b2Vec2,this.localCenterB=new o.b2Vec2,this.invIA=0,this.invIB=0,this.type=r.b2ManifoldType.e_unknown,this.radiusA=0,this.radiusB=0,this.pointCount=0}return t.MakeArray=function(e){return s.b2MakeArray(e,function(e){return new t})},t}();e.b2ContactPositionConstraint=m;var h=function(){function t(){this.step=new n.b2TimeStep,this.contacts=null,this.count=0,this.positions=null,this.velocities=null,this.allocator=null}return t}();e.b2ContactSolverDef=h;var l=function(){function t(){this.normal=new o.b2Vec2,this.point=new o.b2Vec2,this.separation=0}return t.prototype.Initialize=function(e,i,n,a){var _=t.Initialize_s_pointA,m=t.Initialize_s_pointB,h=t.Initialize_s_planePoint,l=t.Initialize_s_clipPoint;switch(s.ENABLE_ASSERTS&&s.b2Assert(e.pointCount>0),e.type){case r.b2ManifoldType.e_circles:o.b2MulXV(i,e.localPoint,_),o.b2MulXV(n,e.localPoints[0],m),o.b2SubVV(m,_,this.normal).SelfNormalize(),o.b2MidVV(_,m,this.point),this.separation=o.b2DotVV(o.b2SubVV(m,_,o.b2Vec2.s_t0),this.normal)-e.radiusA-e.radiusB;break;case r.b2ManifoldType.e_faceA:o.b2MulRV(i.q,e.localNormal,this.normal),o.b2MulXV(i,e.localPoint,h),o.b2MulXV(n,e.localPoints[a],l),this.separation=o.b2DotVV(o.b2SubVV(l,h,o.b2Vec2.s_t0),this.normal)-e.radiusA-e.radiusB,this.point.Copy(l);break;case r.b2ManifoldType.e_faceB:o.b2MulRV(n.q,e.localNormal,this.normal),o.b2MulXV(n,e.localPoint,h),o.b2MulXV(i,e.localPoints[a],l),this.separation=o.b2DotVV(o.b2SubVV(l,h,o.b2Vec2.s_t0),this.normal)-e.radiusA-e.radiusB,this.point.Copy(l),this.normal.SelfNeg()}},t.Initialize_s_pointA=new o.b2Vec2,t.Initialize_s_pointB=new o.b2Vec2,t.Initialize_s_planePoint=new o.b2Vec2,t.Initialize_s_clipPoint=new o.b2Vec2,t}();e.b2PositionSolverManifold=l;var c=function(){function t(){this.m_step=new n.b2TimeStep,this.m_positions=null,this.m_velocities=null,this.m_allocator=null,this.m_positionConstraints=m.MakeArray(1024),this.m_velocityConstraints=_.MakeArray(1024),this.m_contacts=null,this.m_count=0}return t.prototype.Initialize=function(t){if(this.m_step.Copy(t.step),this.m_allocator=t.allocator,this.m_count=t.count,this.m_positionConstraints.length<this.m_count){var e=o.b2Max(2*this.m_positionConstraints.length,this.m_count);for(s.DEBUG&&console.log("b2ContactSolver.m_positionConstraints: "+e);this.m_positionConstraints.length<e;)this.m_positionConstraints[this.m_positionConstraints.length]=new m}if(this.m_velocityConstraints.length<this.m_count){var e=o.b2Max(2*this.m_velocityConstraints.length,this.m_count);for(s.DEBUG&&console.log("b2ContactSolver.m_velocityConstraints: "+e);this.m_velocityConstraints.length<e;)this.m_velocityConstraints[this.m_velocityConstraints.length]=new _}this.m_positions=t.positions,this.m_velocities=t.velocities,this.m_contacts=t.contacts;var i,n,r,a,h,l,c,u,p,b,y,d,f,A,v,S,V,x,C;for(i=0,n=this.m_count;i<n;++i)for(h=this.m_contacts[i],l=h.m_fixtureA,c=h.m_fixtureB,u=l.GetShape(),p=c.GetShape(),b=u.m_radius,y=p.m_radius,d=l.GetBody(),f=c.GetBody(),A=h.GetManifold(),v=A.pointCount,s.ENABLE_ASSERTS&&s.b2Assert(v>0),S=this.m_velocityConstraints[i],S.friction=h.m_friction,S.restitution=h.m_restitution,S.tangentSpeed=h.m_tangentSpeed,S.indexA=d.m_islandIndex,S.indexB=f.m_islandIndex,S.invMassA=d.m_invMass,S.invMassB=f.m_invMass,S.invIA=d.m_invI,S.invIB=f.m_invI,S.contactIndex=i,S.pointCount=v,S.K.SetZero(),S.normalMass.SetZero(),V=this.m_positionConstraints[i],V.indexA=d.m_islandIndex,V.indexB=f.m_islandIndex,V.invMassA=d.m_invMass,V.invMassB=f.m_invMass,V.localCenterA.Copy(d.m_sweep.localCenter),V.localCenterB.Copy(f.m_sweep.localCenter),V.invIA=d.m_invI,V.invIB=f.m_invI,V.localNormal.Copy(A.localNormal),V.localPoint.Copy(A.localPoint),V.pointCount=v,V.radiusA=b,V.radiusB=y,V.type=A.type,r=0,a=v;r<a;++r)x=A.points[r],C=S.points[r],this.m_step.warmStarting?(C.normalImpulse=this.m_step.dtRatio*x.normalImpulse,C.tangentImpulse=this.m_step.dtRatio*x.tangentImpulse):(C.normalImpulse=0,C.tangentImpulse=0),C.rA.SetZero(),C.rB.SetZero(),C.normalMass=0,C.tangentMass=0,C.velocityBias=0,V.localPoints[r].Copy(x.localPoint);return this},t.prototype.InitializeVelocityConstraints=function(){var e,i,n,r,a,_,m,h,l,c,u,p,b,y,d,f,A,v,S,V,x,C,B,g,w,M,L,I,T,R,E,G,D,P,F,k,N,q,z,J,j,X,O,Y,Z=t.InitializeVelocityConstraints_s_xfA,H=t.InitializeVelocityConstraints_s_xfB,W=t.InitializeVelocityConstraints_s_worldManifold,U=1e3;for(e=0,i=this.m_count;e<i;++e){for(a=this.m_velocityConstraints[e],_=this.m_positionConstraints[e],m=_.radiusA,h=_.radiusB,l=this.m_contacts[a.contactIndex].GetManifold(),c=a.indexA,u=a.indexB,p=a.invMassA,b=a.invMassB,y=a.invIA,d=a.invIB,f=_.localCenterA,A=_.localCenterB,v=this.m_positions[c].c,S=this.m_positions[c].a,V=this.m_velocities[c].v,x=this.m_velocities[c].w,C=this.m_positions[u].c,B=this.m_positions[u].a,g=this.m_velocities[u].v,w=this.m_velocities[u].w,s.ENABLE_ASSERTS&&s.b2Assert(l.pointCount>0),Z.q.SetAngleRadians(S),H.q.SetAngleRadians(B),o.b2SubVV(v,o.b2MulRV(Z.q,f,o.b2Vec2.s_t0),Z.p),o.b2SubVV(C,o.b2MulRV(H.q,A,o.b2Vec2.s_t0),H.p),W.Initialize(l,Z,m,H,h),a.normal.Copy(W.normal),o.b2CrossVOne(a.normal,a.tangent),M=a.pointCount,n=0,r=M;n<r;++n)L=a.points[n],o.b2SubVV(W.points[n],v,L.rA),o.b2SubVV(W.points[n],C,L.rB),I=o.b2CrossVV(L.rA,a.normal),T=o.b2CrossVV(L.rB,a.normal),R=p+b+y*I*I+d*T*T,L.normalMass=R>0?1/R:0,E=a.tangent,G=o.b2CrossVV(L.rA,E),D=o.b2CrossVV(L.rB,E),P=p+b+y*G*G+d*D*D,L.tangentMass=P>0?1/P:0,L.velocityBias=0,F=o.b2DotVV(a.normal,o.b2SubVV(o.b2AddVCrossSV(g,w,L.rB,o.b2Vec2.s_t0),o.b2AddVCrossSV(V,x,L.rA,o.b2Vec2.s_t1),o.b2Vec2.s_t0)),F<-s.b2_velocityThreshold&&(L.velocityBias+=-a.restitution*F);2==a.pointCount&&(k=a.points[0],N=a.points[1],q=o.b2CrossVV(k.rA,a.normal),z=o.b2CrossVV(k.rB,a.normal),J=o.b2CrossVV(N.rA,a.normal),j=o.b2CrossVV(N.rB,a.normal),X=p+b+y*q*q+d*z*z,O=p+b+y*J*J+d*j*j,Y=p+b+y*q*J+d*z*j,X*X<U*(X*O-Y*Y)?(a.K.ex.SetXY(X,Y),a.K.ey.SetXY(Y,O),a.K.GetInverse(a.normalMass)):a.pointCount=1)}},t.prototype.WarmStart=function(){var e,i,s,n,r,a,_,m,h,l,c,u,p,b,y,d,f,A,v,S=t.WarmStart_s_P;for(e=0,i=this.m_count;e<i;++e){for(r=this.m_velocityConstraints[e],a=r.indexA,_=r.indexB,m=r.invMassA,h=r.invIA,l=r.invMassB,c=r.invIB,u=r.pointCount,p=this.m_velocities[a].v,b=this.m_velocities[a].w,y=this.m_velocities[_].v,d=this.m_velocities[_].w,f=r.normal,A=r.tangent,s=0,n=u;s<n;++s)v=r.points[s],o.b2AddVV(o.b2MulSV(v.normalImpulse,f,o.b2Vec2.s_t0),o.b2MulSV(v.tangentImpulse,A,o.b2Vec2.s_t1),S),b-=h*o.b2CrossVV(v.rA,S),p.SelfMulSub(m,S),d+=c*o.b2CrossVV(v.rB,S),y.SelfMulAdd(l,S);this.m_velocities[a].w=b,this.m_velocities[_].w=d}},t.prototype.SolveVelocityConstraints=function(){var e,i,n,r,a,_,m,h,l,c,u,p,b,y,d,f,A,v,S,V,x,C,B,g,w,M,L,I,T,R=t.SolveVelocityConstraints_s_dv,E=t.SolveVelocityConstraints_s_dv1,G=t.SolveVelocityConstraints_s_dv2,D=t.SolveVelocityConstraints_s_P,P=t.SolveVelocityConstraints_s_a,F=t.SolveVelocityConstraints_s_b,k=t.SolveVelocityConstraints_s_x,N=t.SolveVelocityConstraints_s_d,q=t.SolveVelocityConstraints_s_P1,z=t.SolveVelocityConstraints_s_P2,J=t.SolveVelocityConstraints_s_P1P2;for(e=0,i=this.m_count;e<i;++e){for(a=this.m_velocityConstraints[e],_=a.indexA,m=a.indexB,h=a.invMassA,l=a.invIA,c=a.invMassB,u=a.invIB,p=a.pointCount,b=this.m_velocities[_].v,y=this.m_velocities[_].w,d=this.m_velocities[m].v,f=this.m_velocities[m].w,A=a.normal,v=a.tangent,S=a.friction,s.ENABLE_ASSERTS&&s.b2Assert(1==p||2==p),n=0,r=p;n<r;++n)V=a.points[n],o.b2SubVV(o.b2AddVCrossSV(d,f,V.rB,o.b2Vec2.s_t0),o.b2AddVCrossSV(b,y,V.rA,o.b2Vec2.s_t1),R),x=o.b2DotVV(R,v)-a.tangentSpeed,B=V.tangentMass*-x,g=S*V.normalImpulse,w=o.b2Clamp(V.tangentImpulse+B,-g,g),B=w-V.tangentImpulse,V.tangentImpulse=w,o.b2MulSV(B,v,D),b.SelfMulSub(h,D),y-=l*o.b2CrossVV(V.rA,D),d.SelfMulAdd(c,D),f+=u*o.b2CrossVV(V.rB,D);if(1==a.pointCount)V=a.points[0],o.b2SubVV(o.b2AddVCrossSV(d,f,V.rB,o.b2Vec2.s_t0),o.b2AddVCrossSV(b,y,V.rA,o.b2Vec2.s_t1),R),C=o.b2DotVV(R,A),B=-V.normalMass*(C-V.velocityBias),w=o.b2Max(V.normalImpulse+B,0),B=w-V.normalImpulse,V.normalImpulse=w,o.b2MulSV(B,A,D),
b.SelfMulSub(h,D),y-=l*o.b2CrossVV(V.rA,D),d.SelfMulAdd(c,D),f+=u*o.b2CrossVV(V.rB,D);else for(M=a.points[0],L=a.points[1],P.SetXY(M.normalImpulse,L.normalImpulse),s.ENABLE_ASSERTS&&s.b2Assert(P.x>=0&&P.y>=0),o.b2SubVV(o.b2AddVCrossSV(d,f,M.rB,o.b2Vec2.s_t0),o.b2AddVCrossSV(b,y,M.rA,o.b2Vec2.s_t1),E),o.b2SubVV(o.b2AddVCrossSV(d,f,L.rB,o.b2Vec2.s_t0),o.b2AddVCrossSV(b,y,L.rA,o.b2Vec2.s_t1),G),I=o.b2DotVV(E,A),T=o.b2DotVV(G,A),F.x=I-M.velocityBias,F.y=T-L.velocityBias,F.SelfSub(o.b2MulMV(a.K,P,o.b2Vec2.s_t0));;){if(o.b2MulMV(a.normalMass,F,k).SelfNeg(),k.x>=0&&k.y>=0){o.b2SubVV(k,P,N),o.b2MulSV(N.x,A,q),o.b2MulSV(N.y,A,z),o.b2AddVV(q,z,J),b.SelfMulSub(h,J),y-=l*(o.b2CrossVV(M.rA,q)+o.b2CrossVV(L.rA,z)),d.SelfMulAdd(c,J),f+=u*(o.b2CrossVV(M.rB,q)+o.b2CrossVV(L.rB,z)),M.normalImpulse=k.x,L.normalImpulse=k.y;break}if(k.x=-M.normalMass*F.x,k.y=0,I=0,T=a.K.ex.y*k.x+F.y,k.x>=0&&T>=0){o.b2SubVV(k,P,N),o.b2MulSV(N.x,A,q),o.b2MulSV(N.y,A,z),o.b2AddVV(q,z,J),b.SelfMulSub(h,J),y-=l*(o.b2CrossVV(M.rA,q)+o.b2CrossVV(L.rA,z)),d.SelfMulAdd(c,J),f+=u*(o.b2CrossVV(M.rB,q)+o.b2CrossVV(L.rB,z)),M.normalImpulse=k.x,L.normalImpulse=k.y;break}if(k.x=0,k.y=-L.normalMass*F.y,I=a.K.ey.x*k.y+F.x,T=0,k.y>=0&&I>=0){o.b2SubVV(k,P,N),o.b2MulSV(N.x,A,q),o.b2MulSV(N.y,A,z),o.b2AddVV(q,z,J),b.SelfMulSub(h,J),y-=l*(o.b2CrossVV(M.rA,q)+o.b2CrossVV(L.rA,z)),d.SelfMulAdd(c,J),f+=u*(o.b2CrossVV(M.rB,q)+o.b2CrossVV(L.rB,z)),M.normalImpulse=k.x,L.normalImpulse=k.y;break}if(k.x=0,k.y=0,I=F.x,T=F.y,I>=0&&T>=0){o.b2SubVV(k,P,N),o.b2MulSV(N.x,A,q),o.b2MulSV(N.y,A,z),o.b2AddVV(q,z,J),b.SelfMulSub(h,J),y-=l*(o.b2CrossVV(M.rA,q)+o.b2CrossVV(L.rA,z)),d.SelfMulAdd(c,J),f+=u*(o.b2CrossVV(M.rB,q)+o.b2CrossVV(L.rB,z)),M.normalImpulse=k.x,L.normalImpulse=k.y;break}break}this.m_velocities[_].w=y,this.m_velocities[m].w=f}},t.prototype.StoreImpulses=function(){var t,e,i,s,o,n;for(t=0,e=this.m_count;t<e;++t)for(o=this.m_velocityConstraints[t],n=this.m_contacts[o.contactIndex].GetManifold(),i=0,s=o.pointCount;i<s;++i)n.points[i].normalImpulse=o.points[i].normalImpulse,n.points[i].tangentImpulse=o.points[i].tangentImpulse},t.prototype.SolvePositionConstraints=function(){var e,i,n,r,a,_,m,h,l,c,u,p,b,y,d,f,A,v,S,V,x,C,B,g,w,M,L=t.SolvePositionConstraints_s_xfA,I=t.SolvePositionConstraints_s_xfB,T=t.SolvePositionConstraints_s_psm,R=t.SolvePositionConstraints_s_rA,E=t.SolvePositionConstraints_s_rB,G=t.SolvePositionConstraints_s_P,D=0;for(e=0,i=this.m_count;e<i;++e){for(a=this.m_positionConstraints[e],_=a.indexA,m=a.indexB,h=a.localCenterA,l=a.invMassA,c=a.invIA,u=a.localCenterB,p=a.invMassB,b=a.invIB,y=a.pointCount,d=this.m_positions[_].c,f=this.m_positions[_].a,A=this.m_positions[m].c,v=this.m_positions[m].a,n=0,r=y;n<r;++n)L.q.SetAngleRadians(f),I.q.SetAngleRadians(v),o.b2SubVV(d,o.b2MulRV(L.q,h,o.b2Vec2.s_t0),L.p),o.b2SubVV(A,o.b2MulRV(I.q,u,o.b2Vec2.s_t0),I.p),T.Initialize(a,L,I,n),S=T.normal,V=T.point,x=T.separation,o.b2SubVV(V,d,R),o.b2SubVV(V,A,E),D=o.b2Min(D,x),C=o.b2Clamp(s.b2_baumgarte*(x+s.b2_linearSlop),-s.b2_maxLinearCorrection,0),B=o.b2CrossVV(R,S),g=o.b2CrossVV(E,S),w=l+p+c*B*B+b*g*g,M=w>0?-C/w:0,o.b2MulSV(M,S,G),d.SelfMulSub(l,G),f-=c*o.b2CrossVV(R,G),A.SelfMulAdd(p,G),v+=b*o.b2CrossVV(E,G);this.m_positions[_].a=f,this.m_positions[m].a=v}return D>-3*s.b2_linearSlop},t.prototype.SolveTOIPositionConstraints=function(e,i){var n,r,a,_,m,h,l,c,u,p,b,y,d,f,A,v,S,V,x,C,B,g,w,M,L,I,T=t.SolveTOIPositionConstraints_s_xfA,R=t.SolveTOIPositionConstraints_s_xfB,E=t.SolveTOIPositionConstraints_s_psm,G=t.SolveTOIPositionConstraints_s_rA,D=t.SolveTOIPositionConstraints_s_rB,P=t.SolveTOIPositionConstraints_s_P,F=0;for(n=0,r=this.m_count;n<r;++n){for(m=this.m_positionConstraints[n],h=m.indexA,l=m.indexB,c=m.localCenterA,u=m.localCenterB,p=m.pointCount,b=0,y=0,h!=e&&h!=i||(b=m.invMassA,y=m.invIA),d=0,f=0,l!=e&&l!=i||(d=m.invMassB,f=m.invIB),A=this.m_positions[h].c,v=this.m_positions[h].a,S=this.m_positions[l].c,V=this.m_positions[l].a,a=0,_=p;a<_;++a)T.q.SetAngleRadians(v),R.q.SetAngleRadians(V),o.b2SubVV(A,o.b2MulRV(T.q,c,o.b2Vec2.s_t0),T.p),o.b2SubVV(S,o.b2MulRV(R.q,u,o.b2Vec2.s_t0),R.p),E.Initialize(m,T,R,a),x=E.normal,C=E.point,B=E.separation,o.b2SubVV(C,A,G),o.b2SubVV(C,S,D),F=o.b2Min(F,B),g=o.b2Clamp(s.b2_toiBaumgarte*(B+s.b2_linearSlop),-s.b2_maxLinearCorrection,0),w=o.b2CrossVV(G,x),M=o.b2CrossVV(D,x),L=b+d+y*w*w+f*M*M,I=L>0?-g/L:0,o.b2MulSV(I,x,P),A.SelfMulSub(b,P),v-=y*o.b2CrossVV(G,P),S.SelfMulAdd(d,P),V+=f*o.b2CrossVV(D,P);this.m_positions[h].a=v,this.m_positions[l].a=V}return F>=-1.5*s.b2_linearSlop},t.InitializeVelocityConstraints_s_xfA=new o.b2Transform,t.InitializeVelocityConstraints_s_xfB=new o.b2Transform,t.InitializeVelocityConstraints_s_worldManifold=new r.b2WorldManifold,t.WarmStart_s_P=new o.b2Vec2,t.SolveVelocityConstraints_s_dv=new o.b2Vec2,t.SolveVelocityConstraints_s_dv1=new o.b2Vec2,t.SolveVelocityConstraints_s_dv2=new o.b2Vec2,t.SolveVelocityConstraints_s_P=new o.b2Vec2,t.SolveVelocityConstraints_s_a=new o.b2Vec2,t.SolveVelocityConstraints_s_b=new o.b2Vec2,t.SolveVelocityConstraints_s_x=new o.b2Vec2,t.SolveVelocityConstraints_s_d=new o.b2Vec2,t.SolveVelocityConstraints_s_P1=new o.b2Vec2,t.SolveVelocityConstraints_s_P2=new o.b2Vec2,t.SolveVelocityConstraints_s_P1P2=new o.b2Vec2,t.SolvePositionConstraints_s_xfA=new o.b2Transform,t.SolvePositionConstraints_s_xfB=new o.b2Transform,t.SolvePositionConstraints_s_psm=new l,t.SolvePositionConstraints_s_rA=new o.b2Vec2,t.SolvePositionConstraints_s_rB=new o.b2Vec2,t.SolvePositionConstraints_s_P=new o.b2Vec2,t.SolveTOIPositionConstraints_s_xfA=new o.b2Transform,t.SolveTOIPositionConstraints_s_xfB=new o.b2Transform,t.SolveTOIPositionConstraints_s_psm=new l,t.SolveTOIPositionConstraints_s_rA=new o.b2Vec2,t.SolveTOIPositionConstraints_s_rB=new o.b2Vec2,t.SolveTOIPositionConstraints_s_P=new o.b2Vec2,t}();e.b2ContactSolver=c},function(t,e,i){"use strict";var s=i(3),o=function(){function t(){}return t.prototype.SayGoodbyeJoint=function(t){},t.prototype.SayGoodbyeFixture=function(t){},t}();e.b2DestructionListener=o;var n=function(){function t(){}return t.prototype.ShouldCollide=function(t,e){var i=t.GetFilterData(),s=e.GetFilterData();if(i.groupIndex==s.groupIndex&&0!=i.groupIndex)return i.groupIndex>0;var o=0!=(i.maskBits&s.categoryBits)&&0!=(i.categoryBits&s.maskBits);return o},t.b2_defaultFilter=new t,t}();e.b2ContactFilter=n;var r=function(){function t(){this.normalImpulses=s.b2MakeNumberArray(s.b2_maxManifoldPoints),this.tangentImpulses=s.b2MakeNumberArray(s.b2_maxManifoldPoints),this.count=0}return t}();e.b2ContactImpulse=r;var a=function(){function t(){}return t.prototype.BeginContact=function(t){},t.prototype.EndContact=function(t){},t.prototype.PreSolve=function(t,e){},t.prototype.PostSolve=function(t,e){},t.b2_defaultListener=new t,t}();e.b2ContactListener=a;var _=function(){function t(){}return t.prototype.ReportFixture=function(t){return!0},t}();e.b2QueryCallback=_;var m=function(){function t(){}return t.prototype.ReportFixture=function(t,e,i,s){return s},t}();e.b2RayCastCallback=m},function(t,e,i){"use strict";var s=i(3),o=i(1),n=i(20),r=i(19),a=i(22),_=i(42),m=i(40),h=function(){function t(){this.m_broadPhase=new o.b2BroadPhase,this.m_contactList=null,this.m_contactCount=0,this.m_contactFilter=m.b2ContactFilter.b2_defaultFilter,this.m_contactListener=m.b2ContactListener.b2_defaultListener,this.m_allocator=null,this.m_contactFactory=null,this.m_contactFactory=new _.b2ContactFactory(this.m_allocator)}return t.prototype.AddPair=function(t,e){s.ENABLE_ASSERTS&&s.b2Assert(t instanceof n.b2FixtureProxy),s.ENABLE_ASSERTS&&s.b2Assert(e instanceof n.b2FixtureProxy);var i=t,o=e,r=i.fixture,a=o.fixture,_=i.childIndex,m=o.childIndex,h=r.GetBody(),l=a.GetBody();if(h!=l){for(var c=l.GetContactList();c;){if(c.other==h){var u=c.contact.GetFixtureA(),p=c.contact.GetFixtureB(),b=c.contact.GetChildIndexA(),y=c.contact.GetChildIndexB();if(u==r&&p==a&&b==_&&y==m)return;if(u==a&&p==r&&b==m&&y==_)return}c=c.next}if(0!=l.ShouldCollide(h)&&(!this.m_contactFilter||0!=this.m_contactFilter.ShouldCollide(r,a))){var d=this.m_contactFactory.Create(r,_,a,m);null!=d&&(r=d.GetFixtureA(),a=d.GetFixtureB(),_=d.GetChildIndexA(),m=d.GetChildIndexB(),h=r.m_body,l=a.m_body,d.m_prev=null,d.m_next=this.m_contactList,null!==this.m_contactList&&(this.m_contactList.m_prev=d),this.m_contactList=d,d.m_nodeA.contact=d,d.m_nodeA.other=l,d.m_nodeA.prev=null,d.m_nodeA.next=h.m_contactList,null!=h.m_contactList&&(h.m_contactList.prev=d.m_nodeA),h.m_contactList=d.m_nodeA,d.m_nodeB.contact=d,d.m_nodeB.other=h,d.m_nodeB.prev=null,d.m_nodeB.next=l.m_contactList,null!=l.m_contactList&&(l.m_contactList.prev=d.m_nodeB),l.m_contactList=d.m_nodeB,0==r.IsSensor()&&0==a.IsSensor()&&(h.SetAwake(!0),l.SetAwake(!0)),++this.m_contactCount)}}},t.prototype.FindNewContacts=function(){this.m_broadPhase.UpdatePairs(this)},t.prototype.Destroy=function(t){var e=t.GetFixtureA(),i=t.GetFixtureB(),s=e.GetBody(),o=i.GetBody();this.m_contactListener&&t.IsTouching()&&this.m_contactListener.EndContact(t),t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t==this.m_contactList&&(this.m_contactList=t.m_next),t.m_nodeA.prev&&(t.m_nodeA.prev.next=t.m_nodeA.next),t.m_nodeA.next&&(t.m_nodeA.next.prev=t.m_nodeA.prev),t.m_nodeA==s.m_contactList&&(s.m_contactList=t.m_nodeA.next),t.m_nodeB.prev&&(t.m_nodeB.prev.next=t.m_nodeB.next),t.m_nodeB.next&&(t.m_nodeB.next.prev=t.m_nodeB.prev),t.m_nodeB==o.m_contactList&&(o.m_contactList=t.m_nodeB.next),this.m_contactFactory.Destroy(t),--this.m_contactCount},t.prototype.Collide=function(){for(var t=this.m_contactList;t;){var e=t.GetFixtureA(),i=t.GetFixtureB(),s=t.GetChildIndexA(),o=t.GetChildIndexB(),n=e.GetBody(),_=i.GetBody();if(t.m_flags&a.b2ContactFlag.e_filterFlag){if(0==_.ShouldCollide(n)){var m=t;t=m.m_next,this.Destroy(m);continue}if(this.m_contactFilter&&0==this.m_contactFilter.ShouldCollide(e,i)){var m=t;t=m.m_next,this.Destroy(m);continue}t.m_flags&=~a.b2ContactFlag.e_filterFlag}var h=n.IsAwake()&&n.m_type!=r.b2BodyType.b2_staticBody,l=_.IsAwake()&&_.m_type!=r.b2BodyType.b2_staticBody;if(0!=h||0!=l){var c=e.m_proxies[s].proxy,u=i.m_proxies[o].proxy,p=this.m_broadPhase.TestOverlap(c,u);if(0!=p)t.Update(this.m_contactListener),t=t.m_next;else{var m=t;t=m.m_next,this.Destroy(m)}}else t=t.m_next}},t}();e.b2ContactManager=h},function(t,e,i){"use strict";var s=i(3),o=i(14),n=i(43),r=i(44),a=i(45),_=i(46),m=i(47),h=i(48),l=i(49),c=function(){function t(){this.pool=null,this.createFcn=null,this.destroyFcn=null,this.primary=!1}return t}();e.b2ContactRegister=c;var u=function(){function t(t){this.m_allocator=null,this.m_allocator=t,this.InitializeRegisters()}return t.prototype.AddType=function(t,e,i,o){var n=this,r=s.b2MakeArray(256,function(e){return t(n.m_allocator)}),a=function(e){return r.length>0?r.pop():t(e)},_=function(t,e){r.push(t)};this.m_registers[i][o].pool=r,this.m_registers[i][o].createFcn=a,this.m_registers[i][o].destroyFcn=_,this.m_registers[i][o].primary=!0,i!=o&&(this.m_registers[o][i].pool=r,this.m_registers[o][i].createFcn=a,this.m_registers[o][i].destroyFcn=_,this.m_registers[o][i].primary=!1)},t.prototype.InitializeRegisters=function(){this.m_registers=new Array(o.b2ShapeType.e_shapeTypeCount);for(var t=0;t<o.b2ShapeType.e_shapeTypeCount;t++){this.m_registers[t]=new Array(o.b2ShapeType.e_shapeTypeCount);for(var e=0;e<o.b2ShapeType.e_shapeTypeCount;e++)this.m_registers[t][e]=new c}this.AddType(n.b2CircleContact.Create,n.b2CircleContact.Destroy,o.b2ShapeType.e_circleShape,o.b2ShapeType.e_circleShape),this.AddType(r.b2PolygonAndCircleContact.Create,r.b2PolygonAndCircleContact.Destroy,o.b2ShapeType.e_polygonShape,o.b2ShapeType.e_circleShape),this.AddType(a.b2PolygonContact.Create,a.b2PolygonContact.Destroy,o.b2ShapeType.e_polygonShape,o.b2ShapeType.e_polygonShape),this.AddType(_.b2EdgeAndCircleContact.Create,_.b2EdgeAndCircleContact.Destroy,o.b2ShapeType.e_edgeShape,o.b2ShapeType.e_circleShape),this.AddType(m.b2EdgeAndPolygonContact.Create,m.b2EdgeAndPolygonContact.Destroy,o.b2ShapeType.e_edgeShape,o.b2ShapeType.e_polygonShape),this.AddType(h.b2ChainAndCircleContact.Create,h.b2ChainAndCircleContact.Destroy,o.b2ShapeType.e_chainShape,o.b2ShapeType.e_circleShape),this.AddType(l.b2ChainAndPolygonContact.Create,l.b2ChainAndPolygonContact.Destroy,o.b2ShapeType.e_chainShape,o.b2ShapeType.e_polygonShape)},t.prototype.Create=function(t,e,i,n){var r=t.GetType(),a=i.GetType();s.ENABLE_ASSERTS&&s.b2Assert(0<=r&&r<o.b2ShapeType.e_shapeTypeCount),s.ENABLE_ASSERTS&&s.b2Assert(0<=a&&a<o.b2ShapeType.e_shapeTypeCount);var _=this.m_registers[r][a];if(_.primary){var m=_.createFcn(this.m_allocator);return m.Reset(t,e,i,n),m}var m=_.createFcn(this.m_allocator);return m.Reset(i,n,t,e),m},t.prototype.Destroy=function(t){var e=t.m_fixtureA,i=t.m_fixtureB;t.m_manifold.pointCount>0&&0==e.IsSensor()&&0==i.IsSensor()&&(e.GetBody().SetAwake(!0),i.GetBody().SetAwake(!0));var n=e.GetType(),r=i.GetType();s.ENABLE_ASSERTS&&s.b2Assert(0<=n&&r<o.b2ShapeType.e_shapeTypeCount),s.ENABLE_ASSERTS&&s.b2Assert(0<=n&&r<o.b2ShapeType.e_shapeTypeCount);var a=this.m_registers[n][r];a.destroyFcn(t,this.m_allocator)},t}();e.b2ContactFactory=u},function(t,e,i){"use strict";var s=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},o=i(3),n=i(16),r=i(22),a=i(8),_=function(t){function e(){t.call(this)}return s(e,t),e.Create=function(t){return new e},e.Destroy=function(t,e){},e.prototype.Reset=function(e,i,s,o){t.prototype.Reset.call(this,e,i,s,o)},e.prototype.Evaluate=function(t,e,i){var s=this.m_fixtureA.GetShape(),r=this.m_fixtureB.GetShape();o.ENABLE_ASSERTS&&o.b2Assert(s instanceof n.b2CircleShape),o.ENABLE_ASSERTS&&o.b2Assert(r instanceof n.b2CircleShape),a.b2CollideCircles(t,s,e,r,i)},e}(r.b2Contact);e.b2CircleContact=_},function(t,e,i){"use strict";var s=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},o=i(3),n=i(17),r=i(22),a=i(8),_=i(14),m=i(16),h=function(t){function e(){t.call(this)}return s(e,t),e.Create=function(t){return new e},e.Destroy=function(t,e){},e.prototype.Reset=function(e,i,s,n){t.prototype.Reset.call(this,e,i,s,n),o.ENABLE_ASSERTS&&o.b2Assert(e.GetType()==_.b2ShapeType.e_polygonShape),o.ENABLE_ASSERTS&&o.b2Assert(s.GetType()==_.b2ShapeType.e_circleShape)},e.prototype.Evaluate=function(t,e,i){var s=this.m_fixtureA.GetShape(),r=this.m_fixtureB.GetShape();o.ENABLE_ASSERTS&&o.b2Assert(s instanceof n.b2PolygonShape),o.ENABLE_ASSERTS&&o.b2Assert(r instanceof m.b2CircleShape),a.b2CollidePolygonAndCircle(t,s,e,r,i)},e}(r.b2Contact);e.b2PolygonAndCircleContact=h},function(t,e,i){"use strict";var s=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},o=i(3),n=i(17),r=i(22),a=i(10),_=function(t){function e(){t.call(this)}return s(e,t),e.Create=function(t){return new e},e.Destroy=function(t,e){},e.prototype.Reset=function(e,i,s,o){t.prototype.Reset.call(this,e,i,s,o)},e.prototype.Evaluate=function(t,e,i){var s=this.m_fixtureA.GetShape(),r=this.m_fixtureB.GetShape();o.ENABLE_ASSERTS&&o.b2Assert(s instanceof n.b2PolygonShape),o.ENABLE_ASSERTS&&o.b2Assert(r instanceof n.b2PolygonShape),a.b2CollidePolygons(t,s,e,r,i)},e}(r.b2Contact);e.b2PolygonContact=_},function(t,e,i){"use strict";var s=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},o=i(3),n=i(16),r=i(22),a=i(9),_=i(14),m=i(15),h=function(t){function e(){t.call(this)}return s(e,t),e.Create=function(t){return new e},e.Destroy=function(t,e){},e.prototype.Reset=function(e,i,s,n){t.prototype.Reset.call(this,e,i,s,n),o.ENABLE_ASSERTS&&o.b2Assert(e.GetType()==_.b2ShapeType.e_edgeShape),o.ENABLE_ASSERTS&&o.b2Assert(s.GetType()==_.b2ShapeType.e_circleShape)},e.prototype.Evaluate=function(t,e,i){var s=this.m_fixtureA.GetShape(),r=this.m_fixtureB.GetShape();o.ENABLE_ASSERTS&&o.b2Assert(s instanceof m.b2EdgeShape),o.ENABLE_ASSERTS&&o.b2Assert(r instanceof n.b2CircleShape),a.b2CollideEdgeAndCircle(t,s,e,r,i)},e}(r.b2Contact);e.b2EdgeAndCircleContact=h},function(t,e,i){"use strict";var s=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},o=i(3),n=i(17),r=i(22),a=i(9),_=i(14),m=i(15),h=function(t){function e(){t.call(this)}return s(e,t),e.Create=function(t){return new e},e.Destroy=function(t,e){},e.prototype.Reset=function(e,i,s,n){t.prototype.Reset.call(this,e,i,s,n),o.ENABLE_ASSERTS&&o.b2Assert(e.GetType()==_.b2ShapeType.e_edgeShape),o.ENABLE_ASSERTS&&o.b2Assert(s.GetType()==_.b2ShapeType.e_polygonShape)},e.prototype.Evaluate=function(t,e,i){var s=this.m_fixtureA.GetShape(),r=this.m_fixtureB.GetShape();o.ENABLE_ASSERTS&&o.b2Assert(s instanceof m.b2EdgeShape),o.ENABLE_ASSERTS&&o.b2Assert(r instanceof n.b2PolygonShape),a.b2CollideEdgeAndPolygon(t,s,e,r,i)},e}(r.b2Contact);e.b2EdgeAndPolygonContact=h},function(t,e,i){"use strict";var s=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},o=i(3),n=i(14),r=i(13),a=i(16),_=i(15),m=i(22),h=i(9),l=function(t){function e(){t.call(this)}return s(e,t),e.Create=function(t){return new e},e.Destroy=function(t,e){},e.prototype.Reset=function(e,i,s,r){t.prototype.Reset.call(this,e,i,s,r),o.ENABLE_ASSERTS&&o.b2Assert(e.GetType()==n.b2ShapeType.e_chainShape),o.ENABLE_ASSERTS&&o.b2Assert(s.GetType()==n.b2ShapeType.e_circleShape)},e.prototype.Evaluate=function(t,i,s){var n=this.m_fixtureA.GetShape(),_=this.m_fixtureB.GetShape();o.ENABLE_ASSERTS&&o.b2Assert(n instanceof r.b2ChainShape),o.ENABLE_ASSERTS&&o.b2Assert(_ instanceof a.b2CircleShape);var m=n,l=e.Evaluate_s_edge;m.GetChildEdge(l,this.m_indexA),h.b2CollideEdgeAndCircle(t,l,i,_,s)},e.Evaluate_s_edge=new _.b2EdgeShape,e}(m.b2Contact);e.b2ChainAndCircleContact=l},function(t,e,i){"use strict";var s=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},o=i(3),n=i(14),r=i(13),a=i(17),_=i(15),m=i(22),h=i(9),l=function(t){function e(){t.call(this)}return s(e,t),e.Create=function(t){return new e},e.Destroy=function(t,e){},e.prototype.Reset=function(e,i,s,r){t.prototype.Reset.call(this,e,i,s,r),o.ENABLE_ASSERTS&&o.b2Assert(e.GetType()==n.b2ShapeType.e_chainShape),o.ENABLE_ASSERTS&&o.b2Assert(s.GetType()==n.b2ShapeType.e_polygonShape)},e.prototype.Evaluate=function(t,i,s){var n=this.m_fixtureA.GetShape(),_=this.m_fixtureB.GetShape();o.ENABLE_ASSERTS&&o.b2Assert(n instanceof r.b2ChainShape),o.ENABLE_ASSERTS&&o.b2Assert(_ instanceof a.b2PolygonShape);var m=n,l=e.Evaluate_s_edge;m.GetChildEdge(l,this.m_indexA),h.b2CollideEdgeAndPolygon(t,l,i,_,s)},e.Evaluate_s_edge=new _.b2EdgeShape,e}(m.b2Contact);e.b2ChainAndPolygonContact=l},function(t,e,i){"use strict";var s=i(3),o=i(4),n=i(18),r=function(){function t(){this.vertices=new Array,this.count=0,this.masses=new Array,this.gravity=new o.b2Vec2(0,0),this.damping=.1,this.k2=.9,this.k3=.1}return t}();e.b2RopeDef=r;var a=function(){function t(){this.m_count=0,this.m_ps=null,this.m_p0s=null,this.m_vs=null,this.m_ims=null,this.m_Ls=null,this.m_as=null,this.m_gravity=new o.b2Vec2,this.m_damping=0,this.m_k2=1,this.m_k3=.1}return t.prototype.GetVertexCount=function(){return this.m_count},t.prototype.GetVertices=function(){return this.m_ps},t.prototype.Initialize=function(t){s.ENABLE_ASSERTS&&s.b2Assert(t.count>=3),this.m_count=t.count,this.m_ps=o.b2Vec2.MakeArray(this.m_count),this.m_p0s=o.b2Vec2.MakeArray(this.m_count),this.m_vs=o.b2Vec2.MakeArray(this.m_count),this.m_ims=s.b2MakeNumberArray(this.m_count);for(var e=0;e<this.m_count;++e){this.m_ps[e].Copy(t.vertices[e]),this.m_p0s[e].Copy(t.vertices[e]),this.m_vs[e].SetZero();var i=t.masses[e];i>0?this.m_ims[e]=1/i:this.m_ims[e]=0}var n=this.m_count-1,r=this.m_count-2;this.m_Ls=s.b2MakeNumberArray(n),this.m_as=s.b2MakeNumberArray(r);for(var e=0;e<n;++e){var a=this.m_ps[e],_=this.m_ps[e+1];this.m_Ls[e]=o.b2DistanceVV(a,_)}for(var e=0;e<r;++e){var a=this.m_ps[e],_=this.m_ps[e+1],m=this.m_ps[e+2],h=o.b2SubVV(_,a,o.b2Vec2.s_t0),l=o.b2SubVV(m,_,o.b2Vec2.s_t1),c=o.b2CrossVV(h,l),u=o.b2DotVV(h,l);this.m_as[e]=o.b2Atan2(c,u)}this.m_gravity.Copy(t.gravity),this.m_damping=t.damping,this.m_k2=t.k2,this.m_k3=t.k3},t.prototype.Step=function(t,e){if(0!=t){for(var i=Math.exp(-t*this.m_damping),s=0;s<this.m_count;++s)this.m_p0s[s].Copy(this.m_ps[s]),this.m_ims[s]>0&&this.m_vs[s].SelfMulAdd(t,this.m_gravity),this.m_vs[s].SelfMul(i),this.m_ps[s].SelfMulAdd(t,this.m_vs[s]);for(var s=0;s<e;++s)this.SolveC2(),this.SolveC3(),this.SolveC2();for(var n=1/t,s=0;s<this.m_count;++s)o.b2MulSV(n,o.b2SubVV(this.m_ps[s],this.m_p0s[s],o.b2Vec2.s_t0),this.m_vs[s])}},t.prototype.SolveC2=function(){for(var e=this.m_count-1,i=0;i<e;++i){var s=this.m_ps[i],n=this.m_ps[i+1],r=o.b2SubVV(n,s,t.s_d),a=r.Normalize(),_=this.m_ims[i],m=this.m_ims[i+1];if(_+m!=0){var h=_/(_+m),l=m/(_+m);s.SelfMulSub(this.m_k2*h*(this.m_Ls[i]-a),r),n.SelfMulAdd(this.m_k2*l*(this.m_Ls[i]-a),r)}}},t.prototype.SetAngleRadians=function(t){for(var e=this.m_count-2,i=0;i<e;++i)this.m_as[i]=t},t.prototype.SolveC3=function(){for(var e=this.m_count-2,i=0;i<e;++i){var n=this.m_ps[i],r=this.m_ps[i+1],a=this.m_ps[i+2],_=this.m_ims[i],m=this.m_ims[i+1],h=this.m_ims[i+2],l=o.b2SubVV(r,n,t.s_d1),c=o.b2SubVV(a,r,t.s_d2),u=l.GetLengthSquared(),p=c.GetLengthSquared();if(u*p!=0){var b=o.b2CrossVV(l,c),y=o.b2DotVV(l,c),d=o.b2Atan2(b,y),f=o.b2MulSV(-1/u,l.SelfSkew(),t.s_Jd1),A=o.b2MulSV(1/p,c.SelfSkew(),t.s_Jd2),v=o.b2NegV(f,t.s_J1),S=o.b2SubVV(f,A,t.s_J2),V=A,x=_*o.b2DotVV(v,v)+m*o.b2DotVV(S,S)+h*o.b2DotVV(V,V);if(0!=x){x=1/x;for(var C=d-this.m_as[i];C>s.b2_pi;)d-=2*s.b2_pi,C=d-this.m_as[i];for(;C<-s.b2_pi;)d+=2*s.b2_pi,C=d-this.m_as[i];var B=-this.m_k3*x*C;n.SelfMulAdd(_*B,v),r.SelfMulAdd(m*B,S),a.SelfMulAdd(h*B,V)}}}},t.prototype.Draw=function(t){for(var e=new n.b2Color(.4,.5,.7),i=0;i<this.m_count-1;++i)t.DrawSegment(this.m_ps[i],this.m_ps[i+1],e)},t.s_d=new o.b2Vec2,t.s_d1=new o.b2Vec2,t.s_d2=new o.b2Vec2,t.s_Jd1=new o.b2Vec2,t.s_Jd2=new o.b2Vec2,t.s_J1=new o.b2Vec2,t.s_J2=new o.b2Vec2,t}();e.b2Rope=a}])});